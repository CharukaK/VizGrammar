/***igviz.js***/!function(a){if("function"==typeof define&&define.amd)define(["d3","topojson"],a);else{var b="undefined"==typeof topojson?null:topojson;vg=a(d3,b)}}(function(a,b){function c(a){return a.replace(J,"$1\\'")}function d(a,b,c){var d=0,e=a.split(K);return a=c?(e=e.reverse()).filter(function(a){return d+=a.length,b>=d}).reverse():e.filter(function(a){return d+=a.length,b>=d}),a.length?a.join("").trim():e[0].slice(0,b)}function e(a){H.config.isNode?process.stderr.write(a+"\n"):console.log(a)}function f(a){return a.__vgtree__=!0,a.nodes=function(){return g(this,[])},a}function g(a,b){var c,d=a.values,e=d?d.length:0;for(b.push(a),c=0;e>c;++c)g(d[c],b);return b}function h(a){var b,c,d=a;if(H.isArray(a))for(d=[],b=0,c=a.length;c>b;++b)d.push(h(a[b]));else if(H.isObject(a)){d={};for(b in a)d[b]=h(a[b])}return d}function i(a){return M.test(a)}function j(a){return 0===a.indexOf(N)}function k(b,c){return H.log("LOAD: "+b),l(b)?void a.xhr(b,function(a,b){b&&(b=b.responseText),c(a,b)}):void H.error("URL is not whitelisted: "+b)}function l(a){if(!H.config.domainWhiteList)return!0;var b=document.createElement("a");b.href=a;var c=b.hostname.toLowerCase();return window.location.hostname===c||H.config.domainWhiteList.some(function(a){var b=c.length-a.length;return a===c||b>1&&"."===c[b-1]&&c.lastIndexOf(a)===b})}function m(a,b){H.log("LOAD FILE: "+a);var c=a.indexOf(N);c>=0&&(a=a.slice(N.length)),require("fs").readFile(a,b)}function n(a,b){H.log("LOAD HTTP: "+a);var c=require("http").request(a,function(a){var c=0,d=new Buffer(parseInt(a.headers["content-length"],10));a.on("error",function(a){b(a,null)}),a.on("data",function(a){a.copy(d,c),c+=a.length}),a.on("end",function(){b(null,d)})});c.on("error",function(a){b(a)}),c.end()}function o(a,b,c){if(d=[],c&&b.length>1){for(var d,e,f,g=p(a.domain()),h=-1,i=b.length,j=(b[1]-b[0])/++c;++h<i;)for(e=c;--e>0;)(f=+b[h]-e*j)>=g[0]&&d.push(f);for(--h,e=0;++e<c&&(f=+b[h]+e*j)<g[1];)d.push(f)}return d}function p(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function q(a){return a.rangeExtent?a.rangeExtent():p(a.range())}function r(a,b,c,d,e,f){e=Math.max(e,0)+f,("left"===a||"top"===a)&&(e*=-1),"top"===a||"bottom"===a?(H.extend(b.properties.enter,{x:c,y:{value:e}}),H.extend(b.properties.update,{x:d,y:{value:e},align:{value:"center"},baseline:{value:Q[a]}})):(H.extend(b.properties.enter,{x:{value:e},y:c}),H.extend(b.properties.update,{x:{value:e},y:d,align:{value:P[a]},baseline:{value:"middle"}}))}function s(a,b,c,d,e){var f="left"===a||"top"===a?-1:1;e=e===1/0?"top"===a||"bottom"===a?{group:"mark.group.height",mult:-f}:{group:"mark.group.width",mult:-f}:{value:f*e},"top"===a||"bottom"===a?(H.extend(b.properties.enter,{x:c,y:{value:0},y2:e}),H.extend(b.properties.update,{x:d,y:{value:0},y2:e}),H.extend(b.properties.exit,{x:d})):(H.extend(b.properties.enter,{x:{value:0},x2:e,y:c}),H.extend(b.properties.update,{x:{value:0},x2:e,y:d}),H.extend(b.properties.exit,{y:d}))}function t(a,b,c,d){var e=~~((c[0]+c[1])/2),f="top"===a||"left"===a?-1:1;"bottom"===a||"top"===a?H.extend(b.properties.update,{x:{value:e},y:{value:f*d},angle:{value:0}}):H.extend(b.properties.update,{x:{value:f*d},y:{value:e},angle:{value:-90}})}function u(a,b,c,d){var e;("top"===a||"left"===a)&&(d=-1*d),e="bottom"===a||"top"===a?"M"+c[0]+","+d+"V0H"+c[1]+"V"+d:"M"+d+","+c[0]+"H0V"+c[1]+"H"+d,b.properties.update.path={value:e}}function v(a,b,c){var d=c?{}:a,e=a.mark.def.offset,f=a.mark.def.orient,g=b.width,h=b.height;if(H.isArray(e)){var i=e[0],j=e[1];switch(f){case"left":d.x=-i,d.y=j;break;case"right":d.x=g+i,d.y=j;break;case"bottom":d.x=i,d.y=h+j;break;case"top":d.x=i,d.y=-j;break;default:d.x=i,d.y=j}}else switch(H.isObject(e)&&(e=-b.scales[e.scale](e.value)),f){case"left":d.x=-e,d.y=0;break;case"right":d.x=g+e,d.y=0;break;case"bottom":d.x=0,d.y=h+e;break;case"top":d.x=0,d.y=-e;break;default:d.x=0,d.y=0}c&&c.interpolate(a,d)}function w(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:H.config.axis.tickColor},strokeWidth:{value:H.config.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function x(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:H.config.axis.tickLabelColor},font:{value:H.config.axis.tickLabelFont},fontSize:{value:H.config.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function y(){return{type:"text",interactive:!0,properties:{enter:{font:{value:H.config.axis.titleFont},fontSize:{value:H.config.axis.titleFontSize},fontWeight:{value:H.config.axis.titleFontWeight},fill:{value:H.config.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function z(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:H.config.axis.axisColor},strokeWidth:{value:H.config.axis.axisWidth}},update:{}}}}function A(a,b,c){var d,e=c?{}:a,f=a.mark.def.offset,g=a.mark.def.orient,h=2*a.mark.def.padding,i=~~a.bounds.width()+(a.width?0:h),j=~~a.bounds.height()+(a.height?0:h);switch(e.x=.5,e.y=.5,e.width=i,e.height=j,!c&&b.bounds&&(b.bounds.delta=b.bounds.x2-b.width),g){case"left":d=b.bounds?b.bounds.x1:0,e.x+=d-f-i;break;case"right":d=b.width,b.bounds&&(d=c?b.width+b.bounds.delta:b.bounds.x2),e.x+=d+f}c&&c.interpolate(a,e),a.mark.def.properties.enter(a,b,c)}function B(a,b,c,d,e){var f=a.properties.enter,g=a.properties.update;b&&(f.size=g.size={scale:b.scaleName,field:"data"}),c&&(f.shape=g.shape={scale:c.scaleName,field:"data"}),d&&(f.fill=g.fill={scale:d.scaleName,field:"data"}),e&&(f.stroke=g.stroke={scale:e.scaleName,field:"data"})}function C(){var a=H.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:a.titleColor},font:{value:a.titleFont},fontSize:{value:a.titleFontSize},fontWeight:{value:a.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function D(){var a=H.config.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:a.symbolShape},size:{value:a.symbolSize},stroke:{value:a.symbolColor},strokeWidth:{value:a.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function E(){var a=H.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:a.labelColor},font:{value:a.labelFont},fontSize:{value:a.labelFontSize},align:{value:a.labelAlign},baseline:{value:a.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function F(){var a=H.config.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:a.gradientWidth},height:{value:a.gradientHeight},stroke:{value:a.gradientStrokeColor},strokeWidth:{value:a.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function G(){var a=H.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:a.labelColor},font:{value:a.labelFont},fontSize:{value:a.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var H={version:"1.4.3",d3:a,topojson:b},I=Object.prototype.toString;H.isObject=function(a){return a===Object(a)},H.isFunction=function(a){return"[object Function]"==I.call(a)},H.isString=function(a){return"[object String]"==I.call(a)},H.isArray=Array.isArray||function(a){return"[object Array]"==I.call(a)},H.isNumber=function(a){return"[object Number]"==I.call(a)},H.isBoolean=function(a){return"[object Boolean]"==I.call(a)},H.isTree=function(a){return a&&a.__vgtree__},H.tree=function(a,b){var c=[a];return c.__vgtree__=!0,c.children=b||"children",c},H.number=function(a){return+a},H["boolean"]=function(a){return!!a},H.identity=function(a){return a},H["true"]=function(){return!0},H.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},H.duplicate=function(a){return JSON.parse(JSON.stringify(a))},H.field=function(a){return a.split("\\.").map(function(a){return a.split(".")}).reduce(function(a,b){return a.length&&(a[a.length-1]+="."+b.shift()),a.push.apply(a,b),a},[])},H.accessor=function(a){var b;return H.isFunction(a)||null==a?a:H.isString(a)&&(b=H.field(a)).length>1?function(a){return b.reduce(function(a,b){return a[b]},a)}:function(b){return b[a]}},H.mutator=function(a){var b;return H.isString(a)&&(b=H.field(a)).length>1?function(a,c){for(var d=0;d<b.length-1;++d)a=a[b[d]];a[b[d]]=c}:function(b,c){b[a]=c}},H.comparator=function(a){var b=[];return void 0===a&&(a=[]),a=H.array(a).map(function(a){var c=1;return"-"===a[0]?(c=-1,a=a.slice(1)):"+"===a[0]&&(c=1,a=a.slice(1)),b.push(c),H.accessor(a)}),function(c,d){var e,f,g,h,i;for(e=0,f=a.length;f>e;++e){if(g=a[e],h=g(c),i=g(d),i>h)return-1*b[e];if(h>i)return b[e]}return 0}},H.cmp=function(a,b){return b>a?-1:a>b?1:0},H.numcmp=function(a,b){return a-b},H.array=function(a){return null!=a?H.isArray(a)?a:[a]:[]},H.values=function(a){return H.isObject(a)&&!H.isArray(a)&&a.values?a.values:a},H.str=function(a){return H.isArray(a)?"["+a.map(H.str)+"]":H.isObject(a)?JSON.stringify(a):H.isString(a)?"'"+c(a)+"'":a};var J=/(^|[^\\])'/g;H.keys=function(a){var b=[];for(var c in a)b.push(c);return b},H.unique=function(a,b,c){if(!H.isArray(a)||0==a.length)return[];b=b||H.identity,c=c||[];for(var d,e=0,f=a.length;f>e;++e)d=b(a[e]),c.indexOf(d)<0&&c.push(d);return c},H.minIndex=function(a,b){if(!H.isArray(a)||0==a.length)return-1;b=b||H.identity;for(var c=0,d=b(a[0]),e=d,f=1,g=a.length;g>f;++f)e=b(a[f]),d>e&&(d=e,c=f);return c},H.maxIndex=function(a,b){if(!H.isArray(a)||0==a.length)return-1;b=b||H.identity;for(var c=0,d=b(a[0]),e=d,f=1,g=a.length;g>f;++f)e=b(a[f]),e>d&&(d=e,c=f);return c},H.truncate=function(a,b,c,e,f){var g=a.length;if(b>=g)return a;f=f||"...";var h=Math.max(0,b-f.length);switch(c){case"left":return f+(e?d(a,h,1):a.slice(g-h));case"middle":case"center":var i=Math.ceil(h/2),j=Math.floor(h/2);return(e?d(a,i):a.slice(0,i))+f+(e?d(a,j,1):a.slice(g-j));default:return(e?d(a,h):a.slice(0,h))+f}};var K=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;H.log=function(a){e("[Vega Log] "+a)},H.error=function(a){a="[Vega Err] "+a,e(a),"undefined"!=typeof alert&&alert(a)},H.config={},H.config.isNode="undefined"!=typeof exports&&this.exports!==exports,H.config.domainWhiteList=!1,H.config.safeMode=!1,H.config.baseURL="",H.config.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',H.config.autopadInset=5,H.config.scale={time:a.time.scale,utc:a.time.scale.utc},H.config.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},H.config.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},H.config.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},H.config.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},H.config.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},H.Bounds=function(){var a=function(a){this.clear(),a&&this.union(a)},b=a.prototype;return b.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},b.set=function(a,b,c,d){return this.x1=a,this.y1=b,this.x2=c,this.y2=d,this},b.add=function(a,b){return a<this.x1&&(this.x1=a),b<this.y1&&(this.y1=b),a>this.x2&&(this.x2=a),b>this.y2&&(this.y2=b),this},b.expand=function(a){return this.x1-=a,this.y1-=a,this.x2+=a,this.y2+=a,this},b.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},b.translate=function(a,b){return this.x1+=a,this.x2+=a,this.y1+=b,this.y2+=b,this},b.rotate=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=b-b*d+c*e,g=c-b*e-c*d,h=this.x1,i=this.x2,j=this.y1,k=this.y2;return this.clear().add(d*h-e*j+f,e*h+d*j+g).add(d*h-e*k+f,e*h+d*k+g).add(d*i-e*j+f,e*i+d*j+g).add(d*i-e*k+f,e*i+d*k+g)},b.union=function(a){return a.x1<this.x1&&(this.x1=a.x1),a.y1<this.y1&&(this.y1=a.y1),a.x2>this.x2&&(this.x2=a.x2),a.y2>this.y2&&(this.y2=a.y2),this},b.encloses=function(a){return a&&this.x1<=a.x1&&this.x2>=a.x2&&this.y1<=a.y1&&this.y2>=a.y2},b.intersects=function(a){return a&&!(this.x2<a.x1||this.x1>a.x2||this.y2<a.y1||this.y1>a.y2)},b.contains=function(a,b){return!(a<this.x1||a>this.x2||b<this.y1||b>this.y2)},b.width=function(){return this.x2-this.x1},b.height=function(){return this.y2-this.y1},a}(),H.Gradient=function(){function a(a){this.id="grad_"+L++,this.type=a||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var b=a.prototype;return b.stop=function(a,b){return this.stops.push({offset:a,color:b}),this},a}();var L=0;H.canvas={},H.canvas.path=function(){function b(a){var b,c,d,e=[];a=a.slice().replace(m[0],"###$1").split(m[1]).slice(1);for(var f,g,h=0,i=a.length;i>h;h++){b=a[h],c=b.slice(1).trim().replace(m[2],"$1###-").split(m[3]),g=[b.charAt(0)];for(var f=0,j=c.length;j>f;f++)d=parseFloat(c[f]),isNaN(d)||g.push(d);var k=g[0].toLowerCase(),n=l[k];if(g.length-1>n)for(var o=1,p=g.length;p>o;o+=n)e.push([g[0]].concat(g.slice(o,o+n)));else e.push(g)}return e}function c(a,b,c,d,g,h,i){for(var j=d[0],k=d[1],l=d[2],m=d[3],n=d[4],o=d[5],p=d[6],q=e(o,p,j,k,m,n,l,b,c),r=0;r<q.length;r++){var s=f.apply(null,q[r]);a.bezierCurveTo.apply(a,s),g.add(s[0]-h,s[1]-i),g.add(s[2]-h,s[3]-i),g.add(s[4]-h,s[5]-i)}}function d(a,b,c,d){for(var g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5],m=c[6],n=e(l,m,g,h,j,k,i,a,b),o=0;o<n.length;o++){var p=f.apply(null,n[o]);d.add(p[0],p[1]),d.add(p[2],p[3]),d.add(p[4],p[5])}}function e(a,b,c,d,e,f,g,h,i){if(k=p.call(arguments),n[k])return n[k];var j=g*(Math.PI/180),l=Math.sin(j),m=Math.cos(j);c=Math.abs(c),d=Math.abs(d);var o=m*(h-a)*.5+l*(i-b)*.5,q=m*(i-b)*.5-l*(h-a)*.5,r=o*o/(c*c)+q*q/(d*d);r>1&&(r=Math.sqrt(r),c*=r,d*=r);var s=m/c,t=l/c,u=-l/d,v=m/d,w=s*h+t*i,x=u*h+v*i,y=s*a+t*b,z=u*a+v*b,A=(y-w)*(y-w)+(z-x)*(z-x),B=1/A-.25;0>B&&(B=0);var C=Math.sqrt(B);f==e&&(C=-C);var D=.5*(w+y)-C*(z-x),E=.5*(x+z)+C*(y-w),F=Math.atan2(x-E,w-D),G=Math.atan2(z-E,y-D),H=G-F;0>H&&1==f?H+=2*Math.PI:H>0&&0==f&&(H-=2*Math.PI);for(var I=Math.ceil(Math.abs(H/(.5*Math.PI+.001))),J=[],K=0;I>K;K++){var L=F+K*H/I,M=F+(K+1)*H/I;J[K]=[D,E,L,M,c,d,l,m]}return n[k]=J}function f(a,b,c,d,e,f,g,h){if(k=p.call(arguments),o[k])return o[k];var i=h*e,j=-g*f,l=g*e,m=h*f,n=Math.cos(c),q=Math.sin(c),r=Math.cos(d),s=Math.sin(d),t=.5*(d-c),u=Math.sin(.5*t),v=8/3*u*u/Math.sin(t),w=a+n-v*q,x=b+q+v*n,y=a+r,z=b+s,A=y+v*s,B=z-v*r;return o[k]=[i*w+j*x,l*w+m*x,i*A+j*B,l*A+m*B,i*y+j*z,l*y+m*z]}function g(a,b,d,e){var f,g,h,i,j,k=null,l=0,m=0,n=0,o=0,p=new H.Bounds;void 0==d&&(d=0),void 0==e&&(e=0),a.beginPath();for(var q=0,r=b.length;r>q;++q){switch(f=b[q],f[0]){case"l":l+=f[1],m+=f[2],a.lineTo(l+d,m+e),p.add(l,m);break;case"L":l=f[1],m=f[2],a.lineTo(l+d,m+e),p.add(l,m);break;case"h":l+=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"H":l=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"v":m+=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"V":m=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"m":l+=f[1],m+=f[2],a.moveTo(l+d,m+e),p.add(l,m);break;case"M":l=f[1],m=f[2],a.moveTo(l+d,m+e),p.add(l,m);break;case"c":g=l+f[5],h=m+f[6],n=l+f[3],o=m+f[4],a.bezierCurveTo(l+f[1]+d,m+f[2]+e,n+d,o+e,g+d,h+e),p.add(l+f[1],m+f[2]),p.add(n,o),p.add(g,h),l=g,m=h;break;case"C":l=f[5],m=f[6],n=f[3],o=f[4],a.bezierCurveTo(f[1]+d,f[2]+e,n+d,o+e,l+d,m+e),p.add(f[1],f[2]),p.add(n,o),p.add(l,m);break;case"s":g=l+f[3],h=m+f[4],n=2*l-n,o=2*m-o,a.bezierCurveTo(n+d,o+e,l+f[1]+d,m+f[2]+e,g+d,h+e),p.add(n,o),p.add(l+f[1],m+f[2]),p.add(g,h),n=l+f[1],o=m+f[2],l=g,m=h;break;case"S":g=f[3],h=f[4],n=2*l-n,o=2*m-o,a.bezierCurveTo(n+d,o+e,f[1]+d,f[2]+e,g+d,h+e),l=g,m=h,p.add(f[1],f[2]),p.add(n,o),p.add(g,h),n=f[1],o=f[2];break;case"q":g=l+f[3],h=m+f[4],n=l+f[1],o=m+f[2],a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,p.add(n,o),p.add(g,h);break;case"Q":g=f[3],h=f[4],a.quadraticCurveTo(f[1]+d,f[2]+e,g+d,h+e),l=g,m=h,n=f[1],o=f[2],p.add(n,o),p.add(g,h);break;case"t":g=l+f[1],h=m+f[2],null===k[0].match(/[QqTt]/)?(n=l,o=m):"t"===k[0]?(n=2*l-i,o=2*m-j):"q"===k[0]&&(n=2*l-n,o=2*m-o),i=n,j=o,a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,n=l+f[1],o=m+f[2],p.add(n,o),p.add(g,h);break;case"T":g=f[1],h=f[2],n=2*l-n,o=2*m-o,a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,p.add(n,o),p.add(g,h);break;case"a":c(a,l+d,m+e,[f[1],f[2],f[3],f[4],f[5],f[6]+l+d,f[7]+m+e],p,d,e),l+=f[6],m+=f[7];break;case"A":c(a,l+d,m+e,[f[1],f[2],f[3],f[4],f[5],f[6]+d,f[7]+e],p,d,e),l=f[6],m=f[7];break;case"z":case"Z":a.closePath()}k=f}return p.translate(d,e)}function h(a,b){for(var c,e,f,g,h,i=null,j=0,k=0,l=0,m=0,n=0,o=a.length;o>n;++n){switch(c=a[n],c[0]){case"l":j+=c[1],k+=c[2],b.add(j,k);break;case"L":j=c[1],k=c[2],b.add(j,k);break;case"h":j+=c[1],b.add(j,k);break;case"H":j=c[1],b.add(j,k);break;case"v":k+=c[1],b.add(j,k);break;case"V":k=c[1],b.add(j,k);break;case"m":j+=c[1],k+=c[2],b.add(j,k);break;case"M":j=c[1],k=c[2],b.add(j,k);break;case"c":e=j+c[5],f=k+c[6],l=j+c[3],m=k+c[4],b.add(j+c[1],k+c[2]),b.add(l,m),b.add(e,f),j=e,k=f;break;case"C":j=c[5],k=c[6],l=c[3],m=c[4],b.add(c[1],c[2]),b.add(l,m),b.add(j,k);break;case"s":e=j+c[3],f=k+c[4],l=2*j-l,m=2*k-m,b.add(l,m),b.add(j+c[1],k+c[2]),b.add(e,f),l=j+c[1],m=k+c[2],j=e,k=f;break;case"S":e=c[3],f=c[4],l=2*j-l,m=2*k-m,j=e,k=f,b.add(c[1],c[2]),b.add(l,m),b.add(e,f),l=c[1],m=c[2];break;case"q":e=j+c[3],f=k+c[4],l=j+c[1],m=k+c[2],j=e,k=f,b.add(l,m),b.add(e,f);break;case"Q":e=c[3],f=c[4],j=e,k=f,l=c[1],m=c[2],b.add(l,m),b.add(e,f);break;case"t":e=j+c[1],f=k+c[2],null===i[0].match(/[QqTt]/)?(l=j,m=k):"t"===i[0]?(l=2*j-g,m=2*k-h):"q"===i[0]&&(l=2*j-l,m=2*k-m),g=l,h=m,j=e,k=f,l=j+c[1],m=k+c[2],b.add(l,m),b.add(e,f);break;case"T":e=c[1],f=c[2],l=2*j-l,m=2*k-m,j=e,k=f,b.add(l,m),b.add(e,f);break;case"a":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6]+j,c[7]+k],b),j+=c[6],k+=c[7];break;case"A":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6],c[7]],b),j=c[6],k=c[7];break;case"z":case"Z":}i=c}return b}function i(b){var c,d=b[0];return c="horizontal"===d.orient?a.svg.area().y(function(a){return a.y}).x0(function(a){return a.x}).x1(function(a){return a.x+a.width}):a.svg.area().x(function(a){return a.x}).y1(function(a){return a.y}).y0(function(a){return a.y+a.height}),d.interpolate&&c.interpolate(d.interpolate),null!=d.tension&&c.tension(d.tension),c(b)}function j(b){var c=b[0],d=a.svg.line().x(function(a){return a.x}).y(function(a){return a.y});return c.interpolate&&d.interpolate(c.interpolate),null!=c.tension&&d.tension(c.tension),d(b)}var k,l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],n={},o={},p=Array.prototype.join;return{parse:b,render:g,bounds:h,area:i,line:j}}(),H.canvas.marks=function(){function a(a,b){var c=b.x||0,d=b.y||0,e=b.innerRadius||0,f=b.outerRadius||0,g=(b.startAngle||0)-Math.PI/2,h=(b.endAngle||0)-Math.PI/2;a.beginPath(),0===e?a.moveTo(c,d):a.arc(c,d,e,g,h,0),a.arc(c,d,f,h,g,1),a.closePath()}function b(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=y(H.canvas.path.area(b)));z(a,e)}function c(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=y(H.canvas.path.line(b)));z(a,e)}function d(a,b){if(null!=b.path){var c=b.pathCache||(b.pathCache=y(b.path));return z(a,c,b.x,b.y)}}function e(a,b){a.beginPath();var c,d,e,f,g=null!=b.size?b.size:100,h=b.x,i=b.y;if(null==b.shape||"circle"===b.shape)return c=Math.sqrt(g/Math.PI),a.arc(h,i,c,0,2*Math.PI,0),void a.closePath();switch(b.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,a.moveTo(h-d,i-c),a.lineTo(h-c,i-c),a.lineTo(h-c,i-d),a.lineTo(h+c,i-d),a.lineTo(h+c,i-c),a.lineTo(h+d,i-c),a.lineTo(h+d,i+c),a.lineTo(h+c,i+c),a.lineTo(h+c,i+d),a.lineTo(h-c,i+d),a.lineTo(h-c,i+c),a.lineTo(h-d,i+c);break;case"diamond":f=Math.sqrt(g/(2*B)),e=f*B,a.moveTo(h,i-f),a.lineTo(h+e,i),a.lineTo(h,i+f),a.lineTo(h-e,i);break;case"square":d=Math.sqrt(g),c=d/2,a.rect(h-c,i-c,d,d);break;case"triangle-down":e=Math.sqrt(g/A),f=e*A/2,a.moveTo(h,i+f),a.lineTo(h+e,i-f),a.lineTo(h-e,i-f);break;case"triangle-up":e=Math.sqrt(g/A),f=e*A/2,a.moveTo(h,i-f),a.lineTo(h+e,i+f),a.lineTo(h-e,i+f)}a.closePath()}function f(a,b){var d=b[0],e=d.strokeWidth,f=d.strokeCap;a.lineWidth=null!=e?e:H.config.render.lineWidth,a.lineCap=null!=f?f:H.config.render.lineCap,c(a,b)}function g(a,b){var c=b.x||0,d=b.y||0,e=null!=b.x2?b.x2:c,f=null!=b.y2?b.y2:d,g=b.strokeWidth,h=b.strokeCap;a.lineWidth=null!=g?g:H.config.render.lineWidth,a.lineCap=null!=h?h:H.config.render.lineCap,a.beginPath(),a.moveTo(c,d),a.lineTo(e,f)}function h(a,b,c,d){var e,f,g,h=c.fill,i=c.stroke;a(b,d),e=null==c.opacity?1:c.opacity,0!=e&&(h||i)&&(h&&(b.globalAlpha=e*(null==c.fillOpacity?1:c.fillOpacity),b.fillStyle=q(b,c,h),b.fill()),i&&(g=null!=(g=c.strokeWidth)?g:H.config.render.lineWidth,g>0&&(b.globalAlpha=e*(null==c.strokeOpacity?1:c.strokeOpacity),b.strokeStyle=q(b,c,i),b.lineWidth=g,b.lineCap=null!=(f=c.strokeCap)?f:H.config.render.lineCap,b.vgLineDash(c.strokeDash||null),b.vgLineDashOffset(c.strokeDashOffset||0),b.stroke())))}function i(a,b,c,d){var e,f,g;for(e=0,f=c.items.length;f>e;++e)g=c.items[e],(!d||d.intersects(g.bounds))&&h(a,b,g,g)}function j(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m,n=b.items,o=0,p=n.length;p>o;++o)d=n[o],(!c||c.intersects(d.bounds))&&(j=d.x||0,k=d.y||0,l=d.width||0,m=d.height||0,g=null==d.opacity?1:d.opacity,0!=g&&((e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=q(a,d,e),a.fillRect(j,k,l,m)),(f=d.stroke)&&(i=null!=(i=d.strokeWidth)?i:H.config.render.lineWidth,i>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(a,d,f),a.lineWidth=i,a.lineCap=null!=(h=d.strokeCap)?h:H.config.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.strokeRect(j,k,l,m)))))}function k(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(i=d.x||0,j=d.y||0,k=null!=d.x2?d.x2:i,l=null!=d.y2?d.y2:j,f=null==d.opacity?1:d.opacity,0!=f&&(e=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:H.config.render.lineWidth,h>0&&(a.globalAlpha=f*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(a,d,e),a.lineWidth=h,a.lineCap=null!=(g=d.strokeCap)?g:H.config.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.beginPath(),a.moveTo(i,j),a.lineTo(k,l),a.stroke())))}function l(a,b,c){if(b.items.length)for(var d,e=this,f=b.items,g=0,h=f.length;h>g;++g)if(d=f[g],!c||c.intersects(d.bounds)){d.image&&d.image.url===d.url||(d.image=e.loadImage(d.url),d.image.url=d.url);var i,j,k,l,m;k=d.width||d.image&&d.image.width||0,l=d.height||d.image&&d.image.height||0,i=(d.x||0)-("center"===d.align?k/2:"right"===d.align?k:0),j=(d.y||0)-("middle"===d.baseline?l/2:"bottom"===d.baseline?l:0),d.image.loaded&&(a.globalAlpha=null!=(m=d.opacity)?m:1,a.drawImage(d.image,i,j,k,l))}}function m(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(a.font=H.scene.fontString(d),a.textAlign=d.align||"left",a.textBaseline=d.baseline||"alphabetic",g=null==d.opacity?1:d.opacity,0!=g&&(i=d.x||0,j=d.y||0,(k=d.radius)&&(l=(d.theta||0)-Math.PI/2,i+=k*Math.cos(l),j+=k*Math.sin(l)),d.angle?(a.save(),a.translate(i,j),a.rotate(d.angle*Math.PI/180),i=d.dx||0,j=d.dy||0):(i+=d.dx||0,j+=d.dy||0),(e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=q(a,d,e),a.fillText(d.text,i,j)),(f=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:1,h>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(d,f),a.lineWidth=h,a.strokeText(d.text,i,j))),d.angle&&a.restore()))}function n(a){return function(b,c,d){i(a,b,c,d)}}function o(a){return function(b,c,d){c.items.length&&(!d||d.intersects(c.items[0].bounds))&&h(a,b,c.items[0],c.items)}}function p(a,b,c){if(b.items.length){var d,e,f,g,h,i,k,l,m,n=b.items,o=this;for(j(a,b,c),i=0,k=n.length;k>i;++i){for(d=n[i],e=d.axisItems||[],f=d.legendItems||[],g=d.x||0,h=d.y||0,a.save(),a.translate(g,h),d.clip&&(a.beginPath(),a.rect(0,0,d.width||0,d.height||0),a.clip()),c&&c.translate(-g,-h),l=0,m=e.length;m>l;++l)"back"===e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=d.items.length;m>l;++l)o.draw(a,d.items[l],c);for(l=0,m=e.length;m>l;++l)"back"!==e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=f.length;m>l;++l)o.draw(a,f[l],c);c&&c.translate(g,h),a.restore()}}}function q(a,b,c){return c.id?r(a,c,b.bounds):c}function r(a,b,c){var d,e,f=c.width(),g=c.height(),h=c.x1+b.x1*f,i=c.y1+b.y1*g,j=c.x1+b.x2*f,k=c.y1+b.y2*g,l=a.createLinearGradient(h,i,j,k),m=b.stops;for(d=0,e=m.length;e>d;++d)l.addColorStop(m[d].offset,m[d].color);return l}function s(a,b,c,d,e,f){if(0===b.items.length||b.bounds&&!b.bounds.contains(e,f))return!1;var g,h,i,j,k,l,m,n=b.items,o=this;for(l=n.length;--l>=0;){for(h=n[l],j=h.x||0,k=h.y||0,a.save(),a.translate(j,k),m=h.items.length;--m>=0;)if(g=h.items[m],g.interactive!==!1&&(i=o.pick(g,c,d,e-j,f-k)))return a.restore(),i;a.restore()}return b.interactive?t(D.group,a,b,c,d,e,f):!1}function t(a,b,c,d,e,f,g){if(!c.items.length)return!1;var h,i,j;for(1!==b._ratio&&(d*=b._ratio,e*=b._ratio),j=c.items.length;--j>=0;)if(h=c.items[j],i=h.bounds,(!i||i.contains(f,g))&&i&&a(b,h,d,e,f,g))return h;return!1}function u(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),D.area(a,h,c,d)?h[0]:!1)}function v(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),D.line(a,h,c,d)?h[0]:!1)}function w(a){return function(b,c,d,e,f,g){return t(a,b,c,d,e,f,g)}}function x(a,b,c,d,e,f){if(!b.fontSize)return!1;if(!b.angle)return!0;var g=H.scene.bounds.text(b,C,!0),h=-b.angle*Math.PI/180,i=Math.cos(h),j=Math.sin(h),c=b.x,d=b.y,k=i*e-j*f+(c-c*i+d*j),l=j*e+i*f+(d-c*j-d*i);return g.contains(k,l)}var y=H.canvas.path.parse,z=H.canvas.path.render,A=(Math.PI/2,Math.sqrt(3)),B=Math.tan(30*Math.PI/180),C=new H.Bounds,D={text:x,rect:function(a,b,c,d){return!0},image:function(a,b,c,d){return!0},group:function(a,b,c,d){return b.fill||b.stroke},rule:function(a,b,c,d){return a.isPointInStroke?(g(a,b),a.isPointInStroke(c,d)):!1},line:function(a,b,c,d){return a.isPointInStroke?(f(a,b),a.isPointInStroke(c,d)):!1},arc:function(b,c,d,e){return a(b,c),b.isPointInPath(d,e)},area:function(a,c,d,e){return b(a,c),a.isPointInPath(d,e)},path:function(a,b,c,e){return d(a,b),a.isPointInPath(c,e)},symbol:function(a,b,c,d){return e(a,b),a.isPointInPath(c,d)}};return{draw:{group:p,area:o(b),line:o(c),arc:n(a),path:n(d),symbol:n(e),rect:j,rule:k,text:m,image:l,drawOne:o,drawAll:n},pick:{group:s,area:u,line:v,arc:w(D.arc),path:w(D.path),symbol:w(D.symbol),rect:w(D.rect),rule:w(D.rule),text:w(D.text),image:w(D.image),pickAll:t}}}(),H.canvas.Renderer=function(){function b(a,b){var c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;if(c!==d){var f=a.width,g=a.height;a.setAttribute("width",f*e),a.setAttribute("height",g*e),a.style.width=f+"px",a.style.height=g+"px"}return e}function c(a){if(!a.vgLineDash){var b=[];a.setLineDash?(a.vgLineDash=function(a){this.setLineDash(a||b)},a.vgLineDashOffset=function(a){this.lineDashOffset=a}):void 0!==a.webkitLineDash?(a.vgLineDash=function(a){this.webkitLineDash=a||b},a.vgLineDashOffset=function(a){this.webkitLineDashOffset=a}):void 0!==a.mozDash?(a.vgLineDash=function(a){this.mozDash=a},a.vgLineDashOffset=function(a){}):(a.vgLineDash=function(a){},a.vgLineDashOffset=function(a){})}}function d(a,b){for(var c=new H.Bounds(b);null!=(a=a.mark.group);)c.translate(a.x||0,a.y||0);return c}function e(a){return a?H.array(a).reduce(function(a,b){return a.union(d(b,b.bounds)).union(d(b,b["bounds:prev"]))},new H.Bounds):null}function f(a,b){var c=null;return b&&(c=new H.Bounds(b).round(),a.beginPath(),a.rect(c.x1,c.y1,c.width(),c.height()),a.clip()),c}var g=function(){this._ctx=null,this._el=null,this._imgload=0},h=g.prototype;return h.initialize=function(b,c,d,e){if(this._el=b,!b)return this;var f=a.select(b).selectAll("canvas.marks").data([1]);return f.enter().append("canvas").attr("class","marks"),f.exit().remove(),this.resize(c,d,e)},h.resize=function(d,e,f){if(this._width=d,this._height=e,this._padding=f,this._el){var g=a.select(this._el).select("canvas.marks");g.attr("width",d+f.left+f.right).attr("height",e+f.top+f.bottom);var h;this._ctx=g.node().getContext("2d"),this._ctx._ratio=h=b(g.node(),this._ctx)||1,this._ctx.setTransform(h,0,0,h,h*f.left,h*f.top)}return c(this._ctx),this},h.context=function(a){return a?(this._ctx=a,this):this._ctx},h.element=function(){return this._el},h.pendingImages=function(){return this._imgload},h.render=function(a,b){var c,d=this._ctx,g=this._padding,h=this._width+g.left+g.right,i=this._height+g.top+g.bottom,j=null;this._scene=a,d.save(),j=f(d,e(b)),d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,j),b&&(d.restore(),d.save(),c=f(d,e(b)),j.encloses(c)||(d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,c))),d.restore(),this._scene=null},h.draw=function(a,b,c){var d=b.marktype,e=H.canvas.marks.draw[d];e.call(this,a,b,c)},h.renderAsync=function(a){var b=this;b._async_id&&clearTimeout(b._async_id),b._async_id=setTimeout(function(){b.render(a),delete b._async_id},50)},h.loadImage=function(a){var b,c=this,d=c._scene,e=null;return c._imgload+=1,H.config.isNode?(e=new(require("canvas").Image),H.data.load(a,function(a,b){return a?void H.error(a):(e.src=b,e.loaded=!0,void(c._imgload-=1))})):(e=new Image,b=H.config.baseURL+a,e.onload=function(){H.log("LOAD IMAGE: "+b),e.loaded=!0,c._imgload-=1,c.renderAsync(d)},e.src=b),e},g}(),H.canvas.Handler=function(){function b(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var c=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},d=c.prototype;d.initialize=function(b,c,f){this._el=a.select(b).node(),this._canvas=a.select(b).select("canvas.marks").node(),this._padding=c,this._obj=f||null;var g=this._canvas,h=this;return e.forEach(function(a){g.addEventListener(a,function(b){d[a].call(h,b)})}),this},d.padding=function(a){return this._padding=a,this},d.model=function(a){return arguments.length?(this._model=a,this):this._model},d.handlers=function(){var a=this._handlers;return H.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){
return a.push(b),a},b)},[])};var e=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return e.forEach(function(a){d[a]=function(b){this.fire(a,b)}}),e.push("mousemove"),e.push("mouseout"),d.mousemove=function(a){var b=this._padding,c=a.target.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=this._active,g=this.pick(this._model.scene(),d,e,d-b.left,e-b.top);return g===f?void this.fire("mousemove",a):(f&&this.fire("mouseout",a),this._active=g,void(g&&this.fire("mouseover",a)))},d.mouseout=function(a){this._active&&this.fire("mouseout",a),this._active=null},d.DOMMouseScroll=function(a){this.fire("mousewheel",a)},d.fire=function(a,b){var c=this._active,d=this._handlers[a];if(c&&d)for(var e=0,f=d.length;f>e;++e)d[e].handler.call(this._obj,b,c)},d.on=function(a,c){var d=b(a),e=this._handlers;return e=e[d]||(e[d]=[]),e.push({type:a,handler:c}),this},d.off=function(a,c){var d=b(a),e=this._handlers[d];if(e){for(var f=e.length;--f>=0;)e[f].type===a&&(c&&e[f].handler!==c||e.splice(f,1));return this}},d.context=function(){return this._canvas.getContext("2d")},d.pick=function(a,b,c,d,e){var f=this.context(),g=a.marktype,h=H.canvas.marks.pick[g];return h.call(this,f,a,b,c,d,e)},c}(),H.svg={},H.svg.marks=function(){function b(a){return a.x||0}function c(a){return a.y||0}function d(a){return a.x+a.width||0}function e(a){return a.y+a.height||0}function f(a){return null==a.size?100:a.size}function g(a){return a.shape||"circle"}function h(a){var b,c,d,e,f,g=a.mark?a:a.length?a[0]:null;if(null!==g)for(b=0,c=I.length;c>b;++b)d=I[b],e=G[d],f=g[d],null==f?"fill"===e?this.style.setProperty(e,"none",null):this.style.removeProperty(e):(f.id&&(H.svg._cur._defs.gradient[f.id]=f,f="url("+window.location.href+"#"+f.id+")"),this.style.setProperty(e,f+"",null))}function i(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",y(a))}function j(a){if(a.length){var b=a[0],c="horizontal"===b.orient?A:z;c.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",c(a))}}function k(a){if(a.length){var b=a[0];B.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",B(a))}}function l(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),null!=a.path&&this.setAttribute("d",a.path)}function m(a){this.setAttribute("x",a.x||0),this.setAttribute("y",a.y||0),this.setAttribute("width",a.width||0),this.setAttribute("height",a.height||0)}function n(a){var b=a.x||0,c=a.y||0;this.setAttribute("x1",b),this.setAttribute("y1",c),this.setAttribute("x2",null!=a.x2?a.x2:b),this.setAttribute("y2",null!=a.y2?a.y2:c)}function o(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",C(a))}function p(a){var b=a.width||a.image&&a.image.width||0,c=a.height||a.image&&a.image.height||0,d=a.x-("center"===a.align?b/2:"right"===a.align?b:0),e=a.y-("middle"===a.baseline?c/2:"bottom"===a.baseline?c:0),f=H.config.baseURL+a.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",f),this.setAttribute("x",d),this.setAttribute("y",e),this.setAttribute("width",b),this.setAttribute("height",c)}function q(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:H.config.render.fontSize)+"px "+(a.font||H.config.render.font)}function r(a){var b=a.x||0,c=a.y||0,d=a.dx||0,e=a.dy||0,f=a.angle||0,g=a.radius||0,h=F[a.align||"left"],i="top"===a.baseline?".9em":"middle"===a.baseline?".35em":0;if(g){var j=(a.theta||0)-Math.PI/2;b+=g*Math.cos(j),c+=g*Math.sin(j)}this.setAttribute("x",b+d),this.setAttribute("y",c+e),this.setAttribute("text-anchor",h),f?this.setAttribute("transform","rotate("+f+" "+b+","+c+")"):this.removeAttribute("transform"),i?this.setAttribute("dy",i):this.removeAttribute("dy"),this.textContent=a.text,this.style.setProperty("font",q(a),null)}function s(a){var b=a.x||0,c=a.y||0;if(this.setAttribute("transform","translate("+b+","+c+")"),a.clip){var d={width:a.width||0,height:a.height||0},e=a.clip_id||(a.clip_id="clip"+E++);H.svg._cur._defs.clipping[e]=d,this.setAttribute("clip-path","url(#"+e+")")}}function t(a){var b=a.width||0,c=a.height||0;this.setAttribute("width",b),this.setAttribute("height",c)}function u(a){var b="type-"+a.type;return a.name&&(b+=" "+a.name),b}function v(a,b,c){return function(d,e,f){w(d,e,f,"mark_",a,b,c)}}function w(b,c,d,e,f,g,i){var j=i?[c.items]:c.items,k=c.interactive===!1?"none":null,l=b.node().childNodes,m="g"!==f,n=(n=l[d+1])?a.select(n):b.append("g").attr("id","g"+ ++D).attr("class",u(c.def)),o=n.attr("id"),p="#"+o+" > "+f,q=n.selectAll(p).data(j),r=q.enter().append(f);return m?(n.style("pointer-events",k),r.each(function(a){a.mark?a._svg=this:a.length&&(a[0]._svg=this)})):r.append("rect").attr("class","background").style("pointer-events",k),q.exit().remove(),q.each(g),m?q.each(h):n.selectAll(p+" > rect.background").each(t).each(h),n}function x(b,c,d,e){var f,g,h,i=w(b,c,d,e||"group_","g",s),j=i.node().childNodes,k=j.length;for(f=0;k>f;++f){var l=j[f].__data__.items,m=j[f].__data__.legendItems||[],n=j[f].__data__.axisItems||[],o=a.select(j[f]),p=0;for(g=0,h=n.length;h>g;++g)"back"===n[g].def.layer&&x.call(this,o,n[g],p++,"axis_");for(g=0,h=l.length;h>g;++g)this.draw(o,l[g],p++);for(g=0,h=n.length;h>g;++g)"back"!==n[g].def.layer&&x.call(this,o,n[g],p++,"axis_");for(g=0,h=m.length;h>g;++g)x.call(this,o,m[g],p++,"legend_")}}var y=a.svg.arc(),z=a.svg.area().x(b).y1(c).y0(e),A=a.svg.area().y(c).x0(d).x1(b),B=a.svg.line().x(b).y(c),C=a.svg.symbol().type(g).size(f),D=0,E=0,F={left:"start",center:"middle",right:"end"},G={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},I=H.keys(G);return{update:{group:m,area:j,line:k,arc:i,path:l,symbol:o,rect:m,rule:n,text:r,image:p},nested:{area:!0,line:!0},style:h,draw:{group:x,area:v("path",j,!0),line:v("path",k,!0),arc:v("path",i),path:v("path",l),symbol:v("path",o),rect:v("rect",m),rule:v("line",n),text:v("text",r),image:v("image",p),draw:v}}}(),H.svg.Renderer=function(){var b=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},c=b.prototype;return c.initialize=function(b,c,d,e){return this._el=b,a.select(b).select("svg.marks").remove(),this._svg=a.select(b).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(c,d,e)},c.resize=function(a,b,c){return this._width=a,this._height=b,this._padding=c,this._svg.attr("width",a+c.left+c.right).attr("height",b+c.top+c.bottom),this._ctx.attr("transform","translate("+c.left+","+c.top+")"),this},c.context=function(){return this._ctx},c.element=function(){return this._el},c.updateDefs=function(){var b,c,d=this._svg,e=this._defs,f=H.keys(e.gradient),g=H.keys(e.clipping),h=d.select("defs");return 0===f.length&&0==g.length?void h.remove():(h.empty()&&(h=d.insert("defs",":first-child")),b=h.selectAll("linearGradient").data(f,H.identity),b.enter().append("linearGradient").attr("id",H.identity),b.exit().remove(),b.each(function(b){var c=e.gradient[b],d=a.select(this);d.attr({x1:c.x1,x2:c.x2,y1:c.y1,y2:c.y2}),stop=d.selectAll("stop").data(c.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color})}),c=h.selectAll("clipPath").data(g,H.identity),c.enter().append("clipPath").attr("id",H.identity),c.exit().remove(),void c.each(function(b){var c=e.clipping[b],d=a.select(this).selectAll("rect").data([1]);d.enter().append("rect"),d.attr("x",0).attr("y",0).attr("width",c.width).attr("height",c.height)}))},c.render=function(a,b){H.svg._cur=this,b?this.renderItems(H.array(b)):this.draw(this._ctx,a,-1),this.updateDefs(),delete H.svg._cur},c.renderItems=function(a){var b,c,d,e,f,g=H.svg.marks;for(e=0,f=a.length;f>e;++e)b=a[e],c=b._svg,d=b.mark.marktype,b=g.nested[d]?b.mark.items:b,g.update[d].call(c,b),g.style.call(c,b)},c.draw=function(a,b,c){var d=b.marktype,e=H.svg.marks.draw[d];e.call(this,a,b,c)},b}(),H.svg.Handler=function(){function b(a){var b=this;return function(c){var d=c.target,e=d.__data__;e&&(e=e.mark?e:e[0],a.call(b._obj,c,e))}}function c(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var d=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},e=d.prototype;return e.initialize=function(b,c,d){return this._el=a.select(b).node(),this._svg=a.select(b).select("svg.marks").node(),this._padding=c,this._obj=d||null,this},e.padding=function(a){return this._padding=a,this},e.model=function(a){return arguments.length?(this._model=a,this):this._model},e.handlers=function(){var a=this._handlers;return H.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])},e.on=function(d,e){var f=c(d),g=this._handlers,h=a.select(this._svg).node(),i={type:d,handler:e,svg:b.call(this,e)};return g=g[f]||(g[f]=[]),g.push(i),h.addEventListener(f,i.svg),this},e.off=function(b,d){var e=c(b),f=this._handlers[e],g=a.select(this._svg).node();if(f){for(var h=f.length;--h>=0;)f[h].type===b&&(d&&f[h].handler!==d||(g.removeEventListener(e,f[h].svg),f.splice(h,1)));return this}},d}(),H.data={},H.data.ingestAll=function(a){return H.isTree(a)?f(H.data.ingestTree(a[0],a.children)):a.map(H.data.ingest)},H.data.ingest=function(a,b){return{data:a,index:b}},H.data.ingestTree=function(a,b,c){var d,e,f=H.data.ingest(a,c||0),g=a[b];if(g&&(d=g.length))for(f.values=Array(d),e=0;d>e;++e)f.values[e]=H.data.ingestTree(g[e],b,e);return f},H.data.mapper=function(a){return function(b){return b.forEach(a),b}},H.data.size=function(a,b){return a=H.isArray(a)?a:[0,a],a=a.map(function(a){return"string"==typeof a?b[a]:a})},H.data.load=function(a,b){var c=i(a)?a:H.config.baseURL+a;if(H.config.isNode){var d=j(c)?m:n;d(c,b)}else k(c,b)};var M=/^[A-Za-z]+\:\/\//,N="file://";H.data.read=function(){function c(a,b){var c=b&&b.type||"json";return a=f[c](a,b),b&&b.parse&&d(a,b.parse),a}function d(a,b){var c=H.keys(b),d=c.map(function(a){return g[b[a]]}),f=H.isTree(a);e(f?[a]:a,c,d,f)}function e(a,b,c,e){var f,g,h,i,j;for(g=0,i=a.length;i>g;++g){for(f=a[g],h=0,j=b.length;j>h;++h)f[b[h]]=c[h](f[b[h]]);e&&f.values&&d(f,b,c,!0)}}var f={},g={number:H.number,"boolean":H["boolean"],date:Date.parse};return f.json=function(a,b){var c=H.isObject(a)?a:JSON.parse(a);return b&&b.property&&(c=H.accessor(b.property)(c)),c},f.csv=function(b,c){var d=a.csv.parse(b);return d},f.tsv=function(b,c){var d=a.tsv.parse(b);return d},f.topojson=function(a,c){if(null==b)return H.error("TopoJSON library not loaded."),[];var d=H.isObject(a)?a:JSON.parse(a),e=[];return c&&c.feature?e=(e=d.objects[c.feature])?b.feature(d,e).features:(H.error("Invalid TopoJSON object: "+c.feature),[]):c&&c.mesh?e=(e=d.objects[c.mesh])?[b.mesh(d,d.objects[c.mesh])]:(H.error("Invalid TopoJSON object: "+c.mesh),[]):H.error("Missing TopoJSON feature or mesh parameter."),e},f.treejson=function(a,b){return a=H.isObject(a)?a:JSON.parse(a),H.tree(a,b.children)},c.formats=f,c.parse=d,c}(),H.data.aggregate=function(){function a(a){return a.op+"_"+a.field}function b(a){var b=e.reduce(function(b,c){return b.push(c(a)),b},[]).join("|");return j[b]||(j[b]=c(a))}function c(b){for(var c={},d=0;d<g.length;++d)c[g[d]]=e[d](b);for(c.count=0,d=0;d<h.length;++d)if("count"!==h[d].op){var f=i[h[d].op];c[a(h[d])]=f.init?f.init():0}return c}function d(c){var d,e=[],g=h.map(a),k=h.map(function(a){return i[a.op]});c.forEach(function(a){var c=b(a);c.count+=1;for(var d=0;d<h.length;++d)c[g[d]]=k[d](c,c[g[d]],f[d](a))});var l=0;for(d in j)e.push({index:l++,data:j[d]});return j={},e}var e,f,g=[],h=[],i={count:function(){},sum:function(a,b,c){return b+c},avg:function(a,b,c){return b+(c-b)/a.count},min:function(a,b,c){return b>c?c:b},max:function(a,b,c){return c>b?c:b}};i.min.init=function(){return+(1/0)},i.max.init=function(){return-(1/0)};var j={};return d.fields=function(a){return h=H.array(a),f=h.map(function(a,b){var c=a.field;return 0===c.indexOf("data.")&&(h[b]={op:a.op,field:c.slice(5)}),H.accessor(c)}),d},d.groupby=function(a){return g=H.array(a),e=g.map(function(a,b){return 0===a.indexOf("data.")&&(g[b]=a.slice(5)),H.accessor(a)}),d},d},H.data.array=function(){function a(a){return a.map(function(a){for(var c=[],d=0,e=b.length;e>d;++d)c.push(b[d](a));return c})}var b=[];return a.fields=function(c){return b=H.array(c).map(H.accessor),a},a},H.data.bin=function(){function a(a,b){return b>a?-1:a>b?1:a>=b?0:0/0}function b(b,c,d,e){for(arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);e>d;){var f=d+e>>>1;a(b[f],c)<0?d=f+1:e=f}return d}function c(a){a=a||{};var c,d,e,f,g=a.maxbins||1024,h=a.base||10,i=a.div||[5,2],j=a.minstep||0,k=Math.log(h),l=Math.ceil(Math.log(g)/k),m=a.min,n=a.max,o=n-m,p=Math.max(j,Math.pow(h,Math.round(Math.log(o)/k)-l)),q=Math.ceil(o/p);if(null!=a.step)p=a.step;else if(a.steps)p=a.steps[Math.min(a.steps.length-1,b(a.steps,o/g))];else{do p*=h,q=Math.ceil(o/p);while(q>g);for(e=0;e<i.length;++e)d=p/i[e],d>=j&&g>=o/d&&(p=d,q=Math.ceil(o/p))}return d=Math.log(p),c=d>=0?0:~~(-d/k)+1,f=Math.pow(h,-c-1),m=Math.min(m,Math.floor(m/p+f)*p),n=Math.ceil(n/p)*p,{start:m,stop:n,step:p,unit:c}}function d(a){var b={min:null!=h?h:+(1/0),max:null!=i?i:-(1/0),step:null!=j?j:null,maxbins:k};(null==h||null==i)&&a.forEach(function(a){var c=f(a);null==h&&c>b.max&&(b.max=c),null==i&&c<b.min&&(b.min=c)});var d=c(b);return a.forEach(function(a){var b=f(a);g(a,d.start+d.step*~~((b-d.start)/d.step))}),a}var e,f,g,h=void 0,i=void 0,j=void 0,k=20,l="bin";return d.min=function(a){return h=a,d},d.max=function(a){return i=a,d},d.step=function(a){return j=a,d},d.maxbins=function(a){return k=a,d},d.field=function(a){return e=a,f=H.accessor(a),d},d.output=function(a){return l=a,g=H.mutator(a),d},d},H.data.copy=function(){var a=H.accessor("data"),b=[],c=null,d=H.data.mapper(function(d){var e,f,g=a(d),h=c||b;for(e=0,f=b.length;f>e;++e)d[h[e]]=g[b[e]];return d});return d.from=function(b){return a=H.accessor(b),d},d.fields=function(a){return b=H.array(a),d},d.as=function(a){return c=H.array(a),d},d},H.data.cross=function(){function a(a){var e,f,g,h=[],i=b||a,j=a.length;for(f=0;j>f;++f)for(g=0;j>g;++g)c&&f===g||(e={},e[d.left]=a[f],e[d.right]=i[g],h.push(e));return h}var b=null,c=!1,d={left:"a",right:"b"};return a["with"]=function(c){return b=c,a},a.diagonal=function(b){return c=!b,a},a.output=function(b){return H.keys(d).forEach(function(a){void 0!==b[a]&&(d[a]=b[a])}),a},a},H.data.facet=function(){function a(a){var d,e,f,g,h,i,j,k={key:"",keys:[],values:[]},l={},m=k.values;if(0===b.length)return m.push(d={key:"",keys:[],index:0,values:c?a.slice():a}),c&&c(d.values),k;for(h=0,g=a.length;g>h;++h){for(i=0,e=[],f="";i<b.length;++i)j=b[i](a[h]),e.push(j),f+=(i>0?"|":"")+String(j);d=l[f],void 0===d&&m.push(d=l[f]={key:f,keys:e,index:m.length,values:[]}),d.values.push(a[h])}if(c)for(h=0,g=m.length;g>h;++h)c(m[h].values);return k}var b=[],c=null;return a.keys=function(c){return b=H.array(c).map(H.accessor),a},a.sort=function(b){return c=H.data.sort().by(b),a},a},H.data.filter=function(){function a(a){return b?a.filter(b):a}var b=null;return a.test=function(c){return b=H.isFunction(c)?c:H.parse.expr(c),a},a},H.data.flatten=function(){function a(a){return b(a,[])}function b(a,c){if(a.values)for(var d=0,e=a.values.length;e>d;++d)b(a.values[d],c);else c.push(a);return c}return a},H.data.fold=function(){function a(a){var e,f,g,h,i=[],j=b.length;for(f=0,h=a.length;h>f;++f)for(e=a[f],g=0;j>g;++g){var k={index:i.length,data:e.data};k[d.key]=b[g],k[d.value]=c[g](e),i.push(k)}return i}var b=[],c=[],d={key:"key",value:"value"};return a.fields=function(d){return b=H.array(d),c=b.map(H.accessor),a},a.output=function(b){return H.keys(d).forEach(function(a){void 0!==b[a]&&(d[a]=b[a])}),a},a},H.data.force=function(){function b(a,b,e){c.size(H.data.size(i,e)).nodes(a),d&&b[d]&&c.links(b[d]),c.start();for(var f=0;h>f;++f)c.tick();return c.stop(),a}var c=a.layout.force(),d=null,e=20,f=1,g=-30,h=500,i=["width","height"],j=["friction","theta","gravity","alpha"];return b.links=function(a){return d=a,b},b.size=function(a){return i=a,b},b.linkDistance=function(a){return e="number"==typeof a?a:H.accessor(a),c.linkDistance(e),b},b.linkStrength=function(a){return f="number"==typeof a?a:H.accessor(a),c.linkStrength(f),b},b.charge=function(a){return g="number"==typeof a?a:H.accessor(a),c.charge(g),b},b.iterations=function(a){return h=a,b},j.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b},H.data.force.dependencies=["links"],H.data.formula=function(){return function(){var a=null,b=H.identity,c=H.data.mapper(function(c,d,e){return a&&(c[a]=b.call(null,c,d,e)),c});return c.field=function(b){return a=b,c},c.expr=function(a){return b=H.isFunction(a)?a:H.parse.expr(a),c},c}}(),H.data.geo=function(){function b(){var b={},d="mercator",e=a.geo[d](),f=H.identity,g=H.identity,h={x:"x",y:"y"},i=H.data.mapper(function(a){var b=[g(a),f(a)],c=e(b);return a[h.x]=c[0],a[h.y]=c[1],a});return i.func=function(){return e},i.projection=function(c){if(d!==c){d=c,e=a.geo[d]();for(var f in b)e[f](b[f])}return i},c.forEach(function(a){i[a]=function(c){return b[a]=c,e[a](c),i}}),i.lon=function(a){return g=H.accessor(a),i},i.lat=function(a){return f=H.accessor(a),i},i.output=function(a){return H.keys(h).forEach(function(b){void 0!==a[b]&&(h[b]=a[b])}),a},i}var c=["center","scale","translate","rotate","precision","clipAngle"];return b.params=c,b}(),H.data.geopath=function(){var b=a.geo.path().projection(a.geo.mercator()),c="mercator",d=H.identity,e={},f={path:"path"},g=H.data.mapper(function(a){return a[f.path]=b(d(a)),a});return g.projection=function(d){if(c!==d){c=d;var f=a.geo[c]();for(var h in e)f[h](e[h]);b.projection(f)}return g},H.data.geo.params.forEach(function(a){g[a]=function(c){return e[a]=c,b.projection()[a](c),g}}),g.value=function(a){return d=H.accessor(a),g},g.output=function(a){return H.keys(f).forEach(function(b){void 0!==a[b]&&(f[b]=a[b])}),a},g},H.data.link=function(){function a(a){var b=g(a),c=h(a);return"M"+b.x+","+b.y+"L"+c.x+","+c.y}function b(a){var b=g(a),c=h(a),d=c.x-b.x,e=c.y-b.y,f=i*(d+e),j=i*(e-d);return"M"+b.x+","+b.y+"C"+(b.x+f)+","+(b.y+j)+" "+(c.x+j)+","+(c.y-f)+" "+c.x+","+c.y}function c(a){var b=g(a),c=h(a),d=(b.x+c.x)/2;return"M"+b.x+","+b.y+"C"+d+","+b.y+" "+d+","+c.y+" "+c.x+","+c.y}function d(a){var b=g(a),c=h(a),d=(b.y+c.y)/2;return"M"+b.x+","+b.y+"C"+b.x+","+d+" "+c.x+","+d+" "+c.x+","+c.y}function e(a){var b=k[f];return a.forEach(function(a){a[j.path]=b(a)}),a}var f="line",g=H.accessor("source"),h=H.accessor("target"),i=.2,j={path:"path"},k={line:a,curve:b,diagonal:c,diagonalX:c,diagonalY:d};return e.shape=function(a){return f=a,e},e.tension=function(a){return i=a,e},e.source=function(a){return g=H.accessor(a),e},e.target=function(a){return h=H.accessor(a),e},e.output=function(a){return H.keys(j).forEach(function(b){void 0!==a[b]&&(j[b]=a[b])}),e},e},H.data.pie=function(){function b(b){var c=b.map(function(a,b){return+d(a)}),i=e,j=(f-e)/a.sum(c),k=a.range(b.length);return g&&k.sort(function(a,b){return c[a]-c[b]}),k.forEach(function(a){var d;b[a].value=d=c[a],b[a][h.startAngle]=i,b[a][h.midAngle]=i+.5*d*j,b[a][h.endAngle]=i+=d*j}),b}var c=function(){return 1},d=c,e=0,f=2*Math.PI,g=!1,h={startAngle:"startAngle",endAngle:"endAngle",midAngle:"midAngle"};return b.sort=function(a){return g=a,b},b.value=function(a){return d=a?H.accessor(a):c,b},b.startAngle=function(a){return e=Math.PI*a/180,b},b.endAngle=function(a){return f=Math.PI*a/180,b},b.output=function(a){return H.keys(h).forEach(function(b){void 0!==a[b]&&(h[b]=a[b])}),b},b},H.data.slice=function(){function a(a){if(a=H.values(a),"min"===b)a=[a[H.minIndex(a,c)]];else if("max"===b)a=[a[H.maxIndex(a,c)]];else if("median"===b){var d=a.slice().sort(function(a,b){return a=c(a),b=c(b),b>a?-1:a>b?1:0});a=[a[~~(d.length/2)]]}else{var e=H.array(b);a=a.slice(e[0],e[1])}return a}var b=null,c=H.accessor("data");return a.by=function(c){return b=c,a},a.field=function(b){return c=H.accessor(b),a},a},H.data.sort=function(){function a(a){a=H.isArray(a)?a:a.values||[],a.sort(b);for(var c=0,d=a.length;d>c;++c)a[c].index=c;return a}var b=null;return a.by=function(c){return b=H.comparator(c),a},a},H.data.stack=function(){function b(a){var b=h.y0,e=h.y1,f=h.cy,g=c(a);return 0===g.length?a:(d.out(function(a,c,d){a.datum&&(a.datum[b]=c,a.datum[e]=d+c,a.datum[f]=c+d/2)})(g),a)}function c(a){var b,c,d,g,h,i,j,k,l=H.values(a),m=[],n=[];if(0===l.length)return n;for(c=0,d=l.length;d>c;++c){for(b=H.values(l[c]),g=0,h=b.length;h>g;++g)m.push({x:e(b[g]),y:f(b[g]),z:c,datum:b[g]});n.push([])}for(m.sort(function(a,b){return a.x<b.x?-1:a.x>b.x?1:a.z<b.z?-1:a.z>b.z?1:0}),k=m[0].x,c=0,g=0,i=0,d=m.length;d>i;++i){if(j=m[i],j.x!==k){for(;c<n.length;)n[c++].push({x:g,y:0});k=j.x,c=0,g+=1}for(;j.z>c;)n[c++].push({x:g,y:0});j.x=g,n[c++].push(j)}for(;c<n.length;)n[c++].push({x:g,y:0});return n}var d=a.layout.stack(),e=H.accessor("index"),f=H.accessor("data"),g=["offset","order"],h={y0:"y2",y1:"y",cy:"cy"};return b.point=function(a){return e=H.accessor(a),b},b.height=function(a){return f=H.accessor(a),b},g.forEach(function(a){b[a]=function(c){return d[a](c),b}}),b.output=function(c){return a.keys(h).forEach(function(a){void 0!==c[a]&&(h[a]=c[a])}),b},b},H.data.stats=function(){function a(a){var b,g,h,i,j=+(1/0),k=-(1/0),l=0,m=0,n=0,o=(H.isArray(a)?a:a.values||[]).map(c);for(b=0,g=o.length;g>b;++b)h=o[b],j>h&&(j=h),h>k&&(k=h),l+=h,i=h-m,m+=i/(b+1),n+=i*(h-m);n/=g-1;var p=H.isArray(a)?{}:a;if(e&&(o.sort(H.numcmp),b=o.length>>1,p[f.median]=o.length%2?o[b]:(o[b-1]+o[b])/2),p[f.count]=g,p[f.min]=j,p[f.max]=k,p[f.sum]=l,p[f.mean]=m,p[f.variance]=n,p[f.stdev]=Math.sqrt(n),d){for(o=H.isArray(a)?a:a.values,h={},h[f.count]=g,h[f.min]=j,h[f.max]=k,h[f.sum]=l,h[f.mean]=m,h[f.variance]=n,h[f.stdev]=Math.sqrt(n),e&&(h[f.median]=p[f.median]),b=0,g=o.length;g>b;++b)o[b].stats=h;H.isArray(a)&&(p=o)}return p}function b(b){return H.isArray(b)?a(b):(b.values||[]).map(a)}var c=H.accessor("data"),d=!1,e=!1,f={count:"count",min:"min",max:"max",sum:"sum",mean:"mean",variance:"variance",stdev:"stdev",median:"median"};return b.median=function(a){return e=a||!1,b},b.value=function(a){return c=H.accessor(a),b},b.assign=function(a){return d=a,b},b.output=function(a){return H.keys(f).forEach(function(b){void 0!==a[b]&&(f[b]=a[b])}),b},b},H.data.treemap=function(){function b(a,b,f){a=c.size(H.data.size(e,f)).value(d).nodes(H.isTree(a)?a:{values:a});var h=H.keys(g),i=h.length;return a.forEach(function(a){for(var b,c,d=0;i>d;++d)b=h[d],b!==g[b]&&(c=a[b],delete a[b],a[g[b]]=c)}),a}var c=a.layout.treemap().children(function(a){return a.values}),d=H.accessor("data"),e=["width","height"],f=["round","sticky","ratio","padding"],g={x:"x",y:"y",dx:"width",dy:"height"};return b.size=function(a){return e=a,b},b.value=function(a){return d=H.accessor(a),b},f.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b.output=function(a){return H.keys(g).forEach(function(b){void 0!==a[b]&&(g[b]=a[b])}),b},b},H.data.truncate=function(){var a=H.accessor("data"),b="truncate",c="right",d="...",e=!0,f=100,g=H.data.mapper(function(g){var h=H.truncate(a(g),f,c,e,d);return g[b]=h,g});return g.value=function(b){return a=H.accessor(b),g},g.output=function(a){return b=a,g},g.limit=function(a){return f=+a,g},g.position=function(a){return c=a,g},g.ellipsis=function(a){return d=a+"",g},g.wordbreak=function(a){return e=!!a,g},g},H.data.unique=function(){function a(a){return H.unique(a,b).map(function(a){var b={};return b[c]=a,b})}var b=null,c="field";return a.field=function(c){return b=H.accessor(c),a},a.as=function(b){return c=b,a},a},H.data.window=function(){function a(a){a=H.isArray(a)?a:a.values||[];var d,e,f,g=[],h=a.length-b;for(d=0;h>=d;d+=c){for(e=0,f=[];b>e;++e)f.push(a[d+e]);g.push({key:d,values:f})}return{values:g}}var b=2,c=1;return a.size=function(c){return b=c,a},a.step=function(b){return c=b,a},a},H.data.wordcloud=function(){function b(a,b,h){function j(b,d){var e,g,h,j,k,l=c.size(),m=l[0]/2,n=l[1]/2,o=H.keys(i),p=o.length;for(a.sort(function(a,b){return f(b)-f(a)}),h=0,j=b.length;j>h;++h)for(g=a[h],k=0;p>k;++k)e=o[k],g[i[e]]=b[h][e],"x"===e&&(g[i.x]+=m),"y"===e&&(g[i.y]+=n)}return c.size(H.data.size(e,h)).text(d).fontSize(f).rotate(g).words(a).on("end",j).start(),a}var c=a.layout.cloud().size([900,500]),d=H.accessor("data"),e=["width","height"],f=function(){return 14},g=function(){return 0},h=["font","fontStyle","fontWeight","padding"],i={x:"x",y:"y",size:"fontSize",font:"font",rotate:"angle"};return b.text=function(a){return d=H.accessor(a),b},b.size=function(a){return e=a,b},b.fontSize=function(a){return f=H.accessor(a),b},b.rotate=function(a){var c;return H.isObject(a)&&!Array.isArray(a)?void 0!==a.random?(c=(c=a.random)?H.array(c):[0],g=function(){return c[~~(Math.random()*c.length-1e-5)]}):void 0!==a.alternate&&(c=(c=a.alternate)?H.array(c):[0],g=function(a,b){return c[b%c.length]}):g=H.accessor(field),b},h.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b.output=function(a){return H.keys(i).forEach(function(b){void 0!==a[b]&&(i[b]=a[b])}),b},b},H.data.zip=function(){function a(a,g){var h,i,j,k,l,m=g[b],n=m.length;for(f&&(l={},m.forEach(function(a){l[f(a)]=a})),j=0,k=a.length;k>j;++j)i=a[j],i[c]=l?null!=(h=l[d(i)])?h:e:m[j%n];return a}var b=null,c="zip",d=H.accessor("data"),e=void 0,f=null;return a["with"]=function(c){return b=c,a},a["default"]=function(b){return e=b,a},a.as=function(b){return c=b,a},a.key=function(b){return d=H.accessor(b),a},a.withKey=function(b){return f=H.accessor(b),a},a},H.data.zip.dependencies=["with"],H.parse={},H.parse.axes=function(){function a(a,c,d){(a||[]).forEach(function(a,e){c[e]=c[e]||H.scene.axis(),b(a,e,c[e],d)})}function b(a,b,d,e){void 0!==a.scale&&d.scale(e[a.scale]),d.orient(a.orient||c[a.type]),d.offset(a.offset||0),d.layer(a.layer||"front"),d.grid(a.grid||!1),d.title(a.title||null),d.titleOffset(null!=a.titleOffset?a.titleOffset:H.config.axis.titleOffset),d.tickValues(a.values||null),d.tickFormat(a.format||null),d.tickSubdivide(a.subdivide||0),d.tickPadding(a.tickPadding||H.config.axis.padding);var f=[];if(void 0!==a.tickSize)for(var g=0;3>g;++g)f.push(a.tickSize);else{var h=H.config.axis.tickSize;f=[h,h,h]}if(null!=a.tickSizeMajor&&(f[0]=a.tickSizeMajor),null!=a.tickSizeMinor&&(f[1]=a.tickSizeMinor),null!=a.tickSizeEnd&&(f[2]=a.tickSizeEnd),f.length&&d.tickSize.apply(d,f),null!=a.ticks){var i=H.isArray(a.ticks)?a.ticks:[a.ticks];d.ticks.apply(d,i)}else d.ticks(H.config.axis.ticks);var j=a.properties;j&&j.ticks?(d.majorTickProperties(j.majorTicks?H.extend({},j.ticks,j.majorTicks):j.ticks),d.minorTickProperties(j.minorTicks?H.extend({},j.ticks,j.minorTicks):j.ticks)):(d.majorTickProperties(j&&j.majorTicks||{}),d.minorTickProperties(j&&j.minorTicks||{})),d.tickLabelProperties(j&&j.labels||{}),d.titleProperties(j&&j.title||{}),d.gridLineProperties(j&&j.grid||{}),d.domainProperties(j&&j.axis||{})}var c={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return a}(),H.parse.data=function(a,b){function c(a){return function(c,d){c?H.error("LOADING FAILED: "+a.url):e.load[a.name]=H.data.read(d.toString(),a.format),0===--f&&b()}}function d(a){1!==j[a]&&(j[a]||(j[a]=1,(e.source[a]||[]).forEach(d),(e.deps[a]||[]).forEach(d),j[a]=2,i.push(a)))}var e={defs:a,load:{},flow:{},deps:{},source:{},sorted:null},f=0;(a||[]).forEach(function(a){if(a.url?(f+=1,H.data.load(a.url,c(a))):a.values?e.load[a.name]=H.data.read(a.values,a.format):a.source&&(e.source[a.source]||(e.source[a.source]=[])).push(a.name),a.transform){var b=H.parse.dataflow(a);e.flow[a.name]=b,b.dependencies.forEach(function(b){(e.deps[b]||(e.deps[b]=[])).push(a.name)})}});for(var g,h=(a||[]).map(H.accessor("name")),i=[],j={};h.length;)2!==j[g=h.pop()]&&d(g);return e.sorted=i.reverse(),0===f&&setTimeout(b,1),e},H.parse.dataflow=function(a){var b=(a.transform||[]).map(H.parse.transform),c=b.length?function(a,c,d){return b.reduce(function(a,b){return b(a,c,d)},a)}:H.identity;return c.transforms=b,c.dependencies=H.keys((a.transform||[]).reduce(function(a,b){var c=H.data[b.type].dependencies;return c&&c.forEach(function(c){b[c]&&(a[b[c]]=1)}),a},{})),c},H.parse.expr=function(){var a={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},b={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan"},c=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return function(d){if(H.config.safeMode)return H.error("Safe mode: Expression parsing disabled."),H["true"];var e,f,g,h,i,j,k=d.split(c);for(i=0,j=0,g=0,h=k.length;h>g;++g){var e=k[g];"'"!==e?'"'!==e?j||i||(a[e]&&(k[g]=a[e]),b[e]&&(f=k[g+1])&&"("===f[0]&&(k[g]=b[e])):i||(j=!j):j||(i=!i)}return Function("d","index","data","return ("+k.join("")+");")}}(),H.parse.legends=function(){function a(a,c,d){(a||[]).forEach(function(a,e){c[e]=c[e]||H.scene.legend(),b(a,e,c[e],d)})}function b(a,b,c,d){c.size(a.size?d[a.size]:null),c.shape(a.shape?d[a.shape]:null),c.fill(a.fill?d[a.fill]:null),c.stroke(a.stroke?d[a.stroke]:null),a.orient&&c.orient(a.orient),null!=a.offset&&c.offset(a.offset),c.title(a.title||null),c.values(a.values||null),c.format(void 0!==a.format?a.format:null);var e=a.properties;c.titleProperties(e&&e.title||{}),c.labelProperties(e&&e.labels||{}),c.legendProperties(e&&e.legend||{}),c.symbolProperties(e&&e.symbols||{}),c.gradientProperties(e&&e.gradient||{})}return a}(),H.parse.mark=function(a){var b=a.properties,c=a.marks;if(H.keys(b).forEach(function(c){b[c]=H.parse.properties(a.type,b[c])}),a.delay&&(a.delay=H.parse.properties(a.type,{delay:a.delay})),a.from){var d=a.from.data,e=H.parse.dataflow(a.from);a.from=function(a,b,c){var f=H.scene.data(d?a[d]:null,c);return e(f,a,b)}}return c&&(a.marks=c.map(H.parse.mark)),a},H.parse.marks=function(a,b,c){return{type:"group",width:b,height:c,scales:a.scales||[],axes:a.axes||[],legends:a.legends||[],marks:(a.marks||[]).map(H.parse.mark)}},H.parse.padding=function(a){if(null==a)return"auto";if(H.isString(a))return"strict"===a?"strict":"auto";if(H.isObject(a))return a;var b=H.isNumber(a)?a:20;return{top:b,left:b,right:b,bottom:b}},H.parse.properties=function(){function a(a,d){var e,f,g,h,i="",j=H.keys(d),k={};for(i+="var o = trans ? {} : item;\n",e=0,f=j.length;f>e;++e)h=d[g=j[e]],i+=e>0?"\n  ":"  ",i+="o."+g+" = "+c(g,h)+";",k[g]=!0;k.x2&&(k.x?(i+="\n  if (o.x > o.x2) { var t = o.x; o.x = o.x2; o.x2 = t; };",i+="\n  o.width = (o.x2 - o.x);"):i+=k.width?"\n  o.x = (o.x2 - o.width);":"\n  o.x = o.x2;"),k.xc&&(i+=k.width?"\n  o.x = (o.xc - o.width/2);":"\n  o.x = o.xc;"),k.y2&&(k.y?(i+="\n  if (o.y > o.y2) { var t = o.y; o.y = o.y2; o.y2 = t; };",i+="\n  o.height = (o.y2 - o.y);"):i+=k.height?"\n  o.y = (o.y2 - o.height);":"\n  o.y = o.y2;"),k.yc&&(i+=k.height?"\n  o.y = (o.yc - o.height/2);":"\n  o.y = o.yc;"),b(a,k)&&(i+="\n  item.touch();"),i+="\n  if (trans) trans.interpolate(item, o);";try{return Function("item","group","trans",i)}catch(l){H.error(l),H.log(i)}}function b(a,b){return b.path||("area"===a||"line"===a)&&(b.x||b.x2||b.width||b.y||b.y2||b.height||b.tension||b.interpolate)}function c(a,b){if(null==b)return null;var c="fill"===a||"stroke"===a;if(c){if(b.c)return d("hcl",b.h,b.c,b.l);if(b.h||b.s)return d("hsl",b.h,b.s,b.l);if(b.l||b.a)return d("lab",b.l,b.a,b.b);if(b.r||b.g||b.b)return d("rgb",b.r,b.g,b.b)}var f="item.datum.data";if(void 0!==b.value&&(f=H.str(b.value)),null!=b.group){var g="group.datum";H.isString(b.group)&&(g=e[b.group]?"group."+b.group:"group.datum["+H.field(b.group).map(H.str).join("][")+"]");

}if(null!=b.field?H.isString(b.field)?(f="item.datum["+H.field(b.field).map(H.str).join("][")+"]",null!=b.group&&(f="this.accessor("+f+")("+g+")")):f="this.accessor(group.datum["+H.field(b.field.group).map(H.str).join("][")+"])(item.datum.data)":null!=b.group&&(f=g),null!=b.scale){var h=H.isString(b.scale)?H.str(b.scale):(b.scale.group?"group":"item")+".datum["+H.str(b.scale.group||b.scale.field)+"]";h="group.scales["+h+"]",f=h+(b.band?".rangeBand()":"("+f+")")}return f="("+(b.mult?H.number(b.mult)+" * ":"")+f+")"+(b.offset?" + "+H.number(b.offset):"")}function d(a,b,d,e){var f=b?c("",b):H.config.color[a][0],g=d?c("",d):H.config.color[a][1],h=e?c("",e):H.config.color[a][2];return"(this.d3."+a+"("+[f,g,h].join(",")+') + "")'}var e={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return a}(),H.parse.scales=function(){function b(a,b,d,e){return(a||[]).reduce(function(a,b){var f=b.name,g=f+":prev";return a[f]=c(b,a[f],d,e),a[g]=a[g]||a[f],a},b||{})}function c(a,b,c,g){var h=d(a,b),i=h.type===l?e:f,k=j(a,g),m=H.values(g.datum);return i(a,h,k,c,m),h}function d(b,c){var d=b.type||k;if(!c||d!==c.type){var e=H.config.scale[d]||a.scale[d];e||H.error("Unrecognized scale type: "+d),(c=e()).type=c.type||d,c.scaleName=b.name}return c}function e(a,b,c,d,e){var f,i,j,k,l=!1,m=a.padding||0,n=a.outerPadding||0;if(H.isObject(a.range)&&!H.isArray(a.range)&&(l=!0,k=a.range.fields||H.array(a.range),c=g(k,d,e)),i=a.sort&&!l,f=h(a,d,e,i),f&&b.domain(f),a.bandWidth){var o=a.bandWidth,p=f.length,q=c[0]||0,r=a.points?m*o:m*o*(p-1)+2*n;c=[q,q+(o*p+r)]}j="string"==typeof c[0],j||c.length>2||1===c.length||l?b.range(c):a.points?b.rangePoints(c,m):a.round||void 0===a.round?b.rangeRoundBands(c,m,n):b.rangeBands(c,m,n)}function f(b,c,d,e,f){var g,j;g=b.type===p?h(b,e,f,!1):i(b,e,f),c.domain(g),"height"===b.range&&(d=d.reverse()),c[b.round&&c.rangeRound?"rangeRound":"range"](d),b.exponent&&b.type===n&&c.exponent(b.exponent),b.clamp&&c.clamp(!0),b.nice&&(b.type===o?(j=a.time[b.nice],j||H.error("Unrecognized interval: "+j),c.nice(j)):c.nice())}function g(a,b,c){return a.reduce(function(a,d){var e=H.values(b[d.data]||c),f=H.accessor(H.isString(d.field)?d.field:"data."+H.accessor(d.field.group)(c));return H.unique(e,f,a)},[])}function h(a,b,c,d){var e,f,h=a.domain;return H.isArray(h)?e=d?h.slice():h:H.isObject(h)&&(f=h.fields||H.array(h),e=g(f,b,c)),e&&d&&e.sort(H.cmp),e}function i(b,c,d){function e(b,e,f,g){var i=H.values(c[b.data]||d),j=H.array(b.field).map(function(a){return H.isString(a)?a:"data."+H.accessor(a.group)(d)});j.forEach(function(b,c){b=H.accessor(b),e&&(h[0]=a.min([h[0],a.min(i,b)])),f&&(h[g]=a.max([h[g],a.max(i,b)]))})}var f,g,h=[null,null];return void 0!==b.domain&&(H.isArray(b.domain)?h=b.domain.slice():H.isObject(b.domain)?(f=b.domain.fields||H.array(b.domain),f.forEach(function(a){e(a,1,1,1)})):h=b.domain),g=h.length-1,void 0!==b.domainMin&&(H.isObject(b.domainMin)?(h[0]=null,f=b.domainMin.fields||H.array(b.domainMin),f.forEach(function(a){e(a,1,0,g)})):h[0]=b.domainMin),void 0!==b.domainMax&&(H.isObject(b.domainMax)?(h[g]=null,f=b.domainMax.fields||H.array(b.domainMax),f.forEach(function(a){e(a,0,1,g)})):h[g]=b.domainMax),b.type===m||b.type===o||!b.zero&&void 0!==b.zero||(h[0]=Math.min(0,h[0]),h[g]=Math.max(0,h[g])),h}function j(a,b){var c=[null,null];if(void 0!==a.range)if("string"==typeof a.range)if(q[a.range])c=[0,b[a.range]];else{if(!H.config.range[a.range])return H.error("Unrecogized range: "+a.range),c;c=H.config.range[a.range]}else if(H.isArray(a.range))c=a.range;else{if(H.isObject(a.range))return null;c=[0,a.range]}if(void 0!==a.rangeMin&&(c[0]=a.rangeMin),void 0!==a.rangeMax&&(c[c.length-1]=a.rangeMax),void 0!==a.reverse){var d=a.reverse;H.isObject(d)&&(d=H.accessor(d.field)(b.datum)),d&&(c=c.reverse())}return c}var k="linear",l="ordinal",m="log",n="pow",o="time",p="quantile",q={width:1,height:1};return b}(),H.parse.spec=function(b,c,d){function e(a){a=H.duplicate(a);var b=a.width||500,e=a.height||500,f=a.viewport||null,g={width:b,height:e,viewport:f,padding:H.parse.padding(a.padding),marks:H.parse.marks(a,b,e),data:H.parse.data(a.data,function(){c(h)})},h=d(g)}d=d||H.ViewFactory,H.isObject(b)?e(b):a.json(b,function(a,b){a?H.error(a):e(b)})},H.parse.transform=function(a){var b=H.data[a.type]();return H.keys(a).forEach(function(c){"type"!==c&&b[c](a[c])}),b},H.scene={},H.scene.GROUP="group",H.scene.ENTER=0,H.scene.UPDATE=1,H.scene.EXIT=2,H.scene.DEFAULT_DATA={sentinel:1},H.scene.data=function(a,b){var c=H.scene.DEFAULT_DATA;return a=H.values(a||b||[c]),a===c&&(a=[c]),a},H.scene.fontString=function(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:H.config.render.fontSize)+"px "+(a.font||H.config.render.font)},H.scene.Item=function(){function a(a){this.mark=a}var b=a.prototype;return b.hasPropertySet=function(a){var b=this.mark.def.properties;return b&&null!=b[a]},b.cousin=function(a,b){if(0===a)return this;a=a||-1;var c=this.mark,d=c.group,e=null==b?c.items.indexOf(this):b,f=d.items.indexOf(c)+a;return d.items[f].items[e]},b.sibling=function(a){if(0===a)return this;a=a||-1;var b=this.mark,c=b.items.indexOf(this)+a;return b.items[c]},b.remove=function(){var a=this,b=a.mark.items,c=b.indexOf(a);return c>=0&&(c===b.length-1?b.pop():b.splice(c,1)),a},b.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},a}(),H.scene.item=function(a){return new H.scene.Item(a)},H.scene.visit=function(a,b){var c,d,e,f,g;if(b(a))return!0;var h=["items","axisItems","legendItems"];for(e=0,f=h.length;f>e;++e)if(g=a[h[e]])for(c=0,d=g.length;d>c;++c)if(H.scene.visit(g[c],b))return!0},H.scene.build=function(){function b(a,b,g,i,j){var k=H.scene.data(a.from?a.from(b,g,i):null,i);return g=c(a,g),g.items=d(a,k,g),f(a,g),a.type===h&&e(a,b,g,j),g}function c(a,b){return b=b||{},b.def=a,b.marktype=a.type,b.interactive=!(a.interactive===!1),b}function d(a,b,c){var d,e,f,h,l,m,n=g(a.key),o=c.items||[],p=[],q={};for(d=0,f=o.length;f>d;++d)h=o[d],h.status=k,n&&(q[h.key]=h);for(d=0,f=b.length;f>d;++d)l=b[d],e=d,h=n?q[e=n(l)]:o[d],m=h?!1:(h=H.scene.item(c),!0),h.status=m?i:j,h.datum=l,h.key=e,p.push(h);for(d=0,f=o.length;f>d;++d)h=o[d],h.status===k&&(h.key=n?h.key:p.length,p.splice(h.index,0,h));return p}function e(a,c,d,e){var f,g,h,i,j,k,l=d.items,m=a.marks;for(f=0,g=l.length;g>f;++f){if(k=l[f],!e&&k.scales)for(j in k.scales)j.indexOf(":prev")<0&&(k.scales[j+":prev"]=k.scales[j].copy());for(k.items=k.items||[],h=0,i=m.length;i>h;++h)k.items[h]=b(m[h],c,k.items[h],k.datum),k.items[h].group=k}}function f(b,c){if(b.duration&&(c.duration=b.duration),b.ease&&(c.ease=a.ease(b.ease)),b.delay){var d,e=c.items,f=c.group,g=e.length;for(d=0;g>d;++d)b.delay.call(this,e[d],f)}}function g(a){if(null==a)return null;var b=H.array(a).map(H.accessor);return function(a){for(var c="",d=0,e=b.length;e>d;++d)d>0&&(c+="|"),c+=String(b[d](a));return c}}var h=H.scene.GROUP,i=H.scene.ENTER,j=H.scene.UPDATE,k=H.scene.EXIT;return b}(),H.scene.bounds=function(){function b(){return w||(w=(H.config.isNode?new(require("canvas"))(1,1):a.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node()).getContext("2d"))}function c(a,b,c){return null==b?c.set(0,0,0,0):(q(b,c),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&c.expand(a.strokeWidth)),c}function d(a,b){var d=a.path?a.pathCache||(a.pathCache=p(a.path)):null;return c(a,d,b)}function e(a,b){var d=a.mark.items,a=d[0],e=a.pathCache||(a.pathCache=p(r(d)));return c(d[0],e,b)}function f(a,b){var d=a.mark.items,a=d[0],e=a.pathCache||(a.pathCache=p(s(d)));return c(d[0],e,b)}function g(a,b){var c=a.x||0,d=a.y||0,e=c+a.width||0,f=d+a.height||0;return b.set(c,d,e,f),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function h(a,b){var c=a.width||0,d=a.height||0,e=(a.x||0)-("center"===a.align?c/2:"right"===a.align?c:0),f=(a.y||0)-("middle"===a.baseline?d/2:"bottom"===a.baseline?d:0);return b.set(e,f,e+c,f+d)}function i(a,b){var c,d;return b.set(c=a.x||0,d=a.y||0,null!=a.x2?a.x2:c,null!=a.y2?a.y2:d),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function j(a,b){var c,d,e,f,g,h,i,j,k,l=a.x||0,m=a.y||0,n=a.innerRadius||0,o=a.outerRadius||0,p=(a.startAngle||0)-t,q=(a.endAngle||0)-t,r=1/0,s=-(1/0),u=1/0,v=-(1/0),w=[p,q],x=p-p%t;for(d=0;4>d&&q>x;++d,x+=t)w.push(x);for(d=0,e=w.length;e>d;++d)c=w[d],f=Math.cos(c),h=n*f,j=o*f,g=Math.sin(c),i=n*g,k=o*g,r=Math.min(r,h,j),s=Math.max(s,h,j),u=Math.min(u,i,k),v=Math.max(v,i,k);return b.set(l+r,m+u,l+s,m+v),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function k(a,b){var c,d,e,f,g=null!=a.size?a.size:100,h=a.x||0,i=a.y||0;switch(a.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,b.set(h-d,i-c,h+d,i+c);break;case"diamond":f=Math.sqrt(g/(2*v)),e=f*v,b.set(h-e,i-f,h+e,i+f);break;case"square":d=Math.sqrt(g),c=d/2,b.set(h-c,i-c,h+c,i+c);break;case"triangle-down":e=Math.sqrt(g/u),f=e*u/2,b.set(h-e,i-f,h+e,i+f);break;case"triangle-up":e=Math.sqrt(g/u),f=e*u/2,b.set(h-e,i-f,h+e,i+f);break;default:c=Math.sqrt(g/Math.PI),b.set(h-c,i-c,h+c,i+c)}return a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function l(a,c,d){var e,f,g=(a.x||0)+(a.dx||0),h=(a.y||0)+(a.dy||0),i=a.fontSize||H.config.render.fontSize,j=a.align,k=a.baseline,l=a.radius||0,m=b();return m.font=H.scene.fontString(a),m.textAlign=j||"left",m.textBaseline=k||"alphabetic",e=m.measureText(a.text||"").width,l&&(f=(a.theta||0)-Math.PI/2,g+=l*Math.cos(f),h+=l*Math.sin(f)),"center"===j?g-=e/2:"right"===j&&(g-=e),"top"===k?h+=i/5:"bottom"===k?h-=i:"middle"===k?h=h-i/2+i/10:h-=4*i/5,c.set(g,h,g+e,h+i),a.angle&&!d&&c.rotate(a.angle*Math.PI/180,a.x||0,a.y||0),c.expand(d?0:1)}function m(a,b,c){var d,e,f=a.axisItems||[],g=a.legendItems||[];for(d=0,e=f.length;e>d;++d)b.union(f[d].bounds);for(d=0,e=a.items.length;e>d;++d)b.union(a.items[d].bounds);if(c){for(d=0,e=g.length;e>d;++d)b.union(g[d].bounds);null!=a.width&&null!=a.height&&b.add(a.width,a.height),null!=a.x&&null!=a.y&&b.add(0,0)}return b.translate(a.x||0,a.y||0),b}function n(a,b,c){b=b||x[a.mark.marktype],a.bounds_prev||(a["bounds:prev"]=new H.Bounds);var d=a.bounds,e=a["bounds:prev"];return d&&e.clear().union(d),a.bounds=b(a,d?d.clear():new H.Bounds,c),d||e.clear().union(a.bounds),a.bounds}function o(a,b,c){b=b||a.bounds&&a.bounds.clear()||new H.Bounds;var d,e,f=a.marktype,g=x[f],h=a.items;if("area"===f||"line"===f)h.length&&(h[0].bounds=g(h[0],b));else for(d=0,e=h.length;e>d;++d)b.union(n(h[d],g,c));a.bounds=b}var p=H.canvas.path.parse,q=H.canvas.path.bounds,r=H.canvas.path.area,s=H.canvas.path.line,t=Math.PI/2,u=Math.sqrt(3),v=Math.tan(30*Math.PI/180),w=null,x={group:m,symbol:k,image:h,rect:g,rule:i,arc:j,text:l,path:d,area:e,line:f};return{mark:o,item:n,text:l,group:m}}(),H.scene.encode=function(){function a(a,d,e,f,g){return f&&g?b.call(this,a,d,e,f,g):c.call(this,a,a,d,e,f),a}function b(a,b,c,d,e){e=H.array(e);var f,g,h,i,j,k;for(f=0,g=e.length;g>f;++f)h=e[f],i=h.mark.group||null,j=h.mark.def.properties,k=j&&j[d],k&&(k.call(H,h,i,c),H.scene.bounds.item(h))}function c(a,b,c,d,h){f.call(this,a,b.items,c,d,h),b.marktype===g?e.call(this,b,c,a,d,h):H.scene.bounds.mark(b)}function d(a,b,c,d,g){e.call(this,b,c,a,d,g),f.call(this,a,b.items,c,d,g),H.scene.bounds.mark(b,null,!0)}function e(a,b,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s;for(h=0,i=a.items.length;i>h;++h)for(l=a.items[h],m=l.scales||(l.scales=b.scales?H.extend({},e.scales):e.scales),b.scales&&H.parse.scales(b.scales,m,this._data,l),b.axes&&(n=l.axes||(l.axes=[]),o=l.axisItems||(l.axisItems=[]),H.parse.axes(b.axes,n,l.scales),n.forEach(function(a,b){p=a.def(),o[b]=H.scene.build(p,this._data,o[b],null,1),o[b].group=l,c.call(this,l,l.axisItems[b],p,f)})),j=0,k=l.items.length;k>j;++j)c.call(this,l,l.items[j],b.marks[j],f,g);if(H.scene.bounds.mark(a,null,!b.legends),b.legends){for(h=0,i=a.items.length;i>h;++h)l=a.items[h],q=l.legends||(l.legends=[]),r=l.legendItems||(l.legendItems=[]),H.parse.legends(b.legends,q,l.scales),q.forEach(function(a,b){s=a.def(),r[b]=H.scene.build(s,this._data,r[b],null,1),r[b].group=l,d.call(this,l,l.legendItems[b],s,f)});H.scene.bounds.mark(a,null,!0)}}function f(a,b,c,d,e){var f,g,l,m,n=c.properties||k,o=n.enter,p=n.update,q=n.exit;if(e){if(m=n[e])for(f=0,g=b.length;g>f;++f)m.call(H,b[f],a,d)}else for(f=0;f<b.length;++f)l=b[f],l.status===h&&(o&&o.call(H,l,a),l.status=i),l.status!==j&&p&&p.call(H,l,a,d),l.status===j&&(q&&q.call(H,l,a,d),d&&!q?d.interpolate(l,k):d||b[f--].remove())}var g=H.scene.GROUP,h=H.scene.ENTER,i=H.scene.UPDATE,j=H.scene.EXIT,k={};return a}(),H.scene.Transition=function(){function b(b,c){this.duration=b||500,this.ease=c&&a.ease(c)||a.ease("cubic-in-out"),this.updates={next:null}}function c(a){for(var b,c,d,e,f,g,h=this.updates,i=h,j=i.next,k=this.duration,l=!0;null!=j;i=j,j=i.next)if(b=j.item,c=b.delay||0,d=(a-c)/k,0>d)l=!1;else{for(d>1&&(d=1),e=j.ease(d),f=0,g=j.length;g>f;++f)b[j[f].property]=j[f](e);b.touch(),H.scene.bounds.item(b),1===d?(j.remove&&b.remove(),i.next=j.next,j=i):l=!1}return this.callback(),l}var d=b.prototype,e={text:1,url:1};return d.interpolate=function(b,c){var d,f,g,h,i=null;for(d in c)f=b[d],g=c[d],f!==g&&(e[d]||void 0===f?b[d]=g:"number"!=typeof f||isFinite(f)?(h=a.interpolate(f,g),h.property=d,(i||(i=[])).push(h)):b[d]=g);return null===i&&b.status===H.scene.EXIT&&(i=[]),null!=i&&(i.item=b,i.ease=b.mark.ease||this.ease,i.next=this.updates.next,this.updates.next=i),this},d.start=function(b){for(var d=this,e=d.updates,f=e.next;null!=f;e=f,f=e.next)f.item.status===H.scene.EXIT&&(f.remove=!0);d.callback=b,a.timer(function(a){return c.call(d,a)})},b}(),H.scene.transition=function(a,b){return new H.scene.Transition(a,b)},H.scene.axis=function(){function b(){h=null}function c(a){var b,c,d;"ordinal"===a.type?(b={scale:a.scaleName,offset:.5+a.rangeBand()/2},c=b):(b={scale:a.scaleName,offset:.5},c={scale:a.scaleName+":prev",offset:.5}),d=q(a);var f=w(),h=w(),i=w(),j=x(),k=z(),o=y();f.properties.enter.stroke={value:H.config.axis.gridColor},s(e,f,c,b,1/0),s(e,h,c,b,l),s(e,i,c,b,m),r(e,j,c,b,l,p),u(e,k,d,n),t(e,o,d,g),H.extend(f.properties.update,F),H.extend(h.properties.update,I),H.extend(i.properties.update,J),H.extend(j.properties.update,G),H.extend(k.properties.update,L),H.extend(o.properties.update,K);var A=[f,h,i,j,k,o];return{type:"group",interactive:!1,properties:{enter:v,update:v},marks:A.map(H.parse.mark)}}var d,e=H.config.axis.orient,f=0,g=H.config.axis.titleOffset,h=null,i="front",j=!1,k=null,l=H.config.axis.tickSize,m=H.config.axis.tickSize,n=H.config.axis.tickSize,p=H.config.axis.padding,A=null,B=null,C=null,D=0,E=[H.config.axis.ticks],F={},G={},I={},J={},K={},L={},M={};return M.def=function(){var b=h?h:h=c(d);C=B?"time"===d.type?a.time.format(B):a.format(B):null;var g=null==A?d.ticks?d.ticks.apply(d,E):d.domain():A,l=o(d,g,D).map(H.data.ingest);g=g.map(H.data.ingest);var m=null==C?d.tickFormat?d.tickFormat.apply(d,E):String:C;g.forEach(function(a){a.label=m(a.data)});var n=k?[k].map(H.data.ingest):[];return b.marks[0].from=function(){return j?g:[]},b.marks[1].from=function(){return g},b.marks[2].from=function(){return l},b.marks[3].from=b.marks[1].from,b.marks[4].from=function(){return[1]},b.marks[5].from=function(){return n},b.offset=f,b.orient=e,b.layer=i,b},M.scale=function(a){return arguments.length?(d!==a&&(d=a,b()),M):d},M.orient=function(a){return arguments.length?(e!==a&&(e=a in O?a+"":H.config.axis.orient,b()),M):e},M.title=function(a){return arguments.length?(k!==a&&(k=a,b()),M):k},M.ticks=function(){return arguments.length?(E=arguments,M):E},M.tickValues=function(a){return arguments.length?(A=a,M):A},M.tickFormat=function(a){return arguments.length?(B!==a&&(B=a,b()),M):B},M.tickSize=function(a,c){if(!arguments.length)return l;var d=arguments.length-1,e=+a,f=d>1?+c:l,g=d>0?+arguments[d]:l;return(l!==e||m!==f||n!==g)&&b(),l=e,m=f,n=g,M},M.tickSubdivide=function(a){return arguments.length?(D=+a,M):D},M.offset=function(a){return arguments.length?(f=H.isObject(a)?a:+a,M):f},M.tickPadding=function(a){return arguments.length?(p!==+a&&(p=+a,b()),M):p},M.titleOffset=function(a){return arguments.length?(g!==+a&&(g=+a,b()),M):g},M.layer=function(a){return arguments.length?(i!==a&&(i=a,b()),M):i},M.grid=function(a){return arguments.length?(j!==a&&(j=a,b()),M):j},M.gridLineProperties=function(a){return arguments.length?(F!==a&&(F=a),M):F},M.majorTickProperties=function(a){return arguments.length?(I!==a&&(I=a),M):I},M.minorTickProperties=function(a){return arguments.length?(J!==a&&(J=a),M):J},M.tickLabelProperties=function(a){return arguments.length?(G!==a&&(G=a),M):G},M.titleProperties=function(a){return arguments.length?(K!==a&&(K=a),M):K},M.domainProperties=function(a){return arguments.length?(L!==a&&(L=a),M):L},M.reset=function(){b()},M};var O={top:1,right:1,bottom:1,left:1},P={bottom:"center",top:"center",left:"right",right:"left"},Q={bottom:"top",top:"bottom",left:"middle",right:"middle"};H.scene.legend=function(){function b(){h=null}function c(a){return"ordinal"===a||"quantize"===a||"quantile"===a||"threshold"===a}function d(b){var c,d,f,g=e(i,j,k,l),h=(null==n?b.ticks?b.ticks.apply(b,u):b.domain():n).map(H.data.ingest),p=null==o?b.tickFormat?b.tickFormat.apply(b,u):String:o,r=5,s=a.range(h.length);i?(d=h.map(function(a){return Math.sqrt(i(a.data))}),f=a.max(d),d=d.reduce(function(a,b,c,d){return c>0&&(a[c]=a[c-1]+d[c-1]/2+r),a[c]+=b/2,a},[0]).map(Math.round)):(f=Math.round(Math.sqrt(H.config.legend.symbolSize)),d=m||(c=z.fontSize)&&c.value+r||H.config.legend.labelFontSize+r,d=s.map(function(a,b){return Math.round(f/2+b*d)}));var v,w=t;q&&(v=y.fontSize,w+=5+(v&&v.value||H.config.legend.titleFontSize));for(var x=0,A=d.length;A>x;++x)d[x]+=w;var b={name:"legend",type:"ordinal",points:!0,domain:s,range:d},B=(q?[q]:[]).map(H.data.ingest);return h.forEach(function(a){a.label=p(a.data),a.offset=f}),g.scales=[b],g.marks[0].from=function(){return B},g.marks[1].from=function(){return h},g.marks[2].from=g.marks[1].from,g}function e(a,b,c,d){var e=C(),f=D(),g=E();return B(f,a,b,c,d),H.extend(e.properties.update,y),H.extend(f.properties.update,w),H.extend(g.properties.update,z),e.properties.enter.x.value+=t,e.properties.enter.y.value+=t,g.properties.enter.x.offset+=t+1,f.properties.enter.x.offset=t+1,g.properties.update.x.offset+=t+1,f.properties.update.x.offset=t+1,{type:"group",interactive:!1,properties:{enter:H.parse.properties("group",v),update:A},marks:[e,f,g].map(H.parse.mark)}}function f(a){var b=g(a),c=a.domain(),d=c.map(H.data.ingest),e=x.width&&x.width.value||H.config.legend.gradientWidth,f=null==o?a.tickFormat?a.tickFormat.apply(a,u):String:o,h={name:"legend",type:a.type,round:!0,zero:!1,domain:[c[0],c[c.length-1]],range:[t,e+t]};"pow"===a.type&&(h.exponent=a.exponent());var i=(q?[q]:[]).map(H.data.ingest);return d.forEach(function(a,b){a.label=f(a.data),a.align=b==d.length-1?"right":0==b?"left":"center"}),b.scales=[h],b.marks[0].from=function(){return i},b.marks[1].from=function(){return[1]},b.marks[2].from=function(){return d},b}function g(a){var b=C(),c=F(),d=G(),e=new H.Gradient,f=a.domain(),g=f[0],h=f[f.length-1],i=a.copy().domain([g,h]).range([0,1]),j="linear"!==a.type&&a.ticks?a.ticks.call(a,15):f;g!==j[0]&&j.unshift(g),h!==j[j.length-1]&&j.push(h);for(var k=0,l=j.length;l>k;++k)e.stop(i(j[k]),a(j[k]));c.properties.enter.fill={value:e},H.extend(b.properties.update,y),H.extend(c.properties.update,x),H.extend(d.properties.update,z);var m=c.properties,n=x.height,o=n&&n.value||m.enter.height.value;if(d.properties.enter.y.value=o,d.properties.update.y.value=o,q){var p=b.properties,r=y.fontSize,s=4+(r&&r.value||p.enter.fontSize.value);c.properties.enter.y.value+=s,d.properties.enter.y.value+=s,c.properties.update.y.value+=s,d.properties.update.y.value+=s}return b.properties.enter.x.value+=t,b.properties.enter.y.value+=t,c.properties.enter.x.value+=t,c.properties.enter.y.value+=t,d.properties.enter.y.value+=t,c.properties.update.x.value+=t,c.properties.update.y.value+=t,d.properties.update.y.value+=t,{type:"group",interactive:!1,properties:{enter:H.parse.properties("group",v),update:A},marks:[b,c,d].map(H.parse.mark)}}var h,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=void 0,r="right",s=H.config.legend.offset,t=H.config.legend.padding,u=[5],v={},w={},x={},y={},z={},I={},h=null;return I.def=function(){var b=i||j||k||l;return o=p?"time"===b.type?a.time.format(p):a.format(p):null,h||(h=b!==k&&b!==l||c(b.type)?d(b):f(b)),h.orient=r,h.offset=s,h.padding=t,h},I.size=function(a){return arguments.length?(i!==a&&(i=a,b()),I):i},I.shape=function(a){return arguments.length?(j!==a&&(j=a,b()),I):j},I.fill=function(a){return arguments.length?(k!==a&&(k=a,b()),I):k},I.stroke=function(a){return arguments.length?(l!==a&&(l=a,b()),I):l},I.title=function(a){return arguments.length?(q!==a&&(q=a,b()),I):q},I.format=function(a){return arguments.length?(p!==a&&(p=a,b()),I):p},I.spacing=function(a){return arguments.length?(m!==+a&&(m=+a,b()),I):m},I.orient=function(a){return arguments.length?(r=a in R?a+"":H.config.legend.orient,I):r},I.offset=function(a){return arguments.length?(s=+a,I):s},I.values=function(a){return arguments.length?(n=a,I):n},I.legendProperties=function(a){return arguments.length?(v=a,I):v},I.symbolProperties=function(a){return arguments.length?(w=a,I):w},I.gradientProperties=function(a){return arguments.length?(x=a,I):x},I.labelProperties=function(a){return arguments.length?(z=a,I):z},I.titleProperties=function(a){return arguments.length?(y=a,I):y},I.reset=function(){b()},I};var R={right:1,left:1};return H.Model=function(){function a(){this._defs=null,this._data={},this._scene=null,this._reset={axes:!1,legends:!1}}var b=a.prototype;return b.defs=function(a){return arguments.length?(this._defs=a,this):this._defs},b.data=function(a){function b(a){(j[a]||[]).forEach(function(c){g[c]=a,b(c)})}if(!arguments.length)return this._data;var c,d,e,g={},i=this._defs,j=i.data.source,k=i.data.flow||{},l=i.data.sorted,m=l.length;for(H.keys(a).forEach(b),c=0;m>c;++c){if(a[d=l[c]])e=a[d];else{if(!g[d])continue;e=h(this._data[g[d]]),H.isTree(a)&&f(e)}this._data[d]=k[d]?k[d](e,this._data,i.marks):e}return this._reset.legends=!0,this},b.width=function(a){return this._defs&&(this._defs.width=a),this._defs&&this._defs.marks&&(this._defs.marks.width=a),this._scene&&(this._scene.items[0].width=a),this._reset.axes=!0,this},b.height=function(a){return this._defs&&(this._defs.height=a),this._defs&&this._defs.marks&&(this._defs.marks.height=a),this._scene&&(this._scene.items[0].height=a),this._reset.axes=!0,this},b.scene=function(a){return arguments.length?(this._scene=a,this):this._scene},b.build=function(){var a=this,b=a._data,c=a._defs.marks;return a._scene=H.scene.build.call(a,c,b,a._scene),a._scene.items[0].width=c.width,a._scene.items[0].height=c.height,a._scene.interactive=!1,this},b.encode=function(a,b,c){this.reset();var d=this,e=d._scene,f=d._defs;return H.scene.encode.call(d,e,f.marks,a,b,c),this},b.reset=function(){return this._scene&&this._reset.axes&&(H.scene.visit(this._scene,function(a){a.axes&&a.axes.forEach(function(a){a.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(H.scene.visit(this._scene,function(a){a.legends&&a.legends.forEach(function(a){a.reset()})}),this._reset.legends=!1),this},a}(),H.View=function(){var b=function(a,b,c){this._el=null,this._build=!1,this._model=new H.Model,this._width=this.__width=b||500,this._height=this.__height=c||500,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=H.canvas,a&&this.initialize(a)},c=b.prototype;return c.width=function(a){return arguments.length?(this.__width!==a&&(this._width=this.__width=a,this._el&&this.initialize(this._el.parentNode),this._model.width(a),this._strict&&(this._autopad=1)),this):this.__width},c.height=function(a){return arguments.length?(this.__height!==a&&(this._height=this.__height=a,this._el&&this.initialize(this._el.parentNode),this._model.height(this._height),this._strict&&(this._autopad=1)),this):this.__height},c.padding=function(a){return arguments.length?(this._padding!==a&&(H.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,a),this._handler.padding(a))),this):this._padding},c.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this.model().scene().bounds,d=H.config.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,g=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:g,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+g)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},c.viewport=function(a){return arguments.length?(this._viewport!==a&&(this._viewport=a,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},c.renderer=function(a){return arguments.length?("canvas"===a&&(a=H.canvas),"svg"===a&&(a=H.svg),this._io!==a&&(this._io=a,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},c.defs=function(a){return arguments.length?(this._model.defs(a),this):this._model.defs()},c.data=function(a){if(!arguments.length)return this._model.data();var b=H.keys(a).reduce(function(b,c){return b[c]=H.data.ingestAll(a[c]),b},{});return this._model.data(b),this._build=!1,this},c.model=function(a){return arguments.length?(this._model!==a&&(this._model=a,this._handler&&this._handler.model(a)),this):this._model},c.initialize=function(b){var c,d=this,e=d._width,f=d._height,g=d._padding;return a.select(b).select("div.vega").remove(),this._el=b=a.select(b).append("div").attr("class","vega").style("position","relative").node(),d._viewport&&a.select(b).style("width",(d._viewport[0]||e)+"px").style("height",(d._viewport[1]||f)+"px").style("overflow","auto"),d._renderer=(d._renderer||new this._io.Renderer).initialize(b,e,f,g),c=d._handler,d._handler=(new this._io.Handler).initialize(b,g,d).model(d._model),c&&c.handlers().forEach(function(a){d._handler.on(a.type,a.handler)}),this},c.render=function(a){return this._renderer.render(this._model.scene(),a),this},c.on=function(){return this._handler.on.apply(this._handler,arguments),this},c.off=function(){return this._handler.off.apply(this._handler,arguments),this},c.update=function(a){a=a||{};var b=this,c=a.duration?H.scene.transition(a.duration,a.ease):null;return b._build=b._build||(b._model.build(),!0),b._model.encode(c,a.props,a.items),c?c.start(function(a){b._renderer.render(b._model.scene(),a)}):b.render(a.items),b.autopad(a)},b}(),H.ViewFactory=function(a){return function(b){b=b||{};var c=(new H.View).width(a.width).height(a.height).padding(a.padding).viewport(a.viewport).renderer(b.renderer||"canvas").defs(a);return a.data.load&&c.data(a.data.load),b.data&&c.data(b.data),b.el&&c.initialize(b.el),b.hover!==!1&&c.on("mouseover",function(a,b){b.hasPropertySet("hover")&&this.update({props:"hover",items:b})}).on("mouseout",function(a,b){b.hasPropertySet("hover")&&this.update({props:"update",items:b})}),c}},H.Spec=function(){var a=function(a){this.spec={width:500,height:500,padding:0,data:[],scales:[],axes:[],marks:[]},a&&H.extend(this.spec,a)},b=a.prototype;return b.width=function(a){return this.spec.width=a,this},b.height=function(a){return this.spec.height=a,this},b.padding=function(a){return this.spec.padding=a,this},b.viewport=function(a){return this.spec.viewport=a,this},b.data=function(a,b){return b?b.name=a:b=H.isString(a)?{name:a}:a,this.spec.data.push(b),this},b.scale=function(a,b){return b?b.name=a:b=H.isString(a)?{name:a}:a,this.spec.scales.push(b),this},b.axis=function(a){return this.spec.axes.push(a),this},b.mark=function(a,b){b?b.type=a:b={type:a},b.properties={},this.spec.marks.push(b);var c=this;return{from:function(a,c){return b.from=c?(c.data=a,c):H.isString(a)?{data:a}:a,this},prop:function(a,c){return b.properties[a]=H.keys(c).reduce(function(a,b){var d=c[b];return a[b]=H.isObject(d)?d:{value:d},a},{}),this},done:function(){return c}}},b.parse=function(a){H.parse.spec(this.spec,a)},b.json=function(){return this.spec},a}(),H.spec=function(a){return new H.Spec(a)},H.headless={},H.headless.View=function(){var b=function(a,b,c,d,e){this._canvas=null,this._type=d,this._el="body",this._build=!1,this._model=new H.Model,this._width=this.__width=a||500,this._height=this.__height=b||500,this._padding=c||{top:0,left:0,bottom:0,right:0},this._autopad=H.isString(this._padding)?1:0,this._renderer=new H[d].Renderer,this._viewport=e||null,this.initialize()},c=b.prototype;return c.el=function(a){return arguments.length?(this._el!==a&&(this._el=a,this.initialize()),this):this._el},c.width=function(a){return arguments.length?(this._width!==a&&(this._width=a,this.initialize(),this._model.width(a)),this):this._width},c.height=function(a){return arguments.length?(this._height!==a&&(this._height=a,this.initialize(),this._model.height(this._height)),this):this._height},c.padding=function(a){return arguments.length?(this._padding!==a&&(H.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this.initialize()),this):this._padding},c.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this._model.scene().bounds,d=H.config.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,g=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:g,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+g)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},c.viewport=function(a){return arguments.length?(this._viewport=a,this.initialize(),this):_viewport},c.defs=function(a){return arguments.length?(this._model.defs(a),this):this._model.defs()},c.data=function(a){if(!arguments.length)return this._model.data();var b=H.keys(a).reduce(function(b,c){return b[c]=H.data.ingestAll(a[c]),b},{});return this._model.data(b),this._build=!1,this},c.renderer=function(){return this._renderer},c.canvas=function(){return this._canvas},c.canvasAsync=function(a){function b(){0===c.pendingImages()?(d.render(),a(d._canvas)):setTimeout(b,10)}var c=this._renderer,d=this;c.pendingImages()>0?b():a(this._canvas)},c.svg=function(){if("svg"!==this._type)return null;var b=this._padding,c=this._width+(b?b.left+b.right:0),d=this._height+(b?b.top+b.bottom:0);this._viewport&&(c=this._viewport[0]-(b?b.left+b.right:0),d=this._viewport[1]-(b?b.top+b.bottom:0));var e=a.select(this._el).select("svg").node().innerHTML.replace(/ href=/g," xlink:href=");return'<svg width="'+c+'" height="'+d+'" '+H.config.svgNamespace+">"+e+"</svg>"},c.initialize=function(){var a=this._width,b=this._height,c=this._padding;return this._viewport&&(a=this._viewport[0]-(c?c.left+c.right:0),b=this._viewport[1]-(c?c.top+c.bottom:0)),"svg"===this._type?this.initSVG(a,b,c):this.initCanvas(a,b,c),this},c.initCanvas=function(a,b,c){var d=require("canvas"),e=a+c.left+c.right,f=b+c.top+c.bottom,g=this._canvas=new d(e,f),h=g.getContext("2d");h.setTransform(1,0,0,1,c.left,c.top),this._renderer.context(h),this._renderer.resize(a,b,c)},c.initSVG=function(a,b,c){a+c.left+c.right,b+c.top+c.bottom;this._renderer.initialize(this._el,a,b,c)},c.render=function(a){
return this._renderer.render(this._model.scene(),a),this},c.update=function(a){a=a||{};var b=this;return b._build=b._build||(b._model.build(),!0),b._model.encode(null,a.props,a.items),b.render(a.items),b.autopad(a)},b}(),H.headless.View.Factory=function(a){return function(b){b=b||{};var c=a.width,d=a.height,e=a.padding,f=a.viewport,g=b.renderer||"canvas",h=new H.headless.View(c,d,e,g,f).defs(a);return a.data.load&&h.data(a.data.load),b.data&&h.data(b.data),h}},H.headless.render=function(a,b){function c(c){try{var d=c({data:a.data,renderer:a.renderer}).update();"svg"===a.renderer?b(null,{svg:d.svg()}):d.canvasAsync(function(a){b(null,{canvas:a})})}catch(e){b(e,null)}}H.parse.spec(a.spec,c,H.headless.View.Factory)},H}),function(b){function c(a){var b=a.filter(function(a,b,c){return b==c.indexOf(a)});return b}function d(a,b,d,e,f){for(var g=[],h=[],i=[],j=0;j<a.data.length;j++)h[j]=a.data[j][b],i[j]=a.data[j][d];for(var k=c(i),l=c(h),m=[],j=0;j<l.length;j++){g[j]=[],m[j]=[],g[j][0]=l[j];for(var n=0;n<k.length;n++){switch(e){case"max":g[j][n+1]=Number.MIN_VALUE;break;case"min":g[j][n+1]=Number.MAX_VALUE;break;default:g[j][n+1]=0}m[j][n+1]=0}}var o,p;for(j=0;j<a.data.length;j++){var q=a.data[j][b],r=a.data[j][d],s=a.data[j][f];m[l.indexOf(q)][1+k.indexOf(r)]++,o=g[l.indexOf(q)][1+k.indexOf(r)],p=m[l.indexOf(q)][1+k.indexOf(r)];var t=0;switch(e){case"sum":t=o+s;break;case"min":t=o>s?s:o;break;case"max":t=s>o?s:o;break;case"avg":t=(o*(p-1)+s)/p;break;case"count":t=p}g[l.indexOf(q)][1+k.indexOf(r)]=t}var u={};for(u.metadata={},u.metadata.names=[],u.metadata.types=[],u.data=g,u.metadata.names[0]=a.metadata.names[b]+" \\ "+a.metadata.names[d],u.metadata.types[0]="C",j=0;j<k.length;j++)u.metadata.names[j+1]=k[j],u.metadata.types[j+1]="N";return console.log(u),u}function e(a,b,d){for(var e=[],f=[],g=[],h=0;h<a.data.length;h++)g[h]=a.data[h][b];for(var i=c(g),h=0;h<i.length;h++){e[h]=[],f[h]=0;for(var j=0;j<a.metadata.names.length;j++)if(b!=j)switch(d){case"max":e[h][j]=Number.MIN_VALUE;break;case"min":e[h][j]=Number.MAX_VALUE;break;default:e[h][j]=0}else e[h][j]=i[h]}for(h=0;h<a.data.length;h++){var k=a.data[h][b];f[i.indexOf(k)]++;var l=e[i.indexOf(k)],m=f[i.indexOf(k)];for(j=0;j<l.length;j++)if(j!=b){var n=l[j],o=a.data[h][j],p=0;switch(d){case"sum":p=n+o;break;case"min":p=n>o?o:n;break;case"max":p=o>n?o:n;break;case"avg":p=(n*(m-1)+o)/m;break;case"count":p=m}e[i.indexOf(k)][j]=p}}return console.log(e),e}function f(a){var b={name:a.name};console.log(a.schema,a.index);var c="table";if(b.range=a.range,void 0!=a.index)switch(a.schema.types[a.index]){case"T":b.type="time";break;case"U":b.type="utc";break;case"C":b.type="ordinal","c"===b.name&&(b.range="category20");break;case"N":b.type="linear"}else b.type=a.type;return a.hasOwnProperty("dataFrom")&&(c=a.dataFrom),b.range=a.range,b.domain={data:c,field:a.field},a.hasOwnProperty("round")&&(b.round=a.round),a.hasOwnProperty("nice")&&(b.nice=a.nice),a.hasOwnProperty("padding")&&(b.padding=a.padding),a.hasOwnProperty("reverse")&&(b.reverse=a.reverse),a.hasOwnProperty("sort")&&(b.sort=a.sort),"x"==b.name&&"linear"==b.type&&(b.sort=!0),a.hasOwnProperty("clamp")&&(b.clamp=a.clamp),a.hasOwnProperty("zero")&&(b.zero=a.zero),console.log(b),b}function g(a,b,c,d){return{type:"x",scale:"x",title:a,orient:d,values:[],properties:{title:{fill:{value:b},fontSize:{value:c}},axis:{strokeOpacity:{value:0}}}}}function h(a){console.log("Axis",a);var b={type:a.type,scale:a.scale,title:a.title,grid:a.grid,properties:{ticks:{},majorTicks:{strokeWidth:{value:2}},labels:{angle:{value:a.angle},align:{value:a.align},baseline:{value:"middle"},dx:{value:a.dx},dy:{value:a.dy}},title:{fontSize:{value:16},dx:{value:a.titleDx},dy:{value:a.titleDy}},axis:{stroke:{value:"#333"},strokeWidth:{value:1.5}}}};return a.hasOwnProperty("tickSize")&&(b.tickSize=a.tickSize),a.hasOwnProperty("tickPadding")&&(b.tickPadding=a.tickPadding),console.log("SpecAxis",b),b}function i(a,b){for(var c=[],d=0;d<a.length;d++){for(var e={},f=b.names,g=0;g<f.length;g++)"T"==b.types[g]?e[j(f[g])]=new Date(a[d][g]):"U"==b.types[g]?e[j(f[g])]=new Date(a[d][g]).getTime():e[j(f[g])]=a[d][g];c[d]=e}return console.log(c),c}function j(a){return a.replace(" ","_")}function k(a,b){var c={};c.tickSize="tickSize",c.tickPadding="tickPadding",c.title="title",c.grid="grid",c.offset="offset",c.ticks="ticks",c.labelColor="fill",c.labelAngle="angle",c.labelAlign="align",c.labelFontSize="fontSize",c.labelDx="dx",c.labelDy="dy",c.labelBaseLine="baseline",c.titleDx="dx",c.titleDy="dy",c.titleFontSize="fontSize",c.axisColor="stroke",c.axisWidth="strokeWidth",c.tickColor="stroke",c.tickWidth="strokeWidth",console.log("previous Axis",b);for(var d in a)"tickSize"!=d&&"tickPadding"!=d&&a.hasOwnProperty(d)&&(0==d.indexOf("label")?b.properties.labels[c[d]].value=a[d]:0==d.indexOf("ticks")?b.properties.ticks[c[d]].value=a[d]:0==d.indexOf("title")&&"title"!=d?b.properties.title[c[d]].value=a[d]:"title"==d?b.title=a[d]:0==d.indexOf("axis")?b.properties.axis[c[d]].value=a[d]:b[c[d]]=a[d]);console.log("NEW SPEC",b)}function l(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];var d=(b/a.length).toFixed(4);return d}function m(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d][b]);return c}function n(a,b,c){this.dataTable=c,this.config=b,this.canvas=a}function o(a,b){a.data.sort("U"==a.metadata.types[b]||"T"==a.metadata.types[b]?function(a,c){return new Date(a[b]).getTime()-new Date(c[b]).getTime()}:"C"==a.metadata.types[b]?function(a,c){return a[b].localeCompare(c[b])}:function(a,c){return a[b]-c[b]})}function p(a,b,c,d){var f=JSON.parse(JSON.stringify(a));void 0!=c&&(f.data=e(a,d,c));for(var g=-1,h=Number.NEGATIVE_INFINITY,i=0;i<b.length;i++){var k=d3.max(m(f.data,b[i]));console.log(m(f.data,b[i])),k>=h&&(g=i,h=k)}return void 0==c?"data."+j(a.metadata.names[b[g]]):"count"==c?"data."+c:"data."+c+"_"+j(a.metadata.names[b[g]])}window.igviz=b,b["var"]=20,b.draw=function(a,b,c){var d=new n(a,b,c);return"singleNumber"==b.chartType?d.diagram=this.drawSingleNumberDiagram(d):"map"==b.chartType?d.diagram=this.drawMap(a,b,c):"table"==b.chartType?d.diagram=this.drawTable(a,b,c):"arc"==b.chartType?d.diagram=this.drawArc(a,b,c):"drill"==b.chartType&&(d.diagram=this.drillDown(0,a,b,c,c)),d},b.setUp=function(a,b,c){var d;c.hasOwnProperty("metadata")||(d={metadata:c,data:[]},c=d);var e=new n(a,b,c);return"bar"==b.chartType?this.drawBarChart(e,a,b,c):"scatter"==b.chartType?this.drawScatterPlot(e):"line"==b.chartType?this.drawLineChart(e):"area"==b.chartType?this.drawAreaChart(e):"series"==b.chartType&&this.drawSeries(e),e},b.drawAggregatedArea=function(a){var b,c=a.config,d=a.dataTable,e="data."+j(d.metadata.names[c.xAxis]),i="sum";void 0!=c.aggregate&&(i=c.aggregate);var k,l=[];b="data."+j(d.metadata.names[c.yAxis]),k="data."+i+"_"+j(d.metadata.names[c.yAxis]),console.log("values",l,k,b),"count"==i&&(k="data.count");var m={index:c.xAxis,schema:d.metadata,name:"x",range:"width",round:!0,field:e,clamp:!1,dataFrom:"myTable"},n={type:"linear",name:"y",range:"height",nice:!0,field:k,dataFrom:"myTable"},o=f(m),p=f(n),q={type:"x",scale:"x",angle:-35,title:d.metadata.names[c.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},r={type:"y",scale:"y",angle:0,title:d.metadata.names[c.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},s=h(q),t=h(r),u=g(c.title,"black",12,"top");void 0==c.interpolationMode&&(c.interpolationMode="monotone");var v={width:c.width-170,height:c.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[e],fields:[{op:i,field:b}]}]}],scales:[o,p,{name:"color",type:"ordinal",range:"category20"}],axes:[s,t,u],marks:[{type:"area",key:e,from:{data:"myTable"},properties:{enter:{x:{scale:"x",field:e},interpolate:{value:c.interpolationMode},y:{scale:"y:prev",field:k},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:d.metadata.names[c.yAxis]},fillOpacity:{value:.5}},update:{x:{scale:"x",field:e},y:{scale:"y",field:k},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}},exit:{x:{value:0},y:{scale:"y",field:k},y2:{scale:"y",value:0}}}},{type:"line",key:e,from:{data:"myTable"},properties:{enter:{x:{value:c.width-100},interpolate:{value:c.interpolationMode},y:{scale:"y:prev",field:k},stroke:{scale:"color",value:d.metadata.names[c.yAxis]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:e},y:{scale:"y",field:k}},exit:{x:{value:0},y:{scale:"y",field:k}}}},{type:"symbol",key:e,from:{data:"myTable"},properties:{enter:{x:{value:c.width-100},y:{scale:"y:prev",field:k},fill:{scale:"color",value:d.metadata.names[c.yAxis]}},update:{x:{scale:"x",field:e},y:{scale:"y",field:k}},exit:{x:{value:0},y:{scale:"y",field:k},fillOpacity:{value:0}}}}]};a.toolTipFunction=[],a.toolTipFunction[0]=function(b,e){console.log(tool,b,e),"symbol"==e.mark.marktype&&(xVar=d.metadata.names[c.xAxis],yVar=d.metadata.names[c.yAxis],contentString="<table><tr><td> X </td><td> ("+xVar+") </td><td>"+e.datum.data[xVar]+"</td></tr><tr><td> Y </td><td> ("+yVar+") </td><td>"+e.datum.data[yVar]+"</td></tr></table>",tool.html(contentString).style({left:b.pageX+10+"px",top:b.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")),a.toolTipFunction[1]=function(a){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.toolTip=!0,a.spec=v}},b.drawAggregatedMultiArea=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e=[],i="sum";void 0!=b.aggregate&&(i=b.aggregate);var k=[],l=[];for(w=0;w<b.yAxis.length;w++)e[w]="data."+j(c.metadata.names[b.yAxis[w]]),k[w]="data."+i+"_"+j(c.metadata.names[b.yAxis[w]]),l.push({op:i,field:e[w]});console.log("values",l,k,e),"count"==i&&(k="data.count");var m={index:b.xAxis,schema:c.metadata,name:"x",range:"width",round:!0,field:d,clamp:!1,dataFrom:"myTable"},n={type:"linear",name:"y",range:"height",nice:!0,field:k[0],dataFrom:"myTable"},o=f(m),p=f(n),q={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},r={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},s=h(q),t=h(r),u=g(b.title,"black",12,"top");void 0==b.interpolationMode&&(b.interpolationMode="monotone");var v={width:b.width-170,height:b.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[d],fields:l}]}],scales:[o,p,{name:"color",type:"ordinal",range:"category20"}],axes:[s,t,u],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};void 0==b.markerSize&&(b.markerSize=30);for(var w=0;w<b.yAxis.length;w++){var x={type:"area",key:d,from:{data:"myTable"},properties:{enter:{x:{scale:"x",field:d},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:k[w]},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:c.metadata.names[b.yAxis[w]]},fillOpacity:{value:.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:k[w]},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}},exit:{x:{value:0},y:{scale:"y",field:k[w]},y2:{scale:"y",value:0}}}},y={type:"line",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:k[w]},stroke:{scale:"color",value:c.metadata.names[b.yAxis[w]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:k[w]}},exit:{x:{value:0},y:{scale:"y",field:k[w]}}}},z={type:"symbol",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},y:{scale:"y:prev",field:k[w]},fill:{scale:"color",value:c.metadata.names[b.yAxis[w]]},size:{value:b.markerSize}},update:{x:{scale:"x",field:d},y:{scale:"y",field:k[w]}},exit:{x:{value:0},y:{scale:"y",field:k[w]},fillOpacity:{value:0}}}};v.marks.push(x),v.marks.push(y),b.pointVisible&&v.marks.push(z),v.legends[0].values.push(c.metadata.names[b.yAxis[w]])}a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){if(console.log(tool,a,d),"symbol"==d.mark.marktype){for(var f=c.metadata.names[b.xAxis],g=d3.scale.category20(),h=-1,i=0;i<e.length;i++)if(d.fill===g(e[i])){h=i;break}var k=c.metadata.names[b.yAxis[h]];contentString="<table><tr><td> X </td><td> ("+f+") </td><td>"+d.datum.data[j(f)]+"</td></tr><tr><td> Y </td><td> ("+k+") </td><td>"+d.datum.data[b.aggregate+"_"+j(k)]+"</td></tr></table>",tool.html(contentString).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},a.toolTipFunction[1]=function(a){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.toolTip=!0,a.spec=v},b.drawAreaChart=function(a){var b=a.config,c=a.dataTable;if(b.yAxis.constructor===Array)return this.drawMultiAreaChart(a);if(void 0!=b.aggregate)return this.drawAggregatedArea(a);if(b.hasOwnProperty("areaVar"))return this.drawStackedAreaChart(a);var d="data."+j(c.metadata.names[b.xAxis]),e="data."+j(c.metadata.names[b.yAxis]),g={index:b.xAxis,schema:c.metadata,name:"x",range:"width",field:d},i={index:b.yAxis,schema:c.metadata,name:"y",range:"height",field:e},k=f(g),l=f(i),m={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},n={type:"y",scale:"y",angle:0,title:c.metadata.names[b.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},o=h(m),p=h(n);void 0==b.interpolationMode&&(b.interpolationMode="monotone");var q=100,r={width:b.width-100,height:b.height,data:[{name:"table"}],scales:[k,l,{name:"color",type:"ordinal",range:"category10"}],axes:[o,p],marks:[{type:"area",key:d,from:{data:"table"},properties:{enter:{x:{value:b.width-q},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:e},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:2},fillOpacity:{value:.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:e},y2:{scale:"y",value:0}},exit:{x:{value:0},y:{scale:"y",field:e},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}}}},{type:"line",key:d,from:{data:"table"},properties:{enter:{x:{value:b.width-q},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:e},stroke:{scale:"color",value:2},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:e}},exit:{x:{value:0},y:{scale:"y",field:e}}}}]};b.pointVisible&&(void 0==b.markerSize&&(b.markerSize=30),r.marks.push({type:"symbol",from:{data:"table"},properties:{enter:{x:{value:b.width-q},y:{scale:"y:prev",field:e},fill:{scale:"color",value:2},size:{value:b.markerSize}},update:{size:{value:50},x:{scale:"x",field:d},y:{scale:"y",field:e}},exit:{x:{value:0},y:{scale:"y",field:e}},hover:{size:{value:b.markerSize},stroke:{value:"white"}}}})),a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){console.log(tool,a,d),"symbol"==d.mark.marktype&&(xVar=c.metadata.names[b.xAxis],yVar=c.metadata.names[b.yAxis],contentString="<table><tr><td> X </td><td> ("+xVar+") </td><td>"+d.datum.data[j(xVar)]+"</td></tr><tr><td> Y </td><td> ("+yVar+") </td><td>"+d.datum.data[j(yVar)]+"</td></tr></table>",tool.html(contentString).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px"))},a.toolTipFunction[1]=function(a){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.spec=r,a.toolTip=!0,a.spec=r},b.drawMultiAreaChart=function(c){var d=c.config,e=c.dataTable;if(void 0!=d.aggregate)return b.drawAggregatedMultiArea(c);for(var g="data."+j(e.metadata.names[d.xAxis]),i=[],k=0;k<d.yAxis.length;k++)i[k]="data."+j(e.metadata.names[d.yAxis[k]]);var l={index:d.xAxis,schema:e.metadata,name:"x",range:"width",clamp:!1,field:g},m={index:d.yAxis[0],schema:e.metadata,name:"y",range:"height",nice:!0,field:i[0]},n=f(l),o=f(m),p={type:"x",scale:"x",angle:-35,title:e.metadata.names[d.xAxis],grid:!0,dx:-10,dy:10,align:"left",titleDy:10,titleDx:0},q={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},r=h(p),s=h(q);void 0==d.interpolationMode&&(d.interpolationMode="monotone");var t=160,u={width:d.width-t,height:d.height,data:[{name:"table"}],scales:[n,o,{name:"color",type:"ordinal",range:"category20"}],legends:[{orient:"right",fill:"color",title:"Area",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],axes:[r,s],marks:[]};for(void 0==d.markerSize&&(d.markerSize=30),k=0;k<d.yAxis.length;k++){var v={type:"area",key:g,from:{data:"table"},properties:{enter:{x:{scale:"x",field:g},interpolate:{value:d.interpolationMode},y:{scale:"y:prev",field:i[k]},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:e.metadata.names[d.yAxis[k]]},fillOpacity:{value:.5}},update:{x:{scale:"x",field:g},y:{scale:"y",field:i[k]},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}},exit:{x:{value:0},y:{scale:"y",field:i[k]},y2:{scale:"y",value:0}}}},w={type:"line",key:g,from:{data:"table"},properties:{enter:{x:{scale:"x",field:g},interpolate:{value:d.interpolationMode},y:{scale:"y:prev",field:i[k]},stroke:{scale:"color",value:e.metadata.names[d.yAxis[k]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:g},y:{scale:"y",field:i[k]}},exit:{x:{value:0},y:{scale:"y",field:i[k]}}}},x={type:"symbol",from:{data:"table"},properties:{enter:{x:{scale:"x",field:g},y:{scale:"y:prev",field:i[k]},fill:{scale:"color",value:e.metadata.names[d.yAxis[k]]},size:{value:d.markerSize}},update:{x:{scale:"x",field:g},y:{scale:"y",field:i[k]}},exit:{x:{value:0},y:{scale:"y",field:i[k]}},hover:{size:{value:1.5*d.markerSize},stroke:{value:"white"}}}};u.marks.push(v),d.pointVisible&&u.marks.push(x),u.marks.push(w),u.legends[0].values.push(e.metadata.names[d.yAxis[k]])}c.toolTipFunction=[],c.toolTipFunction[0]=function(b,c){if(a=4,console.log(tool,b,c),"symbol"==c.mark.marktype){for(var f=e.metadata.names[d.xAxis],g=d3.scale.category20(),h=-1,k=0;k<i.length;k++)if(c.fill===g(i[k])){h=k;break}var l=e.metadata.names[d.yAxis[h]];contentString="<table><tr><td> X </td><td> ("+f+") </td><td>"+c.datum.data[j(f)]+"</td></tr><tr><td> Y </td><td> ("+l+") </td><td>"+c.datum.data[j(l)]+"</td></tr></table>",tool.html(contentString).style({left:b.pageX+10+"px",top:b.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},c.toolTipFunction[1]=function(a){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},c.spec=u,c.toolTip=!0,c.spec=u,c.spec=u},b.drawStackedAreaChart=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.areaVar]),e="data."+j(c.metadata.names[b.yAxis]),g="data."+j(c.metadata.names[b.xAxis]),i={index:b.xAxis,schema:c.metadata,name:"cat",range:"width",field:g,padding:.2,zero:!1,nice:!0},k={index:b.yAxis,schema:c.metadata,name:"val",range:"height",dataFrom:"stats",field:"sum",nice:!0},l=f(i),m=f(k),n={type:"x",scale:"cat",angle:0,title:c.metadata.names[b.xAxis],grid:!0,dx:-10,dy:10,align:"left",titleDy:10,titleDx:0},o={type:"y",scale:"val",angle:0,title:c.metadata.names[b.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=h(n),q=h(o);a.spec={width:b.width-160,height:b.height-100,padding:{top:10,left:60,bottom:60,right:100},data:[{name:"table"},{name:"stats",source:"table",transform:[{type:"facet",keys:[g]},{type:"stats",value:e}]}],scales:[l,m,{name:"color",type:"ordinal",range:"category20"}],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.areaVar],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],axes:[p,q],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[d]},{type:"stack",point:g,height:e}]},marks:[{type:"area",properties:{enter:{interpolate:{value:"monotone"},x:{scale:"cat",field:g},y:{scale:"val",field:"y"},y2:{scale:"val",field:"y2"},fill:{scale:"color",field:d},fillOpacity:{value:.8}},update:{fillOpacity:{value:.8}},hover:{fillOpacity:{value:.5}}}},{type:"line",properties:{enter:{x:{scale:"cat",field:g},interpolate:{value:"monotone"},y:{scale:"val",field:"y"},stroke:{scale:"color",field:d},strokeWidth:{value:3}}}}]}]},a.legend=!0,a.legendIndex=b.areaVar},b.drawAggregatedBar=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e="data."+j(c.metadata.names[b.yAxis]),i="sum";void 0!=b.aggregate&&(i=b.aggregate);var k="data."+i+"_"+j(c.metadata.names[b.yAxis]);"count"==i&&(k="data.count"),console.log(d,e,k,i);var l={index:b.xAxis,schema:c.metadata,name:"x",range:"width",round:!0,field:d,dataFrom:"myTable"},m={type:"linear",name:"y",range:"height",nice:!0,field:k,dataFrom:"myTable"},n=f(l),o=f(m),p={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},q={type:"y",scale:"y",angle:0,title:c.metadata.names[b.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},r=h(p),s=h(q),t=g(b.title);void 0==b.barColor&&(b.barColor="steelblue"),a.spec={width:b.width-150,height:b.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[d],fields:[{op:i,field:e}]}]}],scales:[n,o],axes:[r,s,t],marks:[{key:d,type:"rect",from:{data:"myTable"},properties:{enter:{x:{scale:"x",field:d},width:{scale:"x",band:!0,offset:-10},y:{scale:"y:prev",field:k},y2:{scale:"y",value:0}},update:{x:{scale:"x",field:d},y:{scale:"y",field:k},y2:{scale:"y",value:0},fill:{value:b.barColor}},exit:{x:{value:0},y:{scale:"y:prev",field:k},y2:{scale:"y",value:0}},hover:{fill:{value:"orange"}}}}]}},b.drawBarChart=function(a,b,c,d){var c=a.config,d=a.dataTable;if(c.hasOwnProperty("aggregate"))return this.drawAggregatedBar(a);if(c.hasOwnProperty("groupedBy")){var e="grouped";return c.hasOwnProperty("format")&&(e=c.format),"grouped"==e?"H"==c.orientation?(console.log("horizontal"),this.drawGroupedBarChart(a)):this.drawGroupedBarChartVertical(a):this.drawStackedBarChart(a)}var g="data."+j(d.metadata.names[c.xAxis]),i="data."+j(d.metadata.names[c.yAxis]),k={index:c.xAxis,schema:d.metadata,name:"x",range:"width",round:!0,field:g},l={index:c.yAxis,schema:d.metadata,name:"y",range:"height",nice:!0,field:i},m=f(k),n=f(l),o={type:"x",scale:"x",angle:-35,title:d.metadata.names[c.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},p={type:"y",scale:"y",angle:0,title:d.metadata.names[c.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},q=h(o),r=h(p);void 0==c.barColor&&(c.barColor="steelblue");var s={width:c.width-150,height:c.height,data:[{name:"table"}],scales:[m,n],axes:[q,r],marks:[{key:g,type:"rect",from:{data:"table"},properties:{enter:{x:{scale:"x",field:g},width:{scale:"x",band:!0,offset:-10},y:{scale:"y:prev",field:i},y2:{scale:"y",value:0}},update:{x:{scale:"x",field:g},y:{scale:"y",field:i},y2:{scale:"y",value:0},fill:{value:c.barColor}},exit:{x:{value:0},y:{scale:"y:prev",field:i},y2:{scale:"y",value:0}},hover:{fill:{value:"orange"}}}}]};a.originalWidth=c.width,a.originalHeight=c.height,a.spec=s},b.drillDown=function(a,c,d,e,f){0==a&&(d3.select(c).append("div").attr({id:"links",height:20,bgcolor:"blue"}),d3.select(c).append("div").attr({id:"chartDiv"}),d.height=d.height-20,c="#chartDiv");var g=JSON.parse(JSON.stringify(d)),h=0;h=a<d.xAxis.length?d.xAxis[a].index:d.xAxis[a-1].child;for(var i,j,k,l=d.yAxis,m={metadata:{names:[e.metadata.names[h],e.metadata.names[l]],types:[e.metadata.types[h],e.metadata.types[l]]},data:[]},n=[],o=0;o<e.data.length;o++){i=e.data[o][h],j=e.data[o][l],k=!1;for(var p=0;p<n.length;p++)if(n[p][0]===i){k=!0;break}k?(n[p][1]+=j,console.log(i,j,n[p][1])):(console.log("create",i,j),n.push([i,j]))}m.data=n,g.xAxis=0,g.yAxis=1,g.chartType="bar";var q=this.setUp(c,g,m);q.plot(m.data,function(){d3.select("#links .root").on("click",function(){d3.select("#links").html(""),b.drillDown(0,c,d,f,f)});var g=d3.select("#links").selectAll(".filter");g.on("click",function(a,e){for(var h=g.data(),i=[],j=JSON.parse(JSON.stringify(f)),k=0,l=0;l<f.data.length;l++){for(var m=!0,n=0;e>=n;n++)if(f.data[l][h[n][0]]!==h[n][1]){m=!1;break}m&&(i[k++]=f.data[l])}d3.selectAll("#links g").each(function(a,b){b>e&&this.remove()}),j.data=i,b.drillDown(e+1,c,d,j,f,!0)}),a<d.xAxis.length&&(console.log(q),d3.select(q.chart._el).selectAll("g.type-rect rect").on("click",function(g,i){console.log(g,i,this),console.log(g,i);{var j=g.datum.data[q.dataTable.metadata.names[q.config.xAxis]],k=JSON.parse(JSON.stringify(e));d3.select("#links").append("g").append("text").text(e.metadata.names[h]+" : ").attr({"font-size":"10px",x:10,y:20})}d3.select("#links:first-child").selectAll("text").attr("class","root"),d3.select("#links g:last-child").append("span").data([[h,j]]).attr("class","filter").text(j+"  >  ");for(var l=k.data.length,m=[],n=0,o=0;l>o;o++)k.data[o][h]===j&&(m[n++]=k.data[o]);k.data=m,b.drillDown(a+1,c,d,k,f,!0)}))})},b.drawGroupedBarChart=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e="data."+j(c.metadata.names[b.yAxis]),g="data."+j(c.metadata.names[b.groupedBy]),i={index:b.groupedBy,schema:c.metadata,name:"cat",range:"height",field:g,padding:.2},k={index:b.yAxis,schema:c.metadata,name:"val",range:"width",round:"true",field:e,nice:!0},l=f(i),m=f(k),n={type:"x",scale:"val",angle:-35,title:c.metadata.names[b.yAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},o={type:"y",scale:"cat",angle:0,tickSize:0,tickPadding:8,title:c.metadata.names[b.groupedBy],grid:!1,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=h(n),q=h(o),r={width:b.width,height:b.height,data:[{name:"table"}],scales:[l,m,{name:"color",type:"ordinal",range:"category20"}],axes:[p,q],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.xAxis],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[g]}]},properties:{enter:{y:{scale:"cat",field:"key"},height:{scale:"cat",band:!0}}},scales:[{name:"pos",type:"ordinal",range:"height",domain:{field:d}}],marks:[{type:"rect",properties:{enter:{y:{scale:"pos",field:d},height:{scale:"pos",band:!0},x:{scale:"val",field:e},x2:{scale:"val",value:0},fill:{scale:"color",field:d}},hover:{fillOpacity:{value:.5}},update:{fillOpacity:{value:1}}}}]}]};a.legend=!0,a.legendIndex=b.xAxis,a.spec=r},b.drawGroupedBarChartVertical=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e="data."+j(c.metadata.names[b.yAxis]),g="data."+j(c.metadata.names[b.groupedBy]),i={index:b.groupedBy,schema:c.metadata,name:"cat",range:"width",field:g,padding:.2},k={index:b.yAxis,schema:c.metadata,name:"val",range:"height",round:"true",field:e,nice:!0},l=f(i),m=f(k),n={type:"y",scale:"val",angle:-35,title:c.metadata.names[b.yAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},o={type:"x",scale:"cat",angle:0,tickSize:0,tickPadding:8,title:c.metadata.names[b.groupedBy],grid:!1,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=h(o),q=h(n),r={width:b.width-150,height:b.height,data:[{name:"table"}],scales:[l,m,{name:"color",type:"ordinal",range:"category20"}],axes:[p,q],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.xAxis],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[g]}]},properties:{enter:{x:{scale:"cat",field:"key"},width:{scale:"cat",band:!0}}},scales:[{name:"pos",type:"ordinal",range:"width",domain:{field:d}}],marks:[{type:"rect",properties:{enter:{x:{scale:"pos",field:d},width:{scale:"pos",band:!0},y:{scale:"val",field:e},y2:{scale:"val",value:0},fill:{scale:"color",field:d}},hover:{fillOpacity:{value:.5}},update:{fillOpacity:{value:1}}}}]}]};a.legend=!0,a.legendIndex=b.xAxis,a.spec=r},b.drawStackedBarChart=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e="data."+j(c.metadata.names[b.yAxis]),g="data."+j(c.metadata.names[b.groupedBy]),i={index:b.groupedBy,schema:c.metadata,name:"cat",range:"width",field:g,padding:.2},k={index:b.yAxis,schema:c.metadata,name:"val",range:"height",dataFrom:"stats",field:"sum",nice:!0},l=f(i),m=f(k),n={type:"x",scale:"cat",angle:0,title:c.metadata.names[b.groupedBy],grid:!1,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},o={type:"y",scale:"val",angle:0,title:c.metadata.names[b.yAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=h(n),q=h(o),r={width:b.width-160,height:b.height-100,padding:{top:10,left:60,bottom:60,right:100},data:[{name:"table"},{name:"stats",source:"table",transform:[{type:"facet",keys:[g]},{type:"stats",value:e}]}],scales:[l,m,{name:"color",type:"ordinal",range:"category20"}],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.xAxis],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],axes:[p,q],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[d]},{type:"stack",point:g,height:e}]},marks:[{type:"rect",properties:{enter:{x:{scale:"cat",field:g},width:{scale:"cat",band:!0,offset:-1},y:{scale:"val",field:"y"},y2:{scale:"val",field:"y2"},fill:{scale:"color",field:d}},update:{fillOpacity:{value:1}},hover:{fillOpacity:{value:.5}}}}]}]};a.legend=!0,a.legendIndex=b.xAxis,a.spec=r},b.drawArc=function(a,b,c){function d(a){function c(){function a(a){"function"==typeof j&&j.call()}h.each(function(c){function h(a){var b=(q-r)/(s-r),c=Math.min(360*b,360);c=c*Math.PI/180,y.datum(c),y.transition().duration(k).attrTween("d",e),b>1&&(z.datum(Math.min(360*(b-1),360)*Math.PI/180),z.transition().delay(k).duration(k).attrTween("d",f)),A.datum(Math.round(100*b)),A.transition().duration(k).tween("text",d)}var i=d3.select(this).selectAll("svg").data([c]),j=i.enter().append("svg").attr("class","radial-svg").append("g");g(),i.attr("width",m).attr("height",n);var l=j.append("g").attr("class","component").attr("cursor","pointer").on("click",a);w.endAngle(360*(Math.PI/180)),l.append("rect").attr("class","background").attr("width",_width).attr("height",_height),l.append("path").attr("transform","translate("+_width/2+","+_width/2+")").attr("d",w),l.append("text").attr("class","label").attr("transform","translate("+_width/2+","+(_width+p)+")").text(o);{var u=b.width/2-_width/2,v=b.height/2-_height/2;i.select("g").attr("transform","translate("+u+","+v+")")}w.endAngle(t),j.append("g").attr("class","arcs");var y=i.select(".arcs").selectAll(".arc").data(c);y.enter().append("path").attr("class","arc").attr("transform","translate("+_width/2+","+_width/2+")").attr("d",w);var z=i.select(".arcs").selectAll(".arc2").data(c);z.enter().append("path").attr("class","arc2").attr("transform","translate("+_width/2+","+_width/2+")").attr("d",x),j.append("g").attr("class","labels");var A=i.select(".labels").selectAll(".label").data(c);A.enter().append("text").attr("class","label").attr("y",_width/2+p/3).attr("x",_width/2).attr("cursor","pointer").attr("width",_width).text(function(a){return Math.round((q-r)/(s-r)*100)+"%"}).style("font-size",p+"px").on("click",a),y.exit().transition().duration(500).attr("x",1e3).remove(),h(i)})}function d(a){var b=d3.interpolate(v,a);return v=b(0),function(a){v=b(a),this.textContent=Math.round(b(a))+"%"}}function e(a){var b=d3.interpolate(t,a);return function(a){return t=b(a),w.endAngle(b(a))()}}function f(a){var b=d3.interpolate(u,a);return function(a){return x.endAngle(b(a))()}}function g(){_width=i-l.right-l.left-l.top-l.bottom,_height=_width,p=.2*_width,w.outerRadius(_width/2),w.innerRadius(_width/2*.85),x.outerRadius(_width/2*.85),x.innerRadius(_width/2*.85-_width/2*.15)}var h,i,j,k=1e3,l={top:0,right:0,bottom:30,left:0},m=b.width,n=b.height,o="",p=10,q=0,r=0,s=100,t=0,u=0,v=0,w=d3.svg.arc().startAngle(0),x=d3.svg.arc().startAngle(0).endAngle(0);

return h=d3.select(a),c.render=function(){return g(),c(),c},c.value=function(a){return arguments.length?(q=[a],h.datum([q]),c):q},c.margin=function(a){return arguments.length?(l=a,c):l},c.diameter=function(a){return arguments.length?(i=a,c):i},c.minValue=function(a){return arguments.length?(r=a,c):r},c.maxValue=function(a){return arguments.length?(s=a,c):s},c.label=function(a){return arguments.length?(o=a,c):o},c._duration=function(a){return arguments.length?(k=a,c):k},c.onClick=function(a){return arguments.length?(j=a,c):j},c}d(a).label("RADIAL 1").diameter(b.diameter).value(b.value).render()},b.drawAggregatedLine=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e=[],i="sum";void 0!=b.aggregate&&(i=b.aggregate);for(var k=[],l=[],m=0;m<b.yAxis.length;m++)e[m]="data."+j(c.metadata.names[b.yAxis[m]]),k[m]="data."+i+"_"+j(c.metadata.names[b.yAxis[m]]),l.push({op:i,field:e[m]});console.log("values",l,k,e),"count"==i&&(k="data.count");var n={index:b.xAxis,schema:c.metadata,name:"x",range:"width",round:!0,field:d,clamp:!1,dataFrom:"myTable"},o={type:"linear",name:"y",range:"height",nice:!0,field:k[0],dataFrom:"myTable"},p=f(n),q=f(o),r={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},s={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},t=h(r),u=h(s),v=g(b.title,"black",12,"top");void 0==b.interpolationMode&&(b.interpolationMode="monotone");var w={width:b.width-150,height:b.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[d],fields:l}]}],scales:[p,q,{name:"color",type:"ordinal",range:"category20"}],axes:[t,u,v],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};for(void 0==b.markerSize&&(b.markerSize=30),m=0;m<b.yAxis.length;m++){var x={type:"line",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:k[m]},stroke:{scale:"color",value:c.metadata.names[b.yAxis[m]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:k[m]}},exit:{x:{value:0},y:{scale:"y",field:k[m]}}}},y={type:"symbol",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},y:{scale:"y:prev",field:k[m]},fill:{scale:"color",value:c.metadata.names[b.yAxis[m]]},size:{value:b.markerSize}},update:{x:{scale:"x",field:d},y:{scale:"y",field:k[m]}},exit:{x:{value:0},y:{scale:"y",field:k[m]},fillOpacity:{value:0}}}};w.marks.push(x),b.pointVisible&&w.marks.push(y),w.legends[0].values.push(c.metadata.names[b.yAxis[m]])}a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){if(console.log(tool,a,d),"symbol"==d.mark.marktype){for(var f=c.metadata.names[b.xAxis],g=d3.scale.category20(),h=-1,i=0;i<e.length;i++)if(d.fill===g(e[i])){h=i;break}var k=c.metadata.names[b.yAxis[h]],l=j(k),m="<table><tr><td> X </td><td> ("+f+") </td><td>"+d.datum.data[f]+"</td></tr><tr><td> Y </td><td> ("+k+") </td><td>"+d.datum.data[b.aggregate+"_"+l]+"</td></tr></table>";tool.html(m).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.toolTip=!0,a.spec=w},b.drawLineChart=function(a){var c=a.config,d=a.dataTable;if(void 0!=c.aggregate)return b.drawAggregatedLine(a);for(var e="data."+j(d.metadata.names[c.xAxis]),g=[],i=0;i<c.yAxis.length;i++)g[i]="data."+j(d.metadata.names[c.yAxis[i]]);var k={index:c.xAxis,schema:d.metadata,name:"x",range:"width",clamp:!1,field:e},l={index:c.yAxis[0],schema:d.metadata,name:"y",range:"height",nice:!0,field:g[0]},m=f(k),n=f(l),o={type:"x",scale:"x",angle:-35,title:d.metadata.names[c.xAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},p={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},q=h(o),r=h(p);void 0==c.interpolationMode&&(c.interpolationMode="monotone");var s=160,t={width:c.width-s,height:c.height,data:[{name:"table"}],scales:[m,n,{name:"color",type:"ordinal",range:"category20"}],axes:[q,r],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};for(void 0==c.markerSize&&(c.markerSize=30),i=0;i<c.yAxis.length;i++){var u={type:"line",key:e,from:{data:"table"},properties:{enter:{x:{value:c.width-s},interpolate:{value:c.interpolationMode},y:{scale:"y:prev",field:g[i]},stroke:{scale:"color",value:d.metadata.names[c.yAxis[i]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:e},y:{scale:"y",field:g[i]}},exit:{x:{value:0},y:{scale:"y",field:g[i]}}}},v={type:"symbol",key:e,from:{data:"table"},properties:{enter:{" x":{value:c.width-s},y:{scale:"y:prev",field:g[i]},fill:{scale:"color",value:d.metadata.names[c.yAxis[i]]},size:{value:c.markerSize}},update:{x:{scale:"x",field:e},y:{scale:"y",field:g[i]}},exit:{x:{value:0},y:{scale:"y",field:g[i]},fillOpacity:{value:0}}}};t.marks.push(u),c.pointVisible&&t.marks.push(v),t.legends[0].values.push(d.metadata.names[c.yAxis[i]])}a.toolTipFunction=[],a.toolTipFunction[0]=function(a,b){if("symbol"==b.mark.marktype){for(var e=d.metadata.names[c.xAxis],f=d3.scale.category20(),h=-1,i=0;i<g.length;i++)if(b.fill===f(g[i])){h=i;break}var k=d.metadata.names[c.yAxis[h]],l=j(k),m="<table><tr><td> X </td><td> ("+e+") </td><td>"+b.datum.data[j(e)]+"</td></tr><tr><td> Y </td><td> ("+k+") </td><td>"+b.datum.data[l]+"</td></tr></table>";tool.html(m).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.spec=t,a.toolTip=!0,a.spec=t},b.drawMap=function(a,b,c){function d(a,b){("satellite"==i||"terrain"==i||"normal"==i)&&e(a),("regions"==i||"markers"==i)&&f(b)}function e(b){var c=google.visualization.arrayToDataTable(b),d={showTip:!0,useMapTypeControl:!0,mapType:i},e=new google.visualization.Map(document.getElementById(a));e.draw(c,d)}function f(b){console.log(google),console.log(google.visualization);var c=google.visualization.arrayToDataTable(b),d={region:j,displayMode:i,colorAxis:{colors:["red","blue"]},magnifyingGlass:{enable:!0,zoomFactor:3},enableRegionInteractivity:!0},e=new google.visualization.GeoChart(document.getElementById(a));e.draw(c,d)}var a=a.substr(1),g=b.width,h=b.height,i=b.mode,j=b.region,k=c.data.map(function(a,d){return{data:a,config:b,name:c.metadata.names[d]}}),l=[],m=[],n=k[0].config.mapLocation,o=k[0].config.pointColor,p=k[0].config.pointSize;l.push(k[n].name,k[o].name,k[p].name),m.push(l);for(var q=0;q<k.length;q++)l=[],l.push(k[q].data[n],k[q].data[o],k[q].data[p]),m.push(l);for(var r=[],s=0;s<m.length;s++){for(var t=m[s],u="",v=1;v<t.length;v++)u+=m[0][v]+":"+t[v]+" , ";u=u.substring(0,u.length-3),u=m[s][0].toUpperCase()+"\n"+u,l=[],l.push(m[s][0]),l.push(u),r.push(l)}document.getElementById(a).setAttribute("style","width: "+g+"px; height: "+h+"px;"),d(r,m)},b.drawScatterPlot=function(a){var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e="data."+j(c.metadata.names[b.yAxis]),g="data."+j(c.metadata.names[b.pointSize]),i="data."+j(c.metadata.names[b.pointColor]),k={index:b.xAxis,schema:c.metadata,name:"x",range:"width",field:d},l={index:b.pointSize,range:[0,576],schema:c.metadata,name:"r",field:g},m={index:b.pointColor,schema:c.metadata,name:"c",range:[b.minColor,b.maxColor],field:i},n={index:b.yAxis,schema:c.metadata,name:"y",range:"height",nice:!0,field:e},o=f(k),p=f(n),q=f(l),r=f(m),s={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:25,titleDx:0},t={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-30,titleDx:0},u=h(s),v=h(t),w={width:b.width-130,height:b.height,data:[{name:"table"}],scales:[o,p,{name:"color",type:"ordinal",range:"category20"},q,r],axes:[u,v],marks:[{type:"symbol",from:{data:"table"},properties:{enter:{x:{scale:"x",field:d},y:{scale:"y",field:e},fill:{scale:"c",field:i}},update:{size:{scale:"r",field:g}},hover:{size:{value:300},stroke:{value:"white"}}}}]};a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){console.log(tool,a,d),xVar=c.metadata.names[b.xAxis],yVar=c.metadata.names[b.yAxis],pSize=c.metadata.names[b.pointSize],pColor=c.metadata.names[b.pointColor],contentString="<table><tr><td> X </td><td> ("+xVar+") </td><td>"+d.datum.data[xVar]+"</td></tr><tr><td> Y </td><td> ("+yVar+") </td><td>"+d.datum.data[yVar]+"</td></tr><tr><td> Size </td><td> ("+pSize+") </td><td>"+d.datum.data[pSize]+'</td></tr><tr><td bgcolor="'+d.fill+'">&nbsp; </td><td> ('+pColor+") </td><td>"+d.datum.data[pColor]+"</td></tr></table>",tool.html(contentString).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")},a.toolTipFunction[1]=function(a){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.spec=w,a.toolTip=!0},b.drawSeries=function(a){for(var b=a.config,c=a.dataTable,d="data."+j(c.metadata.names[b.xAxis]),e=[],g=0;g<b.yAxis.length;g++)e[g]="data."+j(c.metadata.names[b.yAxis[g]]);var i={index:b.xAxis,schema:c.metadata,name:"x",range:"width",clamp:!1,field:d},k={index:b.yAxis[0],schema:c.metadata,name:"y",range:"height",nice:!0,field:e[0]},l=f(i),m=f(k),n={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},o={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=h(n),q=h(o),r=160,s={width:b.width-r,height:b.height,data:[{name:"table"}],scales:[l,m,{name:"color",type:"ordinal",range:"category20"}],axes:[p,q],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};for(g=0;g<b.yAxis.length;g++){var t={type:"rect",key:d,from:{data:"table"},properties:{enter:{x:{scale:"x",field:d},y:{scale:"y",field:e[g]},y2:{scale:"y",value:0},width:{value:2},fill:{scale:"color",value:c.metadata.names[b.yAxis[g]]}}}},u={type:"symbol",key:d,from:{data:"table"},properties:{enter:{" x":{value:b.width-r},y:{scale:"y:prev",field:e[g]},fill:{scale:"color",value:c.metadata.names[b.yAxis[g]]}},update:{x:{scale:"x",field:d},y:{scale:"y",field:e[g]}},exit:{x:{value:0},y:{scale:"y",field:e[g]},fillOpacity:{value:0}}}};b.lineMark&&s.marks.push(t),b.pointMark&&s.marks.push(u),s.legends[0].values.push(c.metadata.names[b.yAxis[g]])}a.spec=s},b.drawSingleNumberDiagram=function(a){var c=a.canvas,d=a.config,e=a.dataTable,f=d.width,g=d.height,h=f/25,i=f/18,j=f/25,k="minValue",n="maxValue",o="avgValue",d={xAxis:d.xAxis,yAxis:1,aggregate:"sum",chartType:"bar",width:600,height:3*g/4},p=b.setUp(c,d,e);p.plot(e.data);var q=e.data.map(function(a){return{data:a,config:d}}),r=c+"_svg";d3.select(r).remove();var s=d3.select(c).append("svg").attr("id",r.replace("#","")).attr("width",f).attr("height",g),t=e.data,u=m(t,q[0].config.xAxis),v=s.append("g");s.append("rect").attr("id","rect").attr("x",0).attr("y",0).attr("width",f).attr("height",g),v.append("text").attr("id",k).text("Max: "+d3.max(u)).attr("font-size",j).attr("x",3*f/4).attr("y",6*g/7).style("fill","Red").style("text-anchor","start").style("lignment-baseline","middle"),v.append("text").attr("id",o).text("Avg :"+l(u)).attr("font-size",i).attr("x",f/2).attr("y",6*g/7).style("fill","Green").style("text-anchor","middle").style("lignment-baseline","middle"),v.append("text").attr("id",n).text("Min: "+d3.min(u)).attr("font-size",h).attr("x",f/4).attr("y",6*g/7).style("fill","Black").style("text-anchor","end").style("lignment-baseline","middle")},b.drawTable=function(a,b,c){b.width,b.height,b.padding,b.dataSeries,b.highlightMode;void 0!=b.rowIndex&&void 0!=b.columnIndex?c=d(c,b.rowIndex,b.columnIndex,b.aggregate,b.cellIndex):void 0!=b.aggregate&&(c=e(c,b.groupedBy,b.aggregate));c.data.map(function(a){return{data:a,config:b}});d3.select(a).select("table").remove();var f=c.metadata.names,g=c.data,h=[{r:255,g:0,b:0},{r:0,g:255,b:0},{r:200,g:100,b:100},{r:200,g:255,b:250},{r:255,g:140,b:100},{r:230,g:100,b:250},{r:0,g:138,b:230},{r:165,g:42,b:42},{r:127,g:0,b:255},{r:0,g:255,b:255}],i=d3.scale.linear().domain([0,100]).range([0,1]),j=d3.select(a).append("table").attr("class","table table-bordered"),k=d3.scale.linear().domain([2.5,4]).range(["#F5BFE8","#E305AF"]),l=d3.scale.linear().domain([0,100]).range([15,20]),n=j.append("thead"),o=j.append("tbody");n.append("tr").selectAll("th").data(f).enter().append("th").text(function(a){return a});var p,q=b.colorBasedStyle,r=b.fontBasedStyle,s=o.selectAll("tr").data(g).enter().append("tr");if(b.heatMap){for(var t=c.data[0][1],u=c.data[0][1],v=0;v<c.data.length;v++)for(var w=0;w<c.metadata.names.length;w++)"N"==c.metadata.types[w]&&(c.data[v][w]>u&&(u=c.data[v][w]),c.data[v][w]<t&&(t=c.data[v][w]));i.domain([t,u]),p=s.selectAll("td").data(function(a,b){return console.log(a,b),a}).enter().append("td").text(function(a,b){return a}).style("background-color",function(a,b){return"rgba("+h[0].r+","+h[0].g+","+h[0].b+","+i(a)+")"})}else 1==q&&1==r?p=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}).style("font-size",function(a,b){return l.domain([d3.min(m(g,b)),d3.max(m(g,b))]),l(a)+"px"}).style("background-color",function(a,b){return i.domain([d3.min(m(g,b)),d3.max(m(g,b))]),"rgba("+h[b].r+","+h[b].g+","+h[b].b+","+i(a)+")"}):q&&!r?p=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}).style("background-color",function(a,b){return i.domain([d3.min(m(g,b)),d3.max(m(g,b))]),"rgba("+h[b].r+","+h[b].g+","+h[b].b+","+i(a)+")"}):!q&&r?p=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}).style("font-size",function(a,b){return l.domain([d3.min(m(g,b)),d3.max(m(g,b))]),l(a)+"px"}):(console.log("We are here baby!"),s.style("background-color",function(a,c){return k.domain([d3.min(m(g,b.xAxis)),d3.max(m(g,b.xAxis))]),k(a[b.xAxis])}).style("font-size",function(a,b){return l.domain([d3.min(m(g,b)),d3.max(m(g,b))]),l(a)+"px"}),p=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}));return j},b.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},n.prototype.setXAxis=function(a){var b=this.spec.axes[0];return a.hasOwnProperty("zero")&&(this.spec.scales[0].zero=a.zero),a.hasOwnProperty("nice")&&(this.spec.scales[0].nice=a.nice),k(a,b),this},n.prototype.setYAxis=function(a){var b=this.spec.axes[1];return a.hasOwnProperty("zero")&&(this.spec.scales[1].zero=a.zero),a.hasOwnProperty("nice")&&(this.spec.scales[1].nice=a.nice),k(a,b),this},n.prototype.setPadding=function(a){this.spec.hasOwnProperty("padding")||(this.spec.padding={},this.spec.padding.top=0,this.spec.padding.bottom=0,this.spec.padding.left=0,this.spec.padding.right=0);for(var b in a)a.hasOwnProperty(b)&&(this.spec.padding[b]=a[b]);return this.spec.width=this.originalWidth-this.spec.padding.left-this.spec.padding.right,this.spec.height=this.originalHeight-this.spec.padding.top-this.spec.padding.bottom,this},n.prototype.unsetPadding=function(){return delete this.spec.padding,this.spec.width=this.originalWidth,this.spec.height=this.originalHeight,this},n.prototype.setDimension=function(a){a.hasOwnProperty("width")&&(this.spec.width=a.width,this.originalWidth=a.width),a.hasOwnProperty("height")&&(this.spec.height=a.height,this.originalHeight=a.height)},n.prototype.update=function(a){var b=i([a],this.dataTable.metadata);"slide"==this.config.update&&(this.table.shift(),this.dataTable.data.shift()),this.dataTable.data.push(a),console.log(dataTable.data),this.table.push(b[0]),this.chart.data(this.data).update({duration:500})},n.prototype.updateList=function(a){for(var b=a.dataList,c=0;c<b.length;c++)"slide"==this.config.update&&this.dataTable.data.shift(),this.dataTable.data.push(b[c]);for(var d=i(b,this.dataTable.metadata),c=0;c<b.length;c++)"slide"==this.config.update&&this.table.shift(),this.table.push(d[c]);this.chart.data(this.data).update({duration:500})},n.prototype.resize=function(){var a=this,b=(document.getElementById(a.canvas.replace("#","")).offsetHeight,document.getElementById(a.canvas.replace("#","")).offsetWidth,a.spec.width),c=a.spec.height;console.log(b,c),a.chart.width(b).height(c).renderer("svg").update({props:"enter"}).update()},n.prototype.plot=function(a,b){this.dataTable.data=a,o(this.dataTable,this.config.xAxis);var c=i(a,this.dataTable.metadata);this.config.hasOwnProperty("yAxis")&&this.config.yAxis.constructor==Array&&(this.spec.scales[1].domain.field=p(this.dataTable,this.config.yAxis,this.config.aggregate,this.config.xAxis));var d={table:c};void 0==this.config.update&&(this.config.update="slide");var e=this.canvas;this.data=d,this.table=c,console.log(d);var f,g,h,j={};if(this.legend){f=[];for(var k=0;k<a.length;k++){g=a[k][this.legendIndex],h=!1;for(var l=0;l<f.length;l++)if(g==f[l]){h=!0;break}h||f.push(g)}j={duration:600},this.spec.legends[0].values=f}var m=this.spec,n=this.toolTip,q=this.toolTipFunction,r=this;vg.parse.spec(m,function(a){r.chart=a({el:e,renderer:"svg",data:d}).update(),n&&(tool=d3.select("body").append("div").style({position:"absolute",opacity:0,padding:"4px",border:"2px solid ",background:"white"}),r.chart.on("mouseover",q[0]),r.chart.on("mouseout",q[1])),b&&b.call(r),console.log("inside",r)}),console.log(this)},b.DataTable=function(){this.metadata={},this.metadata.names=[],this.metadata.types=[],this.data=[]},b.DataTable.prototype.addColumn=function(a,b){this.metadata.names.push(a),this.metadata.types.push(b)},b.DataTable.prototype.addRow=function(a){this.data.push(a)},b.DataTable.prototype.addRows=function(a){for(var b=0;b<a.length;b++)this.data.push(a[b])},b.DataTable.prototype.getColumnNames=function(){return this.metadata.names},b.DataTable.prototype.getColumnByName=function(a){for(var b={},c=0;c<this.metadata.names.length;c++)if(this.metadata.names[c]==a)return b.name=this.metadata.names[c],b.type=this.metadata.types[c],b},b.DataTable.prototype.getColumnByIndex=function(a){var b=this.metadata.names[a];return b?(b.name=b,b.type=this.metadata.types[a],b):void 0},b.DataTable.prototype.getColumnData=function(a){var b=[];return this.data.map(function(c){b.push(c[a])}),b},b.DataTable.prototype.toJSON=function(){console.log(this)}}(window.igviz||{});