/***igviz.js***/!function(c){function d(a){var b=a.filter(function(a,b,c){return b==c.indexOf(a)});return b}function e(a,b,c,e,f){var g=[],h=[],k=[];for(i=0;i<a.data.length;i++)h[i]=a.data[i][b],k[i]=a.data[i][c];var l=d(k),m=d(h),n=[];for(i=0;i<m.length;i++)for(g[i]=[],n[i]=[],g[i][0]=m[i],j=0;j<l.length;j++){switch(e){case"max":g[i][j+1]=Number.MIN_VALUE;break;case"min":g[i][j+1]=Number.MAX_VALUE;break;default:g[i][j+1]=0}n[i][j+1]=0}for(i=0;i<a.data.length;i++){var o=a.data[i][b],p=a.data[i][c],q=a.data[i][f];n[m.indexOf(o)][1+l.indexOf(p)]++,existing=g[m.indexOf(o)][1+l.indexOf(p)],existingCounter=n[m.indexOf(o)][1+l.indexOf(p)];var r=0;switch(e){case"sum":r=existing+q;break;case"min":r=existing>q?q:existing;break;case"max":r=existing<q?q:existing;break;case"avg":r=(existing*(existingCounter-1)+q)/existingCounter;break;case"count":r=existingCounter}g[m.indexOf(o)][1+l.indexOf(p)]=r}var s={};for(s.metadata={},s.metadata.names=[],s.metadata.types=[],s.data=g,s.metadata.names[0]=a.metadata.names[b]+" \\ "+a.metadata.names[c],s.metadata.types[0]="C",i=0;i<l.length;i++)s.metadata.names[i+1]=l[i],s.metadata.types[i+1]="N";return console.log(s),s}function f(a,b,c){var e=[],f=[],g=[];for(i=0;i<a.data.length;i++)g[i]=a.data[i][b];var h=d(g);for(i=0;i<h.length;i++)for(e[i]=[],f[i]=0,j=0;j<a.metadata.names.length;j++)if(b!=j)switch(c){case"max":e[i][j]=Number.MIN_VALUE;break;case"min":e[i][j]=Number.MAX_VALUE;break;default:e[i][j]=0}else e[i][j]=h[i];for(i=0;i<a.data.length;i++){var k=a.data[i][b];f[h.indexOf(k)]++;var l=e[h.indexOf(k)],m=f[h.indexOf(k)];for(j=0;j<l.length;j++)if(j!=b){var n=l[j],o=a.data[i][j],p=0;switch(c){case"sum":p=n+o;break;case"min":p=n>o?o:n;break;case"max":p=o>n?o:n;break;case"avg":p=(n*(m-1)+o)/m;break;case"count":p=m}e[h.indexOf(k)][j]=p}}return console.log(e),e}function g(a){var b={name:a.name};console.log(a.schema,a.index);var c="table";if(b.range=a.range,void 0!=a.index)switch(a.schema.types[a.index]){case"T":b.type="time";break;case"U":b.type="utc";break;case"C":b.type="ordinal","c"===b.name&&(b.range="category20");break;case"N":b.type="linear"}else b.type=a.type;return a.hasOwnProperty("dataFrom")&&(c=a.dataFrom),b.range=a.range,b.domain={data:c,field:a.field},a.hasOwnProperty("round")&&(b.round=a.round),a.hasOwnProperty("nice")&&(b.nice=a.nice),a.hasOwnProperty("padding")&&(b.padding=a.padding),a.hasOwnProperty("reverse")&&(b.reverse=a.reverse),a.hasOwnProperty("sort")&&(b.sort=a.sort),"x"==b.name&&"linear"==b.type&&(b.sort=!0),a.hasOwnProperty("clamp")&&(b.clamp=a.clamp),a.hasOwnProperty("zero")&&(b.zero=a.zero),console.log(b),b}function h(a,b,c,d){var e={type:"x",scale:"x",title:a,orient:d,values:[],properties:{title:{fill:{value:b},fontSize:{value:c}},axis:{strokeOpacity:{value:0}}}};return e}function m(a){console.log("Axis",a);var b={type:a.type,scale:a.scale,title:a.title,grid:a.grid,properties:{ticks:{},majorTicks:{strokeWidth:{value:2}},labels:{angle:{value:a.angle},align:{value:a.align},baseline:{value:"middle"},dx:{value:a.dx},dy:{value:a.dy}},title:{fontSize:{value:16},dx:{value:a.titleDx},dy:{value:a.titleDy}},axis:{stroke:{value:"#333"},strokeWidth:{value:1.5}}}};return a.hasOwnProperty("tickSize")&&(b.tickSize=a.tickSize),a.hasOwnProperty("tickPadding")&&(b.tickPadding=a.tickPadding),console.log("SpecAxis",b),b}function n(a,b,c){var d=[];for(i=0;i<a.length;i++){var e={},f=c.names;for(j=0;j<f.length;j++)e[o(f[j])]="T"==c.types[j]?new Date(a[i][j]):"U"==c.types[j]?new Date(a[i][j]).getTime():a[i][j];d[i]=e}return console.log(d),d}function o(a){return a.replace(" ","_")}function p(a,b){var c={};c.tickSize="tickSize",c.tickPadding="tickPadding",c.title="title",c.grid="grid",c.offset="offset",c.ticks="ticks",c.labelColor="fill",c.labelAngle="angle",c.labelAlign="align",c.labelFontSize="fontSize",c.labelDx="dx",c.labelDy="dy",c.labelBaseLine="baseline",c.titleDx="dx",c.titleDy="dy",c.titleFontSize="fontSize",c.axisColor="stroke",c.axisWidth="strokeWidth",c.tickColor="stroke",c.tickWidth="strokeWidth",console.log("previous Axis",b);for(var d in a)"tickSize"!=d&&"tickPadding"!=d&&a.hasOwnProperty(d)&&(0==d.indexOf("label")?b.properties.labels[c[d]].value=a[d]:0==d.indexOf("ticks")?b.properties.ticks[c[d]].value=a[d]:0==d.indexOf("title")&&"title"!=d?b.properties.title[c[d]].value=a[d]:"title"==d?b.title=a[d]:0==d.indexOf("axis")?b.properties.axis[c[d]].value=a[d]:b[c[d]]=a[d]);console.log("NEW SPEC",b)}function q(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];var d=(b/a.length).toFixed(4);return d}function r(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d][b]);return c}function s(a,b,c){this.dataTable=c,this.config=b,this.canvas=a}function t(a,b){a.data.sort("U"==a.metadata.types[b]||"T"==a.metadata.types[b]?function(a,c){return new Date(a[b]).getTime()-new Date(c[b]).getTime()}:"C"==a.metadata.types[b]?function(a,c){return a[b].localeCompare(c[b])}:function(a,c){return a[b]-c[b]})}function u(a,b,c,d){var e=JSON.parse(JSON.stringify(a));void 0!=c&&(e.data=f(a,d,c));var g=-1,h=Number.NEGATIVE_INFINITY;for(i=0;i<b.length;i++){var j=d3.max(r(e.data,b[i]));console.log(r(e.data,b[i])),j>=h&&(g=i,h=j)}return void 0==c?"data."+o(a.metadata.names[b[g]]):"count"==c?"data."+c:"data."+c+"_"+o(a.metadata.names[b[g]])}window.igviz=c,c["var"]=20,c.draw=function(a,b,c){var d=new s(a,b,c);return"singleNumber"==b.chartType?d.diagram=this.drawSingleNumberDiagram(d):"map"==b.chartType?d.diagram=this.drawMap(a,b,c):"table"==b.chartType?d.diagram=this.drawTable(a,b,c):"arc"==b.chartType?d.diagram=this.drawArc(a,b,c):"drill"==b.chartType&&(d.diagram=this.drillDown(0,a,b,c,c)),d},c.setUp=function(a,b,c){c.hasOwnProperty("metadata")||(newDataTable={metadata:c,data:[]},c=newDataTable,console.log(c));var d=new s(a,b,c);return"bar"==b.chartType?this.drawBarChart(d,a,b,c):"scatter"==b.chartType?this.drawScatterPlot(d):"line"==b.chartType?this.drawLineChart(d):"area"==b.chartType?this.drawAreaChart(d):"series"==b.chartType&&this.drawSeries(d),d},c.drawSeries=function(a){var b=(a.canvas,a.config),c=a.dataTable,d="data."+o(c.metadata.names[b.xAxis]),e=[];for(i=0;i<b.yAxis.length;i++)e[i]="data."+o(c.metadata.names[b.yAxis[i]]);var f={index:b.xAxis,schema:c.metadata,name:"x",range:"width",clamp:!1,field:d},h={index:b.yAxis[0],schema:c.metadata,name:"y",range:"height",nice:!0,field:e[0]},j=g(f),k=g(h),l={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},n={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=m(l),q=m(n),r=160,s={width:b.width-r,height:b.height,data:[{name:"table"}],scales:[j,k,{name:"color",type:"ordinal",range:"category20"}],axes:[p,q],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};for(i=0;i<b.yAxis.length;i++){var t={type:"rect",key:d,from:{data:"table"},properties:{enter:{x:{scale:"x",field:d},y:{scale:"y",field:e[i]},y2:{scale:"y",value:0},width:{value:2},fill:{scale:"color",value:c.metadata.names[b.yAxis[i]]}}}},u={type:"symbol",key:d,from:{data:"table"},properties:{enter:{" x":{value:b.width-r},y:{scale:"y:prev",field:e[i]},fill:{scale:"color",value:c.metadata.names[b.yAxis[i]]}},update:{x:{scale:"x",field:d},y:{scale:"y",field:e[i]}},exit:{x:{value:0},y:{scale:"y",field:e[i]},fillOpacity:{value:0}}}};b.lineMark&&s.marks.push(t),b.pointMark&&s.marks.push(u),s.legends[0].values.push(c.metadata.names[b.yAxis[i]])}a.spec=s},c.drawLineChart=function(a){var b=(a.canvas,a.config),d=a.dataTable;if(void 0!=b.aggregate)return c.drawAggregatedLine(a);var e="data."+o(d.metadata.names[b.xAxis]),f=[];for(i=0;i<b.yAxis.length;i++)f[i]="data."+o(d.metadata.names[b.yAxis[i]]);var h={index:b.xAxis,schema:d.metadata,name:"x",range:"width",clamp:!1,field:e},j={index:b.yAxis[0],schema:d.metadata,name:"y",range:"height",nice:!0,field:f[0]},k=g(h),l=g(j),n={type:"x",scale:"x",angle:-35,title:d.metadata.names[b.xAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},p={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},q=m(n),r=m(p);void 0==b.interpolationMode&&(b.interpolationMode="monotone");var s=160,t={width:b.width-s,height:b.height,data:[{name:"table"}],scales:[k,l,{name:"color",type:"ordinal",range:"category20"}],axes:[q,r],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};for(void 0==b.markerSize&&(b.markerSize=30),i=0;i<b.yAxis.length;i++){var u={type:"line",key:e,from:{data:"table"},properties:{enter:{x:{value:b.width-s},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:f[i]},stroke:{scale:"color",value:d.metadata.names[b.yAxis[i]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:e},y:{scale:"y",field:f[i]}},exit:{x:{value:0},y:{scale:"y",field:f[i]}}}},v={type:"symbol",key:e,from:{data:"table"},properties:{enter:{" x":{value:b.width-s},y:{scale:"y:prev",field:f[i]},fill:{scale:"color",value:d.metadata.names[b.yAxis[i]]},size:{value:b.markerSize}},update:{x:{scale:"x",field:e},y:{scale:"y",field:f[i]}},exit:{x:{value:0},y:{scale:"y",field:f[i]},fillOpacity:{value:0}}}};t.marks.push(u),b.pointVisible&&t.marks.push(v),t.legends[0].values.push(d.metadata.names[b.yAxis[i]])}a.toolTipFunction=[],a.toolTipFunction[0]=function(a,c){if("symbol"==c.mark.marktype){var e=d.metadata.names[b.xAxis],g=d3.scale.category20(),h=-1;for(index=0;index<f.length;index++)if(c.fill===g(f[index])){h=index;break}var i=d.metadata.names[b.yAxis[h]],j=o(i),k="<table><tr><td> X </td><td> ("+e+") </td><td>"+c.datum.data[o(e)]+"</td></tr><tr><td> Y </td><td> ("+i+") </td><td>"+c.datum.data[j]+"</td></tr></table>";tool.html(k).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.spec=t,a.toolTip=!0,a.spec=t},c.drawAggregatedLine=function(a){var b=a.config,c=a.dataTable,d="data."+o(c.metadata.names[b.xAxis]),e=[],f="sum";void 0!=b.aggregate&&(f=b.aggregate);var j=[],k=[];for(i=0;i<b.yAxis.length;i++)e[i]="data."+o(c.metadata.names[b.yAxis[i]]),j[i]="data."+f+"_"+o(c.metadata.names[b.yAxis[i]]),k.push({op:f,field:e[i]});console.log("values",k,j,e),"count"==f&&(j="data.count");var l={index:b.xAxis,schema:c.metadata,name:"x",range:"width",round:!0,field:d,clamp:!1,dataFrom:"myTable"},n={type:"linear",name:"y",range:"height",nice:!0,field:j[0],dataFrom:"myTable"},p=g(l),q=g(n),r={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},s={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},t=m(r),u=m(s),v=h(b.title,"black",12,"top");void 0==b.interpolationMode&&(b.interpolationMode="monotone");var w={width:b.width-150,height:b.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[d],fields:k}]}],scales:[p,q,{name:"color",type:"ordinal",range:"category20"}],axes:[t,u,v],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};for(void 0==b.markerSize&&(b.markerSize=30),i=0;i<b.yAxis.length;i++){var x={type:"line",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:j[i]},stroke:{scale:"color",value:c.metadata.names[b.yAxis[i]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:j[i]}},exit:{x:{value:0},y:{scale:"y",field:j[i]}}}},y={type:"symbol",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},y:{scale:"y:prev",field:j[i]},fill:{scale:"color",value:c.metadata.names[b.yAxis[i]]},size:{value:b.markerSize}},update:{x:{scale:"x",field:d},y:{scale:"y",field:j[i]}},exit:{x:{value:0},y:{scale:"y",field:j[i]},fillOpacity:{value:0}}}};w.marks.push(x),b.pointVisible&&w.marks.push(y),w.legends[0].values.push(c.metadata.names[b.yAxis[i]])}a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){if(console.log(tool,a,d),"symbol"==d.mark.marktype){var f=c.metadata.names[b.xAxis],g=d3.scale.category20(),h=-1;for(index=0;index<e.length;index++)if(d.fill===g(e[index])){h=index;break}var i=c.metadata.names[b.yAxis[h]],j=o(i),k="<table><tr><td> X </td><td> ("+f+") </td><td>"+d.datum.data[f]+"</td></tr><tr><td> Y </td><td> ("+i+") </td><td>"+d.datum.data[b.aggregate+"_"+j]+"</td></tr></table>";tool.html(k).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.toolTip=!0,a.spec=w},c.drawBarChart=function(a,b,c,d){var c=(a.canvas,a.config),d=a.dataTable;if(c.hasOwnProperty("aggregate"))return this.drawAggregatedBar(a);if(c.hasOwnProperty("groupedBy")){var e="grouped";return c.hasOwnProperty("format")&&(e=c.format),"grouped"==e?(console.log("groupedDFJSDFKSD:JFKDJF"),"H"==c.orientation?(console.log("horizontal"),this.drawGroupedBarChart(a)):this.drawGroupedBarChartVertical(a)):this.drawStackedBarChart(a)}var f="data."+o(d.metadata.names[c.xAxis]),h="data."+o(d.metadata.names[c.yAxis]),i={index:c.xAxis,schema:d.metadata,name:"x",range:"width",round:!0,field:f},j={index:c.yAxis,schema:d.metadata,name:"y",range:"height",nice:!0,field:h},k=g(i),l=g(j),n={type:"x",scale:"x",angle:-35,title:d.metadata.names[c.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},p={type:"y",scale:"y",angle:0,title:d.metadata.names[c.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},q=m(n),r=m(p);void 0==c.barColor&&(c.barColor="steelblue");var s={width:c.width-150,height:c.height,data:[{name:"table"}],scales:[k,l],axes:[q,r],marks:[{key:f,type:"rect",from:{data:"table"},properties:{enter:{x:{scale:"x",field:f},width:{scale:"x",band:!0,offset:-10},y:{scale:"y:prev",field:h},y2:{scale:"y",value:0}},update:{x:{scale:"x",field:f},y:{scale:"y",field:h},y2:{scale:"y",value:0},fill:{value:c.barColor}},exit:{x:{value:0},y:{scale:"y:prev",field:h},y2:{scale:"y",value:0}},hover:{fill:{value:"orange"}}}}]};a.originalWidth=c.width,a.originalHeight=c.height,a.spec=s},c.drawAggregatedBar=function(a){var b=a.config,c=a.dataTable,d="data."+o(c.metadata.names[b.xAxis]),e="data."+o(c.metadata.names[b.yAxis]),f="sum";void 0!=b.aggregate&&(f=b.aggregate);var i="data."+f+"_"+o(c.metadata.names[b.yAxis]);"count"==f&&(i="data.count"),console.log(d,e,i,f);var j={index:b.xAxis,schema:c.metadata,name:"x",range:"width",round:!0,field:d,dataFrom:"myTable"},k={type:"linear",name:"y",range:"height",nice:!0,field:i,dataFrom:"myTable"},l=g(j),n=g(k),p={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},q={type:"y",scale:"y",angle:0,title:c.metadata.names[b.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},r=m(p),s=m(q),t=h(b.title);void 0==b.barColor&&(b.barColor="steelblue");var u={width:b.width-150,height:b.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[d],fields:[{op:f,field:e}]}]}],scales:[l,n],axes:[r,s,t],marks:[{key:d,type:"rect",from:{data:"myTable"},properties:{enter:{x:{scale:"x",field:d},width:{scale:"x",band:!0,offset:-10},y:{scale:"y:prev",field:i},y2:{scale:"y",value:0}},update:{x:{scale:"x",field:d},y:{scale:"y",field:i},y2:{scale:"y",value:0},fill:{value:b.barColor}},exit:{x:{value:0},y:{scale:"y:prev",field:i},y2:{scale:"y",value:0}},hover:{fill:{value:"orange"}}}}]};a.spec=u},c.drawGroupedBarChart=function(a){var b=a.config,c=a.dataTable,d=(a.canvas,"data."+o(c.metadata.names[b.xAxis])),e="data."+o(c.metadata.names[b.yAxis]),f="data."+o(c.metadata.names[b.groupedBy]),h={index:b.groupedBy,schema:c.metadata,name:"cat",range:"height",field:f,padding:.2},i={index:b.yAxis,schema:c.metadata,name:"val",range:"width",round:"true",field:e,nice:!0},j=g(h),k=g(i),l={type:"x",scale:"val",angle:-35,title:c.metadata.names[b.yAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},n={type:"y",scale:"cat",angle:0,tickSize:0,tickPadding:8,title:c.metadata.names[b.groupedBy],grid:!1,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=m(l),q=m(n),r={width:b.width,height:b.height,data:[{name:"table"}],scales:[j,k,{name:"color",type:"ordinal",range:"category20"}],axes:[p,q],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.xAxis],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[f]}]},properties:{enter:{y:{scale:"cat",field:"key"},height:{scale:"cat",band:!0}}},scales:[{name:"pos",type:"ordinal",range:"height",domain:{field:d}}],marks:[{type:"rect",properties:{enter:{y:{scale:"pos",field:d},height:{scale:"pos",band:!0},x:{scale:"val",field:e},x2:{scale:"val",value:0},fill:{scale:"color",field:d}},hover:{fillOpacity:{value:.5}},update:{fillOpacity:{value:1}}}}]}]};a.legend=!0,a.legendIndex=b.xAxis,a.spec=r},c.drawGroupedBarChartVertical=function(a){var b=a.config,c=a.dataTable,d=(a.canvas,"data."+o(c.metadata.names[b.xAxis])),e="data."+o(c.metadata.names[b.yAxis]),f="data."+o(c.metadata.names[b.groupedBy]),h={index:b.groupedBy,schema:c.metadata,name:"cat",range:"width",field:f,padding:.2},i={index:b.yAxis,schema:c.metadata,name:"val",range:"height",round:"true",field:e,nice:!0},j=g(h),k=g(i),l={type:"y",scale:"val",angle:-35,title:c.metadata.names[b.yAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},n={type:"x",scale:"cat",angle:0,tickSize:0,tickPadding:8,title:c.metadata.names[b.groupedBy],grid:!1,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=m(n),q=m(l),r={width:b.width-150,height:b.height,data:[{name:"table"}],scales:[j,k,{name:"color",type:"ordinal",range:"category20"}],axes:[p,q],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.xAxis],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[f]}]},properties:{enter:{x:{scale:"cat",field:"key"},width:{scale:"cat",band:!0}}},scales:[{name:"pos",type:"ordinal",range:"width",domain:{field:d}}],marks:[{type:"rect",properties:{enter:{x:{scale:"pos",field:d},width:{scale:"pos",band:!0},y:{scale:"val",field:e},y2:{scale:"val",value:0},fill:{scale:"color",field:d}},hover:{fillOpacity:{value:.5}},update:{fillOpacity:{value:1}}}}]}]};a.legend=!0,a.legendIndex=b.xAxis,a.spec=r},c.drawStackedBarChart=function(a){var b=a.config,c=a.dataTable,d=(a.canvas,"data."+o(c.metadata.names[b.xAxis])),e="data."+o(c.metadata.names[b.yAxis]),f="data."+o(c.metadata.names[b.groupedBy]),h={index:b.groupedBy,schema:c.metadata,name:"cat",range:"width",field:f,padding:.2},i={index:b.yAxis,schema:c.metadata,name:"val",range:"height",dataFrom:"stats",field:"sum",nice:!0},j=g(h),k=g(i),l={type:"x",scale:"cat",angle:0,title:c.metadata.names[b.groupedBy],grid:!1,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},n={type:"y",scale:"val",angle:0,title:c.metadata.names[b.yAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=m(l),q=m(n),r={width:b.width-160,height:b.height-100,padding:{top:10,left:60,bottom:60,right:100},data:[{name:"table"},{name:"stats",source:"table",transform:[{type:"facet",keys:[f]},{type:"stats",value:e}]}],scales:[j,k,{name:"color",type:"ordinal",range:"category20"}],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.xAxis],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],axes:[p,q],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[d]},{type:"stack",point:f,height:e}]},marks:[{type:"rect",properties:{enter:{x:{scale:"cat",field:f},width:{scale:"cat",band:!0,offset:-1},y:{scale:"val",field:"y"},y2:{scale:"val",field:"y2"},fill:{scale:"color",field:d}},update:{fillOpacity:{value:1}},hover:{fillOpacity:{value:.5}}}}]}]};a.legend=!0,a.legendIndex=b.xAxis,a.spec=r},c.drillDown=function(d,e,f,g,h){0==d&&(d3.select(e).append("div").attr({id:"links",height:20,bgcolor:"blue"}),d3.select(e).append("div").attr({id:"chartDiv"}),f.height=f.height-20,e="#chartDiv");var j=JSON.parse(JSON.stringify(f)),m=0;m=d<f.xAxis.length?f.xAxis[d].index:f.xAxis[d-1].child;var n=f.yAxis,o={metadata:{names:[g.metadata.names[m],g.metadata.names[n]],types:[g.metadata.types[m],g.metadata.types[n]]},data:[]},p=[];for(i=0;i<g.data.length;i++){name=g.data[i][m],currentYvalue=g.data[i][n],isFound=!1;for(var q=0;q<p.length;q++)if(p[q][0]===name){isFound=!0;break}isFound?(p[q][1]+=currentYvalue,console.log(name,currentYvalue,p[q][1])):(console.log("create",name,currentYvalue),p.push([name,currentYvalue]))}o.data=p,j.xAxis=0,j.yAxis=1,j.chartType="bar";var r=this.setUp(e,j,o);r.plot(o.data,function(){var i=d3.select("#links .root").on("click",function(){d3.select("#links").html(""),c.drillDown(0,e,f,h,h)}),i=d3.select("#links").selectAll(".filter");i.on("click",function(a,b){var d=i.data();console.log(d);var g=[],j=JSON.parse(JSON.stringify(h)),m=0;for(l=0;l<h.data.length;l++){var n=!0;for(k=0;k<=b;k++)if(h.data[l][d[k][0]]!==d[k][1]){n=!1;break}n&&(g[m++]=h.data[l])}d3.selectAll("#links g").each(function(a,c){c>b&&this.remove()}),j.data=g,c.drillDown(b+1,e,f,j,h,!0)}),d<f.xAxis.length&&(console.log(r),d3.select(r.chart._el).selectAll("g.type-rect rect").on("click",function(i,j){console.log(i,j,this),console.log(i,j);{var k=i.datum.data[r.dataTable.metadata.names[r.config.xAxis]],l=JSON.parse(JSON.stringify(g));d3.select("#links").append("g").append("text").text(g.metadata.names[m]+" : ").attr({"font-size":"10px",x:10,y:20})}d3.select("#links:first-child").selectAll("text").attr("class","root"),d3.select("#links g:last-child").append("span").data([[m,k]]).attr("class","filter").text(k+"  >  ");var n=l.data.length,o=[];for(b=0,a=0;a<n;a++)l.data[a][m]===k&&(o[b++]=l.data[a]);l.data=o,c.drillDown(d+1,e,f,l,h,!0)}))})},c.drawAreaChart=function(a){var b=a.config,c=a.dataTable;if(b.yAxis.constructor===Array)return this.drawMultiAreaChart(a);if(void 0!=b.aggregate)return this.drawAggregatedArea(a);if(b.hasOwnProperty("areaVar"))return this.drawStackedAreaChart(a);var d=(a.canvas,"data."+o(c.metadata.names[b.xAxis])),e="data."+o(c.metadata.names[b.yAxis]),f={index:b.xAxis,schema:c.metadata,name:"x",range:"width",field:d},h={index:b.yAxis,schema:c.metadata,name:"y",range:"height",field:e},i=g(f),j=g(h),k={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!0,dx:-10,dy:10,align:"right",titleDy:10,titleDx:0},l={type:"y",scale:"y",angle:0,title:c.metadata.names[b.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},n=m(k),p=m(l);void 0==b.interpolationMode&&(b.interpolationMode="monotone");var q=100,r={width:b.width-100,height:b.height,data:[{name:"table"}],scales:[i,j,{name:"color",type:"ordinal",range:"category10"}],axes:[n,p],marks:[{type:"area",key:d,from:{data:"table"},properties:{enter:{x:{value:b.width-q},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:e},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:2},fillOpacity:{value:.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:e},y2:{scale:"y",value:0}},exit:{x:{value:0},y:{scale:"y",field:e},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}}}},{type:"line",key:d,from:{data:"table"},properties:{enter:{x:{value:b.width-q},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:e},stroke:{scale:"color",value:2},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:e}},exit:{x:{value:0},y:{scale:"y",field:e}}}}]};b.pointVisible&&(void 0==b.markerSize&&(b.markerSize=30),r.marks.push({type:"symbol",from:{data:"table"},properties:{enter:{x:{value:b.width-q},y:{scale:"y:prev",field:e},fill:{scale:"color",value:2},size:{value:b.markerSize}},update:{size:{value:50},x:{scale:"x",field:d},y:{scale:"y",field:e}},exit:{x:{value:0},y:{scale:"y",field:e}},hover:{size:{value:b.markerSize},stroke:{value:"white"}}}})),a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){console.log(tool,a,d),"symbol"==d.mark.marktype&&(xVar=c.metadata.names[b.xAxis],yVar=c.metadata.names[b.yAxis],contentString="<table><tr><td> X </td><td> ("+xVar+") </td><td>"+d.datum.data[o(xVar)]+"</td></tr><tr><td> Y </td><td> ("+yVar+") </td><td>"+d.datum.data[o(yVar)]+"</td></tr></table>",tool.html(contentString).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px"))},a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.spec=r,a.toolTip=!0,a.spec=r},c.drawAggregatedArea=function(a){var b,c=a.config,d=a.dataTable,e="data."+o(d.metadata.names[c.xAxis]),f="sum";void 0!=c.aggregate&&(f=c.aggregate);var i,j=[];b="data."+o(d.metadata.names[c.yAxis]),i="data."+f+"_"+o(d.metadata.names[c.yAxis]),console.log("values",j,i,b),"count"==f&&(i="data.count");var k={index:c.xAxis,schema:d.metadata,name:"x",range:"width",round:!0,field:e,clamp:!1,dataFrom:"myTable"},l={type:"linear",name:"y",range:"height",nice:!0,field:i,dataFrom:"myTable"},n=g(k),p=g(l),q={type:"x",scale:"x",angle:-35,title:d.metadata.names[c.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},r={type:"y",scale:"y",angle:0,title:d.metadata.names[c.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},s=m(q),t=m(r),u=h(c.title,"black",12,"top");void 0==c.interpolationMode&&(c.interpolationMode="monotone");var v={width:c.width-170,height:c.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[e],fields:[{op:f,field:b}]}]}],scales:[n,p,{name:"color",type:"ordinal",range:"category20"}],axes:[s,t,u],marks:[{type:"area",key:e,from:{data:"myTable"},properties:{enter:{x:{scale:"x",field:e},interpolate:{value:c.interpolationMode},y:{scale:"y:prev",field:i},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:d.metadata.names[c.yAxis]},fillOpacity:{value:.5}},update:{x:{scale:"x",field:e},y:{scale:"y",field:i},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}},exit:{x:{value:0},y:{scale:"y",field:i},y2:{scale:"y",value:0}}}},{type:"line",key:e,from:{data:"myTable"},properties:{enter:{x:{value:c.width-100},interpolate:{value:c.interpolationMode},y:{scale:"y:prev",field:i},stroke:{scale:"color",value:d.metadata.names[c.yAxis]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:e},y:{scale:"y",field:i}},exit:{x:{value:0},y:{scale:"y",field:i}}}},{type:"symbol",key:e,from:{data:"myTable"},properties:{enter:{x:{value:c.width-100},y:{scale:"y:prev",field:i},fill:{scale:"color",value:d.metadata.names[c.yAxis]}},update:{x:{scale:"x",field:e},y:{scale:"y",field:i}},exit:{x:{value:0},y:{scale:"y",field:i},fillOpacity:{value:0}}}}]};a.toolTipFunction=[],a.toolTipFunction[0]=function(b,e){console.log(tool,b,e),"symbol"==e.mark.marktype&&(xVar=d.metadata.names[c.xAxis],yVar=d.metadata.names[c.yAxis],contentString="<table><tr><td> X </td><td> ("+xVar+") </td><td>"+e.datum.data[xVar]+"</td></tr><tr><td> Y </td><td> ("+yVar+") </td><td>"+e.datum.data[yVar]+"</td></tr></table>",tool.html(contentString).style({left:b.pageX+10+"px",top:b.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")),a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.toolTip=!0,a.spec=v}},c.drawAggregatedMultiArea=function(a){var b=a.config,c=a.dataTable,d="data."+o(c.metadata.names[b.xAxis]),e=[],f="sum";void 0!=b.aggregate&&(f=b.aggregate);var j=[],k=[];for(i=0;i<b.yAxis.length;i++)e[i]="data."+o(c.metadata.names[b.yAxis[i]]),j[i]="data."+f+"_"+o(c.metadata.names[b.yAxis[i]]),k.push({op:f,field:e[i]});console.log("values",k,j,e),"count"==f&&(j="data.count");var l={index:b.xAxis,schema:c.metadata,name:"x",range:"width",round:!0,field:d,clamp:!1,dataFrom:"myTable"},n={type:"linear",name:"y",range:"height",nice:!0,field:j[0],dataFrom:"myTable"},p=g(l),q=g(n),r={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!1,dx:0,dy:0,align:"right",titleDy:30,titleDx:0},s={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-35,titleDx:0},t=m(r),u=m(s),v=h(b.title,"black",12,"top");void 0==b.interpolationMode&&(b.interpolationMode="monotone");var w={width:b.width-170,height:b.height,data:[{name:"table"},{name:"myTable",source:"table",transform:[{type:"aggregate",groupby:[d],fields:k}]}],scales:[p,q,{name:"color",type:"ordinal",range:"category20"}],axes:[t,u,v],legends:[{orient:"right",fill:"color",title:"Legend",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],marks:[]};for(void 0==b.markerSize&&(b.markerSize=30),i=0;i<b.yAxis.length;i++){var x={type:"area",key:d,from:{data:"myTable"},properties:{enter:{x:{scale:"x",field:d},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:j[i]},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:c.metadata.names[b.yAxis[i]]},fillOpacity:{value:.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:j[i]},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}},exit:{x:{value:0},y:{scale:"y",field:j[i]},y2:{scale:"y",value:0}}}},y={type:"line",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},interpolate:{value:b.interpolationMode},y:{scale:"y:prev",field:j[i]},stroke:{scale:"color",value:c.metadata.names[b.yAxis[i]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:d},y:{scale:"y",field:j[i]}},exit:{x:{value:0},y:{scale:"y",field:j[i]}}}},z={type:"symbol",key:d,from:{data:"myTable"},properties:{enter:{x:{value:b.width-100},y:{scale:"y:prev",field:j[i]},fill:{scale:"color",value:c.metadata.names[b.yAxis[i]]},size:{value:b.markerSize}},update:{x:{scale:"x",field:d},y:{scale:"y",field:j[i]}},exit:{x:{value:0},y:{scale:"y",field:j[i]},fillOpacity:{value:0}}}};w.marks.push(x),w.marks.push(y),b.pointVisible&&w.marks.push(z),w.legends[0].values.push(c.metadata.names[b.yAxis[i]])}a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){if(console.log(tool,a,d),"symbol"==d.mark.marktype){var f=c.metadata.names[b.xAxis],g=d3.scale.category20(),h=-1;for(index=0;index<e.length;index++)if(d.fill===g(e[index])){h=index;break}var i=c.metadata.names[b.yAxis[h]];contentString="<table><tr><td> X </td><td> ("+f+") </td><td>"+d.datum.data[o(f)]+"</td></tr><tr><td> Y </td><td> ("+i+") </td><td>"+d.datum.data[b.aggregate+"_"+o(i)]+"</td></tr></table>",tool.html(contentString).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.toolTip=!0,a.spec=w},c.drawMultiAreaChart=function(b){var d=(b.canvas,b.config),e=b.dataTable;if(void 0!=d.aggregate)return c.drawAggregatedMultiArea(b);var f="data."+o(e.metadata.names[d.xAxis]),h=[];for(i=0;i<d.yAxis.length;i++)h[i]="data."+o(e.metadata.names[d.yAxis[i]]);var j={index:d.xAxis,schema:e.metadata,name:"x",range:"width",clamp:!1,field:f},k={index:d.yAxis[0],schema:e.metadata,name:"y",range:"height",nice:!0,field:h[0]},l=g(j),n=g(k),p={type:"x",scale:"x",angle:-35,title:e.metadata.names[d.xAxis],grid:!0,dx:-10,dy:10,align:"left",titleDy:10,titleDx:0},q={type:"y",
scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},r=m(p),s=m(q);void 0==d.interpolationMode&&(d.interpolationMode="monotone");var t=160,u={width:d.width-t,height:d.height,data:[{name:"table"}],scales:[l,n,{name:"color",type:"ordinal",range:"category20"}],legends:[{orient:"right",fill:"color",title:"Area",values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:1.5}}}}],axes:[r,s],marks:[]};for(void 0==d.markerSize&&(d.markerSize=30),i=0;i<d.yAxis.length;i++){var v={type:"area",key:f,from:{data:"table"},properties:{enter:{x:{scale:"x",field:f},interpolate:{value:d.interpolationMode},y:{scale:"y:prev",field:h[i]},y2:{scale:"y:prev",value:0},fill:{scale:"color",value:e.metadata.names[d.yAxis[i]]},fillOpacity:{value:.5}},update:{x:{scale:"x",field:f},y:{scale:"y",field:h[i]},y2:{scale:"y",value:0}},hover:{fillOpacity:{value:.2}},exit:{x:{value:0},y:{scale:"y",field:h[i]},y2:{scale:"y",value:0}}}},w={type:"line",key:f,from:{data:"table"},properties:{enter:{x:{scale:"x",field:f},interpolate:{value:d.interpolationMode},y:{scale:"y:prev",field:h[i]},stroke:{scale:"color",value:e.metadata.names[d.yAxis[i]]},strokeWidth:{value:1.5}},update:{x:{scale:"x",field:f},y:{scale:"y",field:h[i]}},exit:{x:{value:0},y:{scale:"y",field:h[i]}}}},x={type:"symbol",from:{data:"table"},properties:{enter:{x:{scale:"x",field:f},y:{scale:"y:prev",field:h[i]},fill:{scale:"color",value:e.metadata.names[d.yAxis[i]]},size:{value:d.markerSize}},update:{x:{scale:"x",field:f},y:{scale:"y",field:h[i]}},exit:{x:{value:0},y:{scale:"y",field:h[i]}},hover:{size:{value:1.5*d.markerSize},stroke:{value:"white"}}}};u.marks.push(v),d.pointVisible&&u.marks.push(x),u.marks.push(w),u.legends[0].values.push(e.metadata.names[d.yAxis[i]])}b.toolTipFunction=[],b.toolTipFunction[0]=function(b,c){if(a=4,console.log(tool,b,c),"symbol"==c.mark.marktype){var f=e.metadata.names[d.xAxis],g=d3.scale.category20(),i=-1;for(index=0;index<h.length;index++)if(c.fill===g(h[index])){i=index;break}var j=e.metadata.names[d.yAxis[i]];contentString="<table><tr><td> X </td><td> ("+f+") </td><td>"+c.datum.data[o(f)]+"</td></tr><tr><td> Y </td><td> ("+j+") </td><td>"+c.datum.data[o(j)]+"</td></tr></table>",tool.html(contentString).style({left:b.pageX+10+"px",top:b.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")}},b.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},b.spec=u,b.toolTip=!0,b.spec=u,b.spec=u},c.drawStackedAreaChart=function(a){var b=a.config,c=a.dataTable,d=(a.canvas,"data."+o(c.metadata.names[b.areaVar])),e="data."+o(c.metadata.names[b.yAxis]),f="data."+o(c.metadata.names[b.xAxis]),h={index:b.xAxis,schema:c.metadata,name:"cat",range:"width",field:f,padding:.2,zero:!1,nice:!0},i={index:b.yAxis,schema:c.metadata,name:"val",range:"height",dataFrom:"stats",field:"sum",nice:!0},j=g(h),k=g(i),l={type:"x",scale:"cat",angle:0,title:c.metadata.names[b.xAxis],grid:!0,dx:-10,dy:10,align:"left",titleDy:10,titleDx:0},n={type:"y",scale:"val",angle:0,title:c.metadata.names[b.yAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:-10,titleDx:0},p=m(l),q=m(n),r={width:b.width-160,height:b.height-100,padding:{top:10,left:60,bottom:60,right:100},data:[{name:"table"},{name:"stats",source:"table",transform:[{type:"facet",keys:[f]},{type:"stats",value:e}]}],scales:[j,k,{name:"color",type:"ordinal",range:"category20"}],legends:[{orient:{value:"right"},fill:"color",title:c.metadata.names[b.areaVar],values:[],properties:{title:{fontSize:{value:14}},labels:{fontSize:{value:12}},symbols:{stroke:{value:"transparent"}},legend:{stroke:{value:"steelblue"},strokeWidth:{value:.5}}}}],axes:[p,q],marks:[{type:"group",from:{data:"table",transform:[{type:"facet",keys:[d]},{type:"stack",point:f,height:e}]},marks:[{type:"area",properties:{enter:{interpolate:{value:"monotone"},x:{scale:"cat",field:f},y:{scale:"val",field:"y"},y2:{scale:"val",field:"y2"},fill:{scale:"color",field:d},fillOpacity:{value:.8}},update:{fillOpacity:{value:.8}},hover:{fillOpacity:{value:.5}}}},{type:"line",properties:{enter:{x:{scale:"cat",field:f},interpolate:{value:"monotone"},y:{scale:"val",field:"y"},stroke:{scale:"color",field:d},strokeWidth:{value:3}}}}]}]};a.spec=r,a.legend=!0,a.legendIndex=b.areaVar},c.drawArc=function(a,b,c){function d(a){function c(){function a(a){"function"==typeof j&&j.call()}h.each(function(c){function h(a){var b=(q-r)/(s-r),c=Math.min(360*b,360);c=c*Math.PI/180,y.datum(c),y.transition().duration(k).attrTween("d",e),b>1&&(z.datum(Math.min(360*(b-1),360)*Math.PI/180),z.transition().delay(k).duration(k).attrTween("d",f)),A.datum(Math.round(100*b)),A.transition().duration(k).tween("text",d)}var i=d3.select(this).selectAll("svg").data([c]),j=i.enter().append("svg").attr("class","radial-svg").append("g");g(),i.attr("width",m).attr("height",n);var l=j.append("g").attr("class","component").attr("cursor","pointer").on("click",a);w.endAngle(360*(Math.PI/180)),l.append("rect").attr("class","background").attr("width",_width).attr("height",_height),l.append("path").attr("transform","translate("+_width/2+","+_width/2+")").attr("d",w),l.append("text").attr("class","label").attr("transform","translate("+_width/2+","+(_width+p)+")").text(o);{var u=b.width/2-_width/2,v=b.height/2-_height/2;i.select("g").attr("transform","translate("+u+","+v+")")}w.endAngle(t),j.append("g").attr("class","arcs");var y=i.select(".arcs").selectAll(".arc").data(c);y.enter().append("path").attr("class","arc").attr("transform","translate("+_width/2+","+_width/2+")").attr("d",w);var z=i.select(".arcs").selectAll(".arc2").data(c);z.enter().append("path").attr("class","arc2").attr("transform","translate("+_width/2+","+_width/2+")").attr("d",x),j.append("g").attr("class","labels");var A=i.select(".labels").selectAll(".label").data(c);A.enter().append("text").attr("class","label").attr("y",_width/2+p/3).attr("x",_width/2).attr("cursor","pointer").attr("width",_width).text(function(a){return Math.round((q-r)/(s-r)*100)+"%"}).style("font-size",p+"px").on("click",a),y.exit().transition().duration(500).attr("x",1e3).remove(),h(i)})}function d(a){var b=d3.interpolate(v,a);return v=b(0),function(a){v=b(a),this.textContent=Math.round(b(a))+"%"}}function e(a){var b=d3.interpolate(t,a);return function(a){return t=b(a),w.endAngle(b(a))()}}function f(a){var b=d3.interpolate(u,a);return function(a){return x.endAngle(b(a))()}}function g(){_width=i-l.right-l.left-l.top-l.bottom,_height=_width,p=.2*_width,w.outerRadius(_width/2),w.innerRadius(_width/2*.85),x.outerRadius(_width/2*.85),x.innerRadius(_width/2*.85-_width/2*.15)}var h,i,j,k=1e3,l={top:0,right:0,bottom:30,left:0},m=b.width,n=b.height,o="",p=10,q=0,r=0,s=100,t=0,u=0,v=0,w=d3.svg.arc().startAngle(0*(Math.PI/180)),x=d3.svg.arc().startAngle(0*(Math.PI/180)).endAngle(0);return h=d3.select(a),c.render=function(){return g(),c(),c},c.value=function(a){return arguments.length?(q=[a],h.datum([q]),c):q},c.margin=function(a){return arguments.length?(l=a,c):l},c.diameter=function(a){return arguments.length?(i=a,c):i},c.minValue=function(a){return arguments.length?(r=a,c):r},c.maxValue=function(a){return arguments.length?(s=a,c):s},c.label=function(a){return arguments.length?(o=a,c):o},c._duration=function(a){return arguments.length?(k=a,c):k},c.onClick=function(a){return arguments.length?(j=a,c):j},c}d(a).label("RADIAL 1").diameter(b.diameter).value(b.value).render()},c.drawScatterPlot=function(a){var b=(a.canvas,a.config),c=a.dataTable,d="data."+o(c.metadata.names[b.xAxis]),e="data."+o(c.metadata.names[b.yAxis]),f="data."+o(c.metadata.names[b.pointSize]),h="data."+o(c.metadata.names[b.pointColor]),i={index:b.xAxis,schema:c.metadata,name:"x",range:"width",field:d},j={index:b.pointSize,range:[0,576],schema:c.metadata,name:"r",field:f},k={index:b.pointColor,schema:c.metadata,name:"c",range:[b.minColor,b.maxColor],field:h},l={index:b.yAxis,schema:c.metadata,name:"y",range:"height",nice:!0,field:e},n=g(i),p=g(l),q=g(j),r=g(k),s={type:"x",scale:"x",angle:-35,title:c.metadata.names[b.xAxis],grid:!0,dx:0,dy:0,align:"right",titleDy:25,titleDx:0},t={type:"y",scale:"y",angle:0,title:"values",grid:!0,dx:0,dy:0,align:"right",titleDy:-30,titleDx:0},u=m(s),v=m(t),w={width:b.width-130,height:b.height,data:[{name:"table"}],scales:[n,p,{name:"color",type:"ordinal",range:"category20"},q,r],axes:[u,v],marks:[{type:"symbol",from:{data:"table"},properties:{enter:{x:{scale:"x",field:d},y:{scale:"y",field:e},fill:{scale:"c",field:h}},update:{size:{scale:"r",field:f}},hover:{size:{value:300},stroke:{value:"white"}}}}]};a.toolTipFunction=[],a.toolTipFunction[0]=function(a,d){console.log(tool,a,d),xVar=c.metadata.names[b.xAxis],yVar=c.metadata.names[b.yAxis],pSize=c.metadata.names[b.pointSize],pColor=c.metadata.names[b.pointColor],contentString="<table><tr><td> X </td><td> ("+xVar+") </td><td>"+d.datum.data[xVar]+"</td></tr><tr><td> Y </td><td> ("+yVar+") </td><td>"+d.datum.data[yVar]+"</td></tr><tr><td> Size </td><td> ("+pSize+") </td><td>"+d.datum.data[pSize]+'</td></tr><tr><td bgcolor="'+d.fill+'">&nbsp; </td><td> ('+pColor+") </td><td>"+d.datum.data[pColor]+"</td></tr></table>",tool.html(contentString).style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:1}),tool.selectAll("tr td").style("padding","3px")},a.toolTipFunction[1]=function(a,b){tool.html("").style({left:a.pageX+10+"px",top:a.pageY+10+"px",opacity:0})},a.spec=w,a.toolTip=!0},c.drawSingleNumberDiagram=function(a){var b=a.canvas,d=a.config,e=a.dataTable,f=d.width,g=d.height,h=(d.padding,f/25),i=f/18,j=f/25,k="minValue",l="maxValue",m="avgValue",d={xAxis:d.xAxis,yAxis:1,aggregate:"sum",chartType:"bar",width:600,height:3*g/4};chart=c.setUp(b,d,e),chart.plot(e.data);var n=e.data.map(function(a){return{data:a,config:d}}),o=b+"_svg";d3.select(o).remove();var p=d3.select(b).append("svg").attr("id",o.replace("#","")).attr("width",f).attr("height",g),s=e.data,t=r(s,n[0].config.xAxis),u=p.append("g");p.append("rect").attr("id","rect").attr("x",0).attr("y",0).attr("width",f).attr("height",g),u.append("text").attr("id",k).text("Max: "+d3.max(t)).attr("font-size",j).attr("x",3*f/4).attr("y",6*g/7).style("fill","Red").style("text-anchor","start").style("lignment-baseline","middle"),u.append("text").attr("id",m).text("Avg :"+q(t)).attr("font-size",i).attr("x",f/2).attr("y",6*g/7).style("fill","Green").style("text-anchor","middle").style("lignment-baseline","middle"),u.append("text").attr("id",l).text("Min: "+d3.min(t)).attr("font-size",h).attr("x",f/4).attr("y",6*g/7).style("fill","Black").style("text-anchor","end").style("lignment-baseline","middle")},c.drawTable=function(b,c,d){c.width,c.height,c.padding,c.dataSeries,c.highlightMode;void 0!=c.rowIndex&&void 0!=c.columnIndex?d=e(d,c.rowIndex,c.columnIndex,c.aggregate,c.cellIndex):void 0!=c.aggregate&&(d=f(d,c.groupedBy,c.aggregate));d.data.map(function(a){return{data:a,config:c}});d3.select(b).select("table").remove();var g=d.metadata.names,h=d.data,i=[{r:255,g:0,b:0},{r:0,g:255,b:0},{r:200,g:100,b:100},{r:200,g:255,b:250},{r:255,g:140,b:100},{r:230,g:100,b:250},{r:0,g:138,b:230},{r:165,g:42,b:42},{r:127,g:0,b:255},{r:0,g:255,b:255}],k=d3.scale.linear().domain([0,100]).range([0,1]),l=d3.select(b).append("table").attr("class","table table-bordered"),m=d3.scale.linear().domain([2.5,4]).range(["#F5BFE8","#E305AF"]),n=d3.scale.linear().domain([0,100]).range([15,20]);thead=l.append("thead"),tbody=l.append("tbody"),thead.append("tr").selectAll("th").data(g).enter().append("th").text(function(a){return a});var o,p=c.colorBasedStyle,q=c.fontBasedStyle,s=tbody.selectAll("tr").data(h).enter().append("tr");if(c.heatMap){var t=d.data[0][1],u=d.data[0][1];for(j=0;j<d.data.length;j++)for(a=0;a<d.metadata.names.length;a++)"N"==d.metadata.types[a]&&(d.data[j][a]>u&&(u=d.data[j][a]),d.data[j][a]<t&&(t=d.data[j][a]));k.domain([t,u]),o=s.selectAll("td").data(function(a,b){return console.log(a,b),a}).enter().append("td").text(function(a,b){return a}).style("background-color",function(a,b){return"rgba("+i[0].r+","+i[0].g+","+i[0].b+","+k(a)+")"})}else 1==p&&1==q?o=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}).style("font-size",function(a,b){return n.domain([d3.min(r(h,b)),d3.max(r(h,b))]),n(a)+"px"}).style("background-color",function(a,b){return k.domain([d3.min(r(h,b)),d3.max(r(h,b))]),"rgba("+i[b].r+","+i[b].g+","+i[b].b+","+k(a)+")"}):p&&!q?o=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}).style("background-color",function(a,b){return k.domain([d3.min(r(h,b)),d3.max(r(h,b))]),"rgba("+i[b].r+","+i[b].g+","+i[b].b+","+k(a)+")"}):!p&&q?o=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}).style("font-size",function(a,b){return n.domain([d3.min(r(h,b)),d3.max(r(h,b))]),n(a)+"px"}):(console.log("We are here baby!"),s.style("background-color",function(a,b){return m.domain([d3.min(r(h,c.xAxis)),d3.max(r(h,c.xAxis))]),m(a[c.xAxis])}).style("font-size",function(a,b){return n.domain([d3.min(r(h,b)),d3.max(r(h,b))]),n(a)+"px"}),o=s.selectAll("td").data(function(a,b){return a}).enter().append("td").text(function(a,b){return a}));return l},c.drawMap=function(a,b,c){function d(a,b){("satellite"==i||"terrain"==i||"normal"==i)&&e(a),("regions"==i||"markers"==i)&&f(b)}function e(b){var c=google.visualization.arrayToDataTable(b),d={showTip:!0,useMapTypeControl:!0,mapType:i},e=new google.visualization.Map(document.getElementById(a));e.draw(c,d)}function f(b){console.log(google),console.log(google.visualization);var c=google.visualization.arrayToDataTable(b),d={region:j,displayMode:i,colorAxis:{colors:["red","blue"]},magnifyingGlass:{enable:!0,zoomFactor:3},enableRegionInteractivity:!0},e=new google.visualization.GeoChart(document.getElementById(a));e.draw(c,d)}var a=a.substr(1),g=b.width,h=b.height,i=b.mode,j=b.region,k=c.data.map(function(a,d){return{data:a,config:b,name:c.metadata.names[d]}}),l=[],m=[],n=k[0].config.mapLocation,o=k[0].config.pointColor,p=k[0].config.pointSize;l.push(k[n].name,k[o].name,k[p].name),m.push(l);for(var q=0;q<k.length;q++)l=[],l.push(k[q].data[n],k[q].data[o],k[q].data[p]),m.push(l);for(var r=[],s=0;s<m.length;s++){for(var t=m[s],u="",v=1;v<t.length;v++)u+=m[0][v]+":"+t[v]+" , ";u=u.substring(0,u.length-3),u=m[s][0].toUpperCase()+"\n"+u,l=[],l.push(m[s][0]),l.push(u),r.push(l)}document.getElementById(a).setAttribute("style","width: "+g+"px; height: "+h+"px;"),d(r,m)},c.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},s.prototype.setXAxis=function(a){var b=this.spec.axes[0];return void 0!=a.zero&&(this.spec.scales[0].zero=a.zero),void 0!=a.nice&&(this.spec.scales[0].nice=a.nice),p(a,b),this},s.prototype.setYAxis=function(a){var b=this.spec.axes[1];return void 0!=a.zero&&(this.spec.scales[1].zero=a.zero),void 0!=a.nice&&(this.spec.scales[1].nice=xAxisConfig.nice),p(a,b),this},s.prototype.setPadding=function(a){void 0==this.spec.padding&&(this.spec.padding={},this.spec.padding.top=0,this.spec.padding.bottom=0,this.spec.padding.left=0,this.spec.padding.right=0);for(var b in a)a.hasOwnProperty(b)&&(this.spec.padding[b]=a[b]);return this.spec.width=this.originalWidth-this.spec.padding.left-this.spec.padding.right,this.spec.height=this.originalHeight-this.spec.padding.top-this.spec.padding.bottom,this},s.prototype.unsetPadding=function(){return delete this.spec.padding,this.spec.width=this.originalWidth,this.spec.height=this.originalHeight,this},s.prototype.setDimension=function(a){void 0!=a.width&&(this.spec.width=a.width,this.originalWidth=a.width),void 0!=a.height&&(this.spec.height=a.height,this.originalHeight=a.height)},s.prototype.update=function(a){var b=n([a],this.config,this.dataTable.metadata);if("slide"==this.config.update){{this.table.shift()}this.dataTable.data.shift()}this.dataTable.data.push(a),console.log(dataTable.data),this.table.push(b[0]),this.chart.data(this.data).update({duration:500})},s.prototype.updateList=function(a,b){for(i=0;i<a.length;i++)"slide"==this.config.update&&this.dataTable.data.shift(),this.dataTable.data.push(a[i]);var c=n(a,this.config,this.dataTable.metadata);for(i=0;i<a.length;i++)"slide"==this.config.update&&this.table.shift(),this.table.push(c[i]);this.chart.data(this.data).update({duration:500})},s.prototype.resize=function(){var a=this,b=document.getElementById(a.canvas.replace("#","")).offsetHeight,c=document.getElementById(a.canvas.replace("#","")).offsetWidth;console.log("Resized",b,c,a);var d=a.spec.width,e=a.spec.height;console.log(d,e),a.chart.width(d).height(e).renderer("svg").update({props:"enter"}).update()},s.prototype.plot=function(b,c){this.dataTable.data=b,console.log(this.dataTable),t(this.dataTable,this.config.xAxis);var d=n(b,this.config,this.dataTable.metadata);if(void 0!=this.config.yAxis&&this.config.yAxis.constructor==Array){var e=u(this.dataTable,this.config.yAxis,this.config.aggregate,this.config.xAxis);console.log("myName",e),this.spec.scales[1].domain.field=e}console.log(this.dataTable);var f={table:d};void 0==this.config.update&&(this.config.update="slide");var g=this.canvas;this.data=f,this.table=d,console.log(f);var h={};if(this.legend){for(legendsList=[],i=0;i<b.length;i++){for(a=b[i][this.legendIndex],isfound=!1,j=0;j<legendsList.length;j++)if(a==legendsList[j]){isfound=!0;break}isfound||legendsList.push(a)}h={duration:600},this.spec.legends[0].values=legendsList}var k=this.spec,l=this.toolTip,m=this.toolTipFunction,o=this;vg.parse.spec(k,function(a){o.chart=a({el:g,renderer:"svg",data:f}).update(),l&&(tool=d3.select("body").append("div").style({position:"absolute",opacity:0,padding:"4px",border:"2px solid ",background:"white"}),o.chart.on("mouseover",m[0]),o.chart.on("mouseout",m[1])),c&&c.call(o),console.log("inside",o)}),console.log(this)},c.DataTable=function(a){this.metadata={},this.metadata.names=[],this.metadata.types=[],this.data=[]},c.DataTable.prototype.addColumn=function(a,b){this.metadata.names.push(a),this.metadata.types.push(b)},c.DataTable.prototype.addRow=function(a){this.data.push(a)},c.DataTable.prototype.addRows=function(a){for(var b=0;b<a.length;b++)this.data.push(a[b])},c.DataTable.prototype.getColumnNames=function(){return this.metadata.names},c.DataTable.prototype.getColumnByName=function(a){for(var b={},c=0;c<this.metadata.names.length;c++)if(this.metadata.names[c]==a)return b.name=this.metadata.names[c],b.type=this.metadata.types[c],b},c.DataTable.prototype.getColumnByIndex=function(a){var b=this.metadata.names[a];return b?(b.name=b,b.type=this.metadata.types[a],b):void 0},c.DataTable.prototype.getColumnData=function(a){var b=[];return this.data.map(function(c){b.push(c[a])}),b},c.DataTable.prototype.toJSON=function(){console.log(this)}}(window.igviz||{});